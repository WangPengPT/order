import{Q as G,a as F}from"./QItem-BqPJIBYT.js";import{a as ue,Q as Ce}from"./rtl-B0pN4EN1.js";import{i as he,aL as ke,T as N,U as b,a3 as j,ac as W,V as s,aM as R,$ as O,b as I,w as Y,R as xe,a6 as g,W as n,a8 as M,Y as w,aN as de,a9 as E,X,c as ee,r as x,E as we,F as Se,j as Me,g as ce,h as J,e as K,al as qe,m as le,A as z,aO as Oe,G as $e,aP as Ee,_ as D,a2 as _,a0 as te,P as Qe,x as Z,Z as H,ak as Pe,aQ as Ve,a4 as q,a1 as V,aR as Ae,aa as Be,ab as ae}from"./index-But2YoOz.js";import{C as oe}from"./ClosePopup-gjMNSrvQ.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Fe,Q as Ne,b as ie}from"./QTable-0qLeZSNz.js";import{C as Ie,Q as je}from"./CodeMaker-3r3752K-.js";import"./format-DhWcHpGA.js";import"./_commonjsHelpers-Bx2EM-6T.js";function Re(){return he(ke)}const Ue={class:"tabs row q-gutter-sm"},Le={__name:"FilterTabs",props:{filterStatus:String},setup(e){const c=e,t=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function r(a){if(a===c.filterStatus)switch(a){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(a,i)=>(b(),N("div",Ue,[(b(),N(j,null,W(t,u=>s(O,{key:u.value,label:u.label,flat:e.filterStatus!==u.value,unelevated:!0,class:R(r(u.value)),onClick:l=>a.$emit("update:filterStatus",u.value)},null,8,["label","flat","class","onClick"])),64))]))}};function fe(e,c){var t,r,a;try{t=e.toString().split(".")[1].length}catch{t=0}try{r=c.toString().split(".")[1].length}catch{r=0}return a=Math.pow(10,Math.max(t,r)),(ne(e,a)+ne(c,a))/a}function ne(e,c){var t=0,r=e.toString(),a=c.toString();try{t+=r.split(".")[1].length}catch{}try{t+=a.split(".")[1].length}catch{}return Number(r.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,t)}const ze={class:"text-h6 text-weight-bolder"},De={class:"status-text"},He={class:"text-subtitle2 text-weight-bolder"},Ge={__name:"TableCard",props:{table:Object,editMode:Boolean,price:Object},setup(e){const c=e,t=I(()=>{const a=parseFloat(c.table.order.reduce((u,l)=>u+l.price*l.quantity,0).toFixed(2));let i=c.table.peopleType.adults*c.price.adult+c.table.peopleType.childres*c.price.children;return fe(a,i).toFixed(2)}),r=I(()=>{switch(c.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});return(a,i)=>Y((b(),g(X,{class:R(["table-card",r.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:i[1]||(i[1]=()=>a.$emit("selectTable",e.table.id))},{default:n(()=>[e.editMode?(b(),g(O,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:i[0]||(i[0]=de(()=>a.$emit("removeTable",e.table.id),["stop"]))})):M("",!0),w("div",null,[w("div",ze," Mesa "+E(e.table.id),1),w("div",De,E(e.table.status),1),w("div",null,E(e.table.people)+" Pessoas ",1),w("div",He," €"+E(t.value),1)])]),_:1},8,["class"])),[[xe]])}},We=be(Ge,[["__scopeId","data-v-0dc3d1b7"]]),Je={class:"table-grid q-pa-lg"},Ke={__name:"TableGrid",props:{tables:Array,editMode:Boolean,price:Object},setup(e){return console.log("recive tables: ",e.tables),(t,r)=>(b(),N("div",Je,[(b(!0),N(j,null,W(e.tables,a=>(b(),g(We,{key:a.id,table:a,editMode:e.editMode,onSelectTable:()=>t.$emit("selectTable",a.id),onRemoveTable:()=>t.$emit("removeTable",a.id),price:e.price},null,8,["table","editMode","onSelectTable","onRemoveTable","price"]))),128))]))}},Ze=be(Ke,[["__scopeId","data-v-d9f5808a"]]),ve=ee({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:c,emit:t}){const r=ce(),a=x(null);let i=0;const u=[];function l(T){const Q=typeof T=="boolean"?T:e.noErrorFocus!==!0,A=++i,o=(d,S)=>{t(`validation${d===!0?"Success":"Error"}`,S)},v=d=>{const S=d.validate();return typeof S.then=="function"?S.then(P=>({valid:P,comp:d}),P=>({valid:!1,comp:d,err:P})):Promise.resolve({valid:S,comp:d})};return(e.greedy===!0?Promise.all(u.map(v)).then(d=>d.filter(S=>S.valid!==!0)):u.reduce((d,S)=>d.then(()=>v(S).then(P=>{if(P.valid===!1)return Promise.reject(P)})),Promise.resolve()).catch(d=>[d])).then(d=>{if(d===void 0||d.length===0)return A===i&&o(!0),!0;if(A===i){const{comp:S,err:P}=d[0];if(P!==void 0&&console.error(P),o(!1,S),Q===!0){const U=d.find(({comp:L})=>typeof L.focus=="function"&&qe(L.$)===!1);U!==void 0&&U.comp.focus()}}return!1})}function C(){i++,u.forEach(T=>{typeof T.resetValidation=="function"&&T.resetValidation()})}function p(T){T!==void 0&&le(T);const Q=i+1;l().then(A=>{Q===i&&A===!0&&(e.onSubmit!==void 0?t("submit",T):T?.target!==void 0&&typeof T.target.submit=="function"&&T.target.submit())})}function f(T){T!==void 0&&le(T),t("reset"),z(()=>{C(),e.autofocus===!0&&e.noResetFocus!==!0&&k()})}function k(){Oe(()=>{if(a.value===null)return;(a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),Q=>Q.tabIndex!==-1))?.focus({preventScroll:!0})})}$e(Ee,{bindComponent(T){u.push(T)},unbindComponent(T){const Q=u.indexOf(T);Q!==-1&&u.splice(Q,1)}});let B=!1;return we(()=>{B=!0}),Se(()=>{B===!0&&e.autofocus===!0&&k()}),Me(()=>{e.autofocus===!0&&k()}),Object.assign(r.proxy,{validate:l,resetValidation:C,submit:p,reset:f,focus:k,getValidationComponents:()=>u}),()=>J("form",{class:"q-form",ref:a,onSubmit:p,onReset:f},K(c.default))}}),Xe={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(e,{emit:c}){const t=c,r=x("");function a(){t("submit",r.value),t("update:visible",!1),r.value=""}function i(){t("close")}return(u,l)=>(b(),g(te,{persistent:"","model-value":e.visible},{default:n(()=>[s(X,{style:{"min-width":"400px"}},{default:n(()=>[s(ve,{onSubmit:a,onClick:de(i,["stop"])},{default:n(()=>[s(D,{filled:"",modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=C=>r.value=C),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[C=>C&&C.length>0||"Por favor, escreve algo",C=>!isNaN(C)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),s(_,{align:"right"},{default:n(()=>[w("div",null,[s(O,{label:"Submeter",type:"submit",color:"primary"}),s(O,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm"})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ye={class:R(["col-4","justify-between","row"])},_e={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","autoClose","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(e,{emit:c}){const t=e,r=x(!0),a=["Livre","Ocupado","Pago","Reservado"],i=c,u=x(null),l=Qe({id:null,people:0,peopleType:{adults:0,children:0},status:""});Z(()=>t.visible,async p=>{p&&t.table?.id&&(Object.assign(l,JSON.parse(JSON.stringify(t.table))),await z(),C(),l.status==="Livre"&&(await z(),i("tableEditableMode")))},{immediate:!0}),Z(()=>[l.peopleType.adults,l.peopleType.childres],([p,f])=>{const k=parseInt(p)||0,B=parseInt(f)||0;l.people=k+B});async function C(){if(r.value=!0,await z(),!u.value||!t.table.id){console.warn("Canvas not ready or table ID missing");return}const p=window.global_qr_addr+Ie.SimpleEncode(t.table.id);console.log("qrcoed data: ",p),je.toCanvas(u.value,p,{width:150},f=>{f?(console.error("二维码生成失败",f),setTimeout(()=>C(),300)):r.value=!1})}return(p,f)=>(b(),g(te,{"model-value":e.visible,onHide:f[9]||(f[9]=()=>p.$emit("autoClose"))},{default:n(()=>[s(X,{style:{"min-width":"400px"}},{default:n(()=>[s(ve,{onSubmit:f[8]||(f[8]=()=>p.$emit("submit",l)),class:"q-ma-lg"},{default:n(()=>[w("h3",null,"桌号 "+E(l.id),1),s(D,{modelValue:l.people,"onUpdate:modelValue":f[0]||(f[0]=k=>l.people=k),label:"Quantidade de Cliente",type:"number",disable:"",readonly:""},null,8,["modelValue"]),s(D,{modelValue:l.peopleType.adults,"onUpdate:modelValue":f[1]||(f[1]=k=>l.peopleType.adults=k),label:"Adultos",type:"number",disable:!e.editable},null,8,["modelValue","disable"]),s(D,{modelValue:l.peopleType.childres,"onUpdate:modelValue":f[2]||(f[2]=k=>l.peopleType.childres=k),label:"Crianças",type:"number",disable:!e.editable},null,8,["modelValue","disable"]),s(Fe,{modelValue:l.status,"onUpdate:modelValue":f[3]||(f[3]=k=>l.status=k),options:a,disable:!e.editable},null,8,["modelValue","disable"]),s(H,{class:"flex flex-center",style:{"min-height":"160px"}},{default:n(()=>[r.value?(b(),g(Pe,{key:0,color:"primary",size:"2em"})):M("",!0),w("canvas",{ref_key:"qrCanvas",ref:u,style:Ve({display:r.value?"none":"block",marginTop:"8px"})},null,4)]),_:1}),w("div",Ye,[l.status!="空闲"?(b(),g(O,{key:0,color:"deep-orange",glossy:"",label:"Limpar mesa",onClick:f[4]||(f[4]=()=>p.$emit("cleanTable",l.id))})):M("",!0),s(O,{color:"primary",label:"Visualizar pedidos",onClick:f[5]||(f[5]=()=>p.$emit("showTableOrders"))}),e.editable?M("",!0):(b(),g(O,{key:1,color:"secondary",label:"Editar",onClick:f[6]||(f[6]=()=>p.$emit("tableEditableMode"))})),e.editable?(b(),g(O,{key:2,color:"white","text-color":"black",label:"Cancelar",onClick:f[7]||(f[7]=()=>p.$emit("editableModeBack"))})):M("",!0),e.editable?(b(),g(O,{key:3,color:"primary",type:"submit",label:"Salvar"})):M("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},se=ee({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:c}){const t=I(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>J("tr",{style:e.props?.__trStyle,class:t.value},K(c.default))}}),re=ee({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:c}){const t=ce(),r=I(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return J("td",{class:r.value},K(c.default));const a=t.vnode.key,i=(e.props.colsMap!==void 0?e.props.colsMap[a]:null)||e.props.col;if(i===void 0)return;const{row:u}=e.props;return J("td",{class:r.value+i.__tdClass(u),style:i.__tdStyle(u)},K(c.default))}}}),et={class:"text-h6"},tt={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},lt={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})},price:Object},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose"],setup(e,{emit:c}){const t=e,r=c,a=x({rowsPerPage:0}),i=x(""),u=x(!1),l=x([]),C=[{name:"name",required:!0,label:"nome",align:"left",field:o=>q.getDishNameById(o.dishid),format:o=>`${o}`,sortable:!0},{name:"quantity",required:!0,label:"quandidade",align:"left",field:o=>o.quantity,format:o=>`${o}`,sortable:!0},{name:"price/uni",required:!0,label:"Preço/uni",align:"left",field:o=>o.price,format:o=>`${o}`,sortable:!0},{name:"price",required:!0,label:"Preço",align:"left",field:o=>o.price*o.quantity,format:o=>`${o.toFixed(2)}`,sortable:!0}],p=x([]);Z(()=>t.table?.order,o=>{l.value=Array.isArray(o)?[...o]:[]},{immediate:!0,deep:!0}),Z(()=>q.tables.value,()=>{if(t.table?.id){const o=q.tables.value.find(v=>v.id===t.table.id);o?.order&&(l.value=[...o.order])}},{deep:!0});function f(o){return u.value?o.filter(v=>v.price>0):o}function k(){u.value&&(i.value=u.value?"price>0":"")}function B(){A(),u.value=!1,r("autoClose")}function T(o){const v=l.value.findIndex(y=>y.dishid===o.dishid);if(v!==-1)if(l.value[v].quantity-=1,l.value[v].quantity<=0){const y=l.value.splice(v,1)[0],d=p.value.findIndex(S=>S.dishid===y.dishid);d!==-1?p.value[d].quantity+=1:p.value.push({dishid:y.dishid,quantity:1})}else{const y=p.value.findIndex(d=>d.dishid===o.dishid);y!==-1?p.value[y].quantity+=1:p.value.push({dishid:o.dishid,quantity:1})}}const Q=I(()=>{const o=parseFloat(l.value.reduce((y,d)=>y+d.price*d.quantity,0).toFixed(2));let v=t.table.peopleType.adults*t.price.adult+t.table.peopleType.childres*t.price.children;return fe(o,v).toFixed(2)});function A(){l.value=t.table.order.map(o=>({...o})),r("cancelOrderEdit")}return(o,v)=>(b(),g(te,{"model-value":e.visible,onHide:B},{default:n(()=>[s(X,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:n(()=>[s(H,null,{default:n(()=>[w("div",et,"Mesa "+E(e.table.id),1)]),_:1}),s(ue,{bordered:""},{default:n(()=>[e.table.peopleType.adults>0?(b(),g(G,{key:0},{default:n(()=>[s(F,null,{default:n(()=>v[5]||(v[5]=[V(" Adulto ")])),_:1,__:[5]}),s(F,null,{default:n(()=>[V("Quantidade: "+E(e.table.peopleType.adults),1)]),_:1}),s(F,null,{default:n(()=>[V("Preço/uni: €"+E(e.price.adult),1)]),_:1})]),_:1})):M("",!0),e.table.peopleType.childres>0?(b(),g(G,{key:1},{default:n(()=>[s(F,null,{default:n(()=>v[6]||(v[6]=[V(" Criança ")])),_:1,__:[6]}),s(F,null,{default:n(()=>[V("Quantidade: "+E(e.table.peopleType.childres),1)]),_:1}),s(F,null,{default:n(()=>[V("Preço/uni: €"+E(e.price.children),1)]),_:1})]),_:1})):M("",!0)]),_:1}),Array.isArray(l.value)&&l.value.length>0?(b(),g(H,{key:0,class:"q-pa-md"},{default:n(()=>[s(Ne,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:l.value,"virtual-scroll":"",filter:i.value,"filter-method":f,columns:C,pagination:a.value,"onUpdate:pagination":v[0]||(v[0]=y=>a.value=y),"rows-per-page-options":[0],"row-key":"id"},Ae({_:2},[e.editMode?{name:"header",fn:n(y=>[s(se,{props:y},{default:n(()=>[s(ie,{"auto-width":""}),(b(!0),N(j,null,W(y.cols,d=>(b(),g(ie,{key:d.name,props:y},{default:n(()=>[V(E(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,e.editMode?{name:"body",fn:n(y=>[s(se,{props:y},{default:n(()=>[s(re,{"auto-width":""},{default:n(()=>[s(O,{size:"sm",color:"accent",round:"",dense:"",onClick:d=>T(y.row),icon:"remove"},null,8,["onClick"])]),_:2},1024),(b(!0),N(j,null,W(y.cols,d=>(b(),g(re,{key:d.name,props:y},{default:n(()=>[V(E(d.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(b(),g(H,{key:1},{default:n(()=>v[7]||(v[7]=[V(" Nothing ")])),_:1,__:[7]})),s(_,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:n(()=>[s(_,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:n(()=>[w("div",tt," Total: €"+E(Q.value),1)]),_:1}),e.editMode?M("",!0):(b(),g(Be,{key:0,modelValue:u.value,"onUpdate:modelValue":v[1]||(v[1]=y=>u.value=y),color:"green",onClick:v[2]||(v[2]=y=>k()),label:"No Zero"},null,8,["modelValue"])),e.editMode?(b(),g(O,{key:1,color:"white","text-color":"black",label:"Cancelar",onClick:A})):M("",!0),e.editMode?(b(),g(O,{key:2,color:"primary",label:"Salvar",onClick:v[3]||(v[3]=y=>o.$emit("saveOrder",[...p.value]))})):M("",!0),e.editMode?M("",!0):(b(),g(O,{key:3,color:"primary",label:"Editar",onClick:v[4]||(v[4]=()=>o.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},at={class:R(["tables-page","row","no-wrap","justify-between"])},ft={__name:"TablesPage",setup(e){const c=Re(),t=x("Livre"),r=x(!1),a=x(!1),i=x(null),u=x(!1),l=x(!1),C=x(!1),p=x(!1),f=I(()=>t.value==="Todos"?q.tables.value:q.tables.value.filter(h=>h.status===t.value));function k(){r.value=!0}function B(){r.value=!1}function T(h){c.dialog({title:"Confimação de eliminação",message:`Tem certeza quer eliminar a mesa ${h} ? Esta operação não é recuperável.`,cancel:!0,persistent:!0}).onOk(()=>{const m=q.deleteTable(h);m!=null&&c.dialog({title:"Erro",message:m.message})})}function Q(){a.value=!0}function A(h){q.addNewTable(h)}function o(){a.value=!1}function v(h){const m=q.tables.value.find($=>$.id===h);i.value={...m,order:m?.order||[]},u.value=!0}function y(){l.value=!0}function d(h){const m=q.updateTable(h);m&&c.dialog(m),l.value=!1}function S(){l.value=!1,u.value=!1}function P(){l.value=!1}function U(h){c.dialog({title:"Confirmação de limpeza",message:`Tem a certeza que deseja limpar a mesa ${h}? Isto irá remover todos os clientes e definir o estado como 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const m=q.tableClean(h);m&&c.dialog(m)})}function L(){const h=q.tables.value.find(m=>m.id===i.value.id);i.value={...h,order:h?.order||[]},C.value=!0}function me(){C.value=!1}function pe(){p.value=!0}function ye(h){q.deleteOrders(i.value.id,h),p.value=!1}function ge(){p.value=!1}function Te(){C.value=!1}return(h,m)=>(b(),N(j,null,[w("div",at,[s(Le,{filterStatus:t.value,"onUpdate:filterStatus":m[0]||(m[0]=$=>t.value=$)},null,8,["filterStatus"]),s(O,{color:"primary",icon:r.value?"close":"edit",class:R(["q-pa-md"]),onClick:B},{default:n(()=>[r.value?M("",!0):(b(),g(Ce,{key:0},{default:n(()=>[s(ue,{style:{"min-width":"100px"}},{default:n(()=>[Y((b(),g(G,{clickable:"",onClick:Q},{default:n(()=>[s(F,null,{default:n(()=>m[6]||(m[6]=[V("Adicionar")])),_:1,__:[6]})]),_:1})),[[oe]]),Y((b(),g(G,{clickable:"",onClick:k},{default:n(()=>[s(F,null,{default:n(()=>m[7]||(m[7]=[V("Editar")])),_:1,__:[7]})]),_:1})),[[oe]])]),_:1})]),_:1}))]),_:1},8,["icon"])]),m[8]||(m[8]=w("div",null,null,-1)),w("div",null,[s(Ze,{tables:f.value,editMode:r.value,onSelectTable:v,onRemoveTable:T,price:ae(q).getCurentPeoplePrice()},null,8,["tables","editMode","price"])]),w("div",null,[s(Xe,{onSubmit:A,onClose:o,visible:a.value,"onUpdate:visible":m[1]||(m[1]=$=>a.value=$)},null,8,["visible"])]),w("div",null,[i.value?(b(),g(_e,{key:0,visible:u.value,"onUpdate:visible":m[2]||(m[2]=$=>u.value=$),table:i.value,"onUpdate:table":m[3]||(m[3]=$=>i.value=$),editable:l.value,onTableEditableMode:y,onSubmit:d,onAutoClose:S,onEditableModeBack:P,onCleanTable:U,onShowTableOrders:L},null,8,["visible","table","editable"])):M("",!0)]),w("div",null,[i.value?(b(),g(lt,{key:0,visible:C.value,"onUpdate:visible":m[4]||(m[4]=$=>C.value=$),table:i.value,"onUpdate:table":m[5]||(m[5]=$=>i.value=$),onClose:me,onSetEditMode:pe,editMode:p.value,onSaveOrder:ye,onCancelOrderEdit:ge,onAutoClose:Te,price:ae(q).getCurentPeoplePrice()},null,8,["visible","table","editMode","price"])):M("",!0)])],64))}};export{ft as default};
