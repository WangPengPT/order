import{Q as de,a as le}from"./QTable-1psvnl90.js";import{Q as X,a as q}from"./QTd-CnG-qauQ.js";import{q as D,p as re,b as g,N as ae,a1 as me,B as se,s as _,a2 as ve,t as fe,a3 as ge,L as ce,a4 as Y,z as be,n as U,d as L,o as p,f as d,a as t,w as s,e as te,V as H,i as c,h as r,C as ne,m as z,a0 as ee,c as N,k as B,_ as O,Z as ue,a5 as ye,Q as oe,j as R,a6 as W}from"./index-B--Xo-oA.js";import{Q as pe}from"./QItemLabel-noTC4oYv.js";import{Q as Ve}from"./QItem-CivMhpWI.js";import{a as he}from"./QField-BTRvUne8.js";import{Q as Z}from"./QSpace-DV88Ttf4.js";import{Q as ie}from"./QToolbar-BHOptIYu.js";import{C as G}from"./ClosePopup-Ca4DddgD.js";import{u as Se}from"./use-quasar-DRypuIEU.js";import"./format-CJebrXOQ.js";const we={ratio:[String,Number]};function ke(i,b){return D(()=>{const C=Number(i.ratio||(b!==void 0?b.value:void 0));return isNaN(C)!==!0&&C>0?{paddingBottom:`${100/C}%`}:null})}const Ce=1.7778,qe=re({name:"QImg",props:{...we,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:Ce},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(i,{slots:b,emit:C}){const T=g(i.initialRatio),Q=ke(i,T),m=be(),{registerTimeout:a,removeTimeout:v}=ae(),{registerTimeout:I,removeTimeout:V}=ae(),w=D(()=>i.placeholderSrc!==void 0?{src:i.placeholderSrc}:null),F=D(()=>i.errorSrc!==void 0?{src:i.errorSrc,__qerror:!0}:null),f=[g(null),g(w.value)],h=g(0),k=g(!1),x=g(!1),j=D(()=>`q-img q-img--${i.noNativeMenu===!0?"no-":""}menu`),y=D(()=>({width:i.width,height:i.height})),M=D(()=>`q-img__image ${i.imgClass!==void 0?i.imgClass+" ":""}q-img__image--with${i.noTransition===!0?"out":""}-transition q-img__image--`),J=D(()=>({...i.imgStyle,objectFit:i.fit,objectPosition:i.position}));function E(){if(V(),i.loadingShowDelay===0){k.value=!0;return}I(()=>{k.value=!0},i.loadingShowDelay)}function $(){V(),k.value=!1}function K({target:o}){Y(m)===!1&&(v(),T.value=o.naturalHeight===0?.5:o.naturalWidth/o.naturalHeight,P(o,1))}function P(o,S){S===1e3||Y(m)===!0||(o.complete===!0?n(o):a(()=>{P(o,S+1)},50))}function n(o){Y(m)!==!0&&(h.value=h.value^1,f[h.value].value=null,$(),o.getAttribute("__qerror")!=="true"&&(x.value=!1),C("load",o.currentSrc||o.src))}function l(o){v(),$(),x.value=!0,f[h.value].value=F.value,f[h.value^1].value=w.value,C("error",o)}function e(o){const S=f[o].value,A={key:"img_"+o,class:M.value,style:J.value,alt:i.alt,crossorigin:i.crossorigin,decoding:i.decoding,referrerpolicy:i.referrerpolicy,height:i.height,width:i.width,loading:i.loading,fetchpriority:i.fetchpriority,"aria-hidden":"true",draggable:i.draggable,...S};return h.value===o?Object.assign(A,{class:A.class+"current",onLoad:K,onError:l}):A.class+="loaded",_("div",{class:"q-img__container absolute-full",key:"img"+o},_("img",A))}function u(){return k.value===!1?_("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},fe(b[x.value===!0?"error":"default"])):_("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},b.loading!==void 0?b.loading():i.noSpinner===!0?void 0:[_(ge,{color:i.spinnerColor,size:i.spinnerSize})])}{let o=function(){ce(()=>i.src||i.srcset||i.sizes?{src:i.src,srcset:i.srcset,sizes:i.sizes}:null,S=>{v(),x.value=!1,S===null?($(),f[h.value^1].value=w.value):E(),f[h.value].value=S},{immediate:!0})};me.value===!0?se(o):o()}return()=>{const o=[];return Q.value!==null&&o.push(_("div",{key:"filler",style:Q.value})),f[0].value!==null&&o.push(e(0)),f[1].value!==null&&o.push(e(1)),o.push(_(ve,{name:"q-transition--fade"},u)),_("div",{key:"main",class:j.value,style:y.value,role:"img","aria-label":i.alt},o)}}}),_e={class:"q-pa-md"},Qe={style:{display:"flex",gap:"16px"}},xe={key:1,class:"upload-placeholder"},Ue={style:{display:"flex",gap:"16px"}},De={style:{display:"flex",gap:"16px"}},Te={style:{display:"flex",gap:"16px"}},Pe={__name:"MenuPage",setup(i){const b=Se(),C=[{name:"id",required:!0,label:"id",align:"left",field:n=>n.id,format:n=>`${n}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0,style:"max-width: 50px;"}],T=g(""),Q=g([]),m=g(null),a=g({});let v=["name","note","subname"];const I=["","_en","_cn"];let V=["id","price","category","tags","image","soldout"];const w=g(!1);function F(n,l){y=void 0,w.value=!0,k(l)}const f=g(!1);function h(n){y=void 0,f.value=!0,k(n)}function k(n,l){x=l,m.value=n;for(let e=0;e<v.length;e++)a.value[v[e]]=n[v[e]],a.value[v[e]+"_en"]=n[v[e]+"_en"],a.value[v[e]+"_cn"]=n[v[e]+"_cn"];a.value.disable=n.disable||!1;for(let e=0;e<V.length;e++)a.value[V[e]]=n[V[e]]}let x=!1;function j(){console.log("apply dish");let n={},l=!1;for(let e=0;e<v.length;e++)for(let u=0;u<I.length;u++){const o=v[e]+I[u];m.value[o]!=a.value[o]&&(n[o]=a.value[o],l=!0)}for(let e=0;e<V.length;e++){let u=V[e];m.value[u]!=a.value[u]&&(l=!0,n[u]=a.value[u])}if(m.value.disable?a.value.disable||(l=!0,n.disable=!1):a.value.disable&&(l=!0,n.disable=!0),console.log("need_update：",m.value,a.value),console.log("need_update：",l),!l){b.notify({type:"negative",message:"There is no data changed!"});return}if(l){let e=!1;if(a.value.id=a.value.id.trim(),a.value.id!="")if(a.value.id==m.value.id)e=!0;else{e=!0;for(let u=0;u<U.menuData.length;u++)if(a.value.id==U.menuData[u].id){console.log("has old id : ",a.value,U.menuData[u]),e=!1;break}}if(!e){b.notify({type:"negative",message:`invalid id: ${a.value.id}`}),console.log("check_ok is: ",e);return}if(x)n={...a.value},U.menuData.push(n),y?(y.subitems||(y.subitems=[y]),y.subitems.push(n),n.handle=m.value.handle):(n.handle="handle_"+n.id,Q.value.push(n));else{n.org_id=m.value.id;for(let u=0;u<v.length;u++)for(let o=0;o<I.length;o++){const S=v[u]+I[o];m.value[S]=a.value[S]}m.value.disable=a.value.disable;for(let u=0;u<V.length;u++){let o=V[u];m.value[o]=a.value[o]}}f.value=!1,w.value=!1,U.updateMenuItem(n),console.log("update apply dish",n)}}let y;function M(n){y=n;let l={id:"",handle:n.handle,category:n.category,subname:"",price:"0"};f.value=!0,k(l,!0)}function J(){y=void 0;let n={id:"",handle:"",category:"",subname:"",price:"0"};w.value=!0,k(n,!0)}se(()=>{console.log("..... onMounted ...");const n=[],l={};for(let e=0;e<U.menuData.length;e++){let u=U.menuData[e];if(l[u.handle]){let o=l[u.handle];o.subitems||(o.subitems=[o]),o.subitems.push(u)}else l[u.handle]=u,n.push(u)}Q.value=n,console.log(Q.value)});const E=g(null);function $(){E.value.click()}function K(n){const l=n.target.files[0];l&&P(l)}async function P(n){let l;l="/upload_image";const e=new FormData;e.append("image",n);try{const u=await fetch(l,{method:"POST",body:e});if(!u.ok)throw new Error("上传失败");const o=await u.json();console.log("上传成功",o),a.value.image=o.imageUrl,console.log(a.value.image),b.notify({type:"positive",message:"图片上传成功"})}catch(u){console.error("上传错误",u),b.notify({type:"negative",message:"图片上传失败"})}}return(n,l)=>(p(),L(H,null,[d("div",_e,[t(de,{title:"Dishes",rows:Q.value,columns:C,"row-key":"id",filter:T.value,onRowClick:F},{header:s(e=>[t(X,{props:e},{default:s(()=>[t(le,{"auto-width":""}),(p(!0),L(H,null,ee(e.cols,u=>(p(),N(le,{key:u.name,props:e},{default:s(()=>[B(O(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:s(e=>[t(X,{props:e},{default:s(()=>[t(q,{"auto-width":""},{default:s(()=>[t(c,{size:"sm",color:e.row.subitems?"accent":"primary",round:"",dense:"",onClick:u=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(p(!0),L(H,null,ee(e.cols,u=>(p(),N(q,{key:u.name,props:e},{default:s(()=>[B(O(u.value),1)]),_:2},1032,["props"]))),128)),t(q,{"auto-width":""},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:u=>F(null,e.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),z(t(X,{props:e},{default:s(()=>[e.row.subitems?ue("",!0):(p(),N(q,{key:0,colspan:"100%"},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:u=>M(e.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),e.row.subitems?(p(),N(q,{key:1,colspan:"100%"},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:u=>M(e.row),label:"add new"},null,8,["onClick"]),t(he,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:s(()=>[t(pe,{header:""},{default:s(()=>l[23]||(l[23]=[B("sub item")])),_:1,__:[23]}),(p(!0),L(H,null,ee(e.row.subitems,u=>(p(),N(Ve,{key:u.id},{default:s(()=>[t(q,{style:{width:"50px"}},{default:s(()=>[B(O(u.id),1)]),_:2},1024),t(q,{style:{width:"150px"}},{default:s(()=>[B(O(u.subname),1)]),_:2},1024),t(q,{"auto-width":""},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:o=>h(u),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):ue("",!0)]),_:2},1032,["props"]),[[ye,e.expand]])]),"top-right":s(()=>[t(c,{class:"q-mr-lg",color:"primary",dense:"",onClick:l[0]||(l[0]=e=>J()),label:"add new"}),t(r,{borderless:"",dense:"",debounce:"300",modelValue:T.value,"onUpdate:modelValue":l[1]||(l[1]=e=>T.value=e),placeholder:"Search"},{append:s(()=>[t(ne,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),t(te,{modelValue:w.value,"onUpdate:modelValue":l[14]||(l[14]=e=>w.value=e),"full-height":"","full-width":""},{default:s(()=>[t(oe,null,{default:s(()=>[t(R,{class:"row items-center q-pb-none"},{default:s(()=>[l[24]||(l[24]=d("div",{class:"text-h6"},"Edit Dish",-1)),t(Z),z(t(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])]),_:1,__:[24]}),d("div",Qe,[t(W,{modelValue:a.value.disable,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),t(W,{modelValue:a.value.soldout,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),t(R,{class:"row items-center q-pa-none q-ml-lg"},{default:s(()=>[d("div",{class:"image-uploader cursor-pointer",onClick:$},[a.value.image?(p(),N(qe,{key:0,src:a.value.image,style:{height:"100px",width:"100px"}},null,8,["src"])):(p(),L("div",xe,[t(ne,{name:"image",size:"xl"}),l[25]||(l[25]=d("div",{class:"q-mt-sm"},"点击选择图片",-1))]))]),d("input",{type:"file",ref_key:"fileInput",ref:E,accept:"image/*",style:{display:"none"},onChange:K},null,544)]),_:1})]),t(R,{class:"q-pa-sm q-gutter-sm"},{default:s(()=>[t(r,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.name=e),label:"name(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.name_en,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.name_en=e),label:"name(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.name_cn,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.name_cn=e),label:"name(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[26]||(l[26]=d("div",{class:"q-ma-lg"},null,-1)),t(r,{outlined:"",modelValue:a.value.note,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.note=e),label:"descript(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.note_en,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.note_en=e),label:"descript(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.note_cn,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.note_cn=e),label:"descript(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[27]||(l[27]=d("div",{class:"q-ma-lg"},null,-1)),d("div",Ue,[t(r,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),d("div",De,[t(r,{outlined:"",modelValue:a.value.category,"onUpdate:modelValue":l[12]||(l[12]=e=>a.value.category=e),label:"category",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.tags,"onUpdate:modelValue":l[13]||(l[13]=e=>a.value.tags=e),label:"tags",style:{flex:"1"}},null,8,["modelValue"])]),l[28]||(l[28]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[26,27,28]}),t(ie,{class:"q-gutter-lg q-mb-lg"},{default:s(()=>[t(Z),z(t(c,{align:"right",label:"Cancel"},null,512),[[G]]),t(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:f.value,"onUpdate:modelValue":l[22]||(l[22]=e=>f.value=e),"full-height":"","full-width":""},{default:s(()=>[t(oe,null,{default:s(()=>[t(R,{class:"row items-center q-pb-none"},{default:s(()=>[l[29]||(l[29]=d("div",{class:"text-h6"},"Edit Item",-1)),t(Z),z(t(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])]),_:1,__:[29]}),t(R,{class:"q-pa-sm q-gutter-sm"},{default:s(()=>[t(W,{modelValue:a.value.disable,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),t(W,{modelValue:a.value.soldout,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),l[30]||(l[30]=d("div",{class:"q-ma-lg"},null,-1)),t(r,{outlined:"",modelValue:a.value.subname,"onUpdate:modelValue":l[17]||(l[17]=e=>a.value.subname=e),label:"subname(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.subname_en,"onUpdate:modelValue":l[18]||(l[18]=e=>a.value.subname_en=e),label:"subname(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.subname_cn,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value.subname_cn=e),label:"subname(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[31]||(l[31]=d("div",{class:"q-ma-lg"},null,-1)),d("div",Te,[t(r,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[20]||(l[20]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[21]||(l[21]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),l[32]||(l[32]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[30,31,32]}),t(ie,{class:"q-gutter-lg q-mb-lg"},{default:s(()=>[t(Z),z(t(c,{align:"right",label:"Cancel"},null,512),[[G]]),t(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Pe as default};
