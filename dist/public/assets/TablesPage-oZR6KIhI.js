import{Q as z,a as N}from"./QItem-C7uGJCoI.js";import{b as Z,a as ne,Q as ye}from"./QField-vg1inMdR.js";import{d as D,o as n,V as U,a0 as J,a,a7 as P,i as w,q as G,n as S,m as ge,R as Te,c as r,w as l,Z as C,f as k,g as L,_ as q,Q as H,b as O,h as ke,l as K,e as Y,a8 as we,L as X,j as B,a3 as Ce,a9 as he,aa as W,k as Q,ab as xe,$ as Oe,W as ee}from"./index-4m4pxkM8.js";import{u as se}from"./use-quasar-CQ0Ga8GK.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as de}from"./QForm-BV6earTy.js";import{b as $e,Q as Se,a as te}from"./QTable-CRfrAGGw.js";import{C as le,Q as qe}from"./CodeMaker-IOgtdCDu.js";import{Q as ae,a as ie}from"./QTd-CfYiQa7S.js";import"./QItemLabel-xqnOXrfQ.js";import"./format-CJebrXOQ.js";import"./_commonjsHelpers-gnU0ypJ3.js";const Me={class:"tabs row q-gutter-sm"},Qe={__name:"FilterTabs",props:{filterStatus:String},setup(t){const u=t,b=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function o(m){if(m===u.filterStatus)switch(m){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(m,p)=>(n(),D("div",Me,[(n(),D(U,null,J(b,d=>a(w,{key:d.value,label:d.label,flat:t.filterStatus!==d.value,unelevated:!0,class:P(o(d.value)),onClick:e=>m.$emit("update:filterStatus",d.value)},null,8,["label","flat","class","onClick"])),64))]))}};function re(t,u){var b,o,m;try{b=t.toString().split(".")[1].length}catch{b=0}try{o=u.toString().split(".")[1].length}catch{o=0}return m=Math.pow(10,Math.max(b,o)),(oe(t,m)+oe(u,m))/m}function oe(t,u){var b=0,o=t.toString(),m=u.toString();try{b+=o.split(".")[1].length}catch{}try{b+=m.split(".")[1].length}catch{}return Number(o.replace(".",""))*Number(m.replace(".",""))/Math.pow(10,b)}const Ae={class:"text-h6 text-weight-bolder"},Ee={class:"status-text"},Ne={class:"text-subtitle2 text-weight-bolder"},Ie={__name:"TableCard",props:{table:Object,editMode:Boolean,price:Object},setup(t){const u=t,b=G(()=>{const d=parseFloat(u.table.order.reduce((T,M)=>T+M.price*M.quantity,0).toFixed(2));let e=u.table.peopleType.adults*u.price.adult+u.table.peopleType.childres*u.price.children;return re(d,e).toFixed(2)}),o=G(()=>{switch(u.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});function m(d,e){d["msg_"+e]=!1,S.socket.emit("click_msg",d.id,e)}function p(){document.getElementById("tipsAudio").play()}return S.playSoundFun=p,(d,e)=>ge((n(),r(H,{class:P(["table-card",o.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:e[3]||(e[3]=()=>d.$emit("selectTable",t.table.id))},{default:l(()=>[t.editMode?(n(),r(w,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:e[0]||(e[0]=L(()=>d.$emit("removeTable",t.table.id),["stop"]))})):C("",!0),e[4]||(e[4]=k("audio",{id:"tipsAudio",src:"sound/tips.mp3",preload:"auto"},null,-1)),t.table.msg_pay?(n(),r(w,{key:1,onClick:e[1]||(e[1]=L(T=>m(t.table,"pay"),["stop"])),icon:"euro",style:{width:"40px",height:"30px"},color:"white",rounded:"",flat:"",class:"right-btn1"})):C("",!0),t.table.msg_call?(n(),r(w,{key:2,onClick:e[2]||(e[2]=L(T=>m(t.table,"call"),["stop"])),icon:"call",style:{width:"40px",height:"30px"},color:"white",flat:"",rounded:"",class:"right-btn2"})):C("",!0),k("div",null,[k("div",Ae," Table "+q(t.table.id),1),k("div",Ee,q(t.table.status),1),k("div",null,q(t.table.people)+" People ",1),k("div",Ne," €"+q(b.value),1)])]),_:1,__:[4]},8,["class"])),[[Te]])}},Be=_(Ie,[["__scopeId","data-v-8eed0c8a"]]),De={class:"table-grid q-pa-lg"},Re={__name:"TableGrid",props:{tables:Array,editMode:Boolean,price:Object},setup(t){return(u,b)=>(n(),D("div",De,[(n(!0),D(U,null,J(t.tables,o=>(n(),r(Be,{key:o.id,table:o,editMode:t.editMode,onSelectTable:()=>u.$emit("selectTable",o.id),onRemoveTable:()=>u.$emit("removeTable",o.id),price:t.price},null,8,["table","editMode","onSelectTable","onRemoveTable","price"]))),128))]))}},Fe=_(Re,[["__scopeId","data-v-59832ab0"]]),Ve={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(t,{emit:u}){const b=u,o=O("");function m(){b("submit",o.value),o.value=""}return(p,d)=>(n(),r(Y,{"model-value":t.visible,onHide:d[2]||(d[2]=()=>p.$emit("close"))},{default:l(()=>[a(H,{style:{"min-width":"400px"}},{default:l(()=>[a(de,{onSubmit:m},{default:l(()=>[a(ke,{filled:"",modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=e=>o.value=e),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[e=>e&&e.length>0||"Por favor, escreve algo",e=>!isNaN(e)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),a(K,{align:"right"},{default:l(()=>[k("div",null,[a(w,{label:"Submeter",type:"submit",color:"primary"}),a(w,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:d[1]||(d[1]=L(()=>p.$emit("close"),["stop"]))})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},je={class:"q-mb-md flex justify-center"},Le={class:"row items-center q-gutter-sm"},Ue={class:"q-mt-none q-mb-none text-center"},Pe={class:"self-center no-outline"},ze={round:"",class:"self-center no-outline"},Je={class:"self-center no-outline"},Ge={class:P(["col-4","justify-between","row"])},He={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","close","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(t,{emit:u}){const b=t,o=O(!0),m=["Livre","Ocupado","Pago","Reservado"],p=u,d=O(null),e=we({id:null,people:0,peopleType:{adults:0,childres:0},status:""});function T(){e.peopleType.adults>0&&(e.peopleType.adults=e.peopleType.adults-1)}function M(){e.peopleType.adults=e.peopleType.adults+1}function h(){e.peopleType.childres>0&&(e.peopleType.childres=e.peopleType.childres-1)}function V(){e.peopleType.childres=e.peopleType.childres+1}function j(){window.open(window.env.QR_ADDR+le.SimpleEncode(b.table.id),"_blank")}X(()=>b.visible,async x=>{x&&b.table?.id&&(Object.assign(e,JSON.parse(JSON.stringify(b.table))),await W(),R(),e.status==="Livre"&&(await W(),p("tableEditableMode")))},{immediate:!0}),X(()=>[e.peopleType.adults,e.peopleType.childres],([x,v])=>{const A=parseInt(x)||0,F=parseInt(v)||0;e.people=A+F});async function R(){if(o.value=!0,await W(),!d.value||!b.table.id){console.warn("Canvas not ready or table ID missing");return}const x=window.env.QR_ADDR+le.SimpleEncode(b.table.id);console.log("qrcoed data: ",x),qe.toCanvas(d.value,x,{width:150},v=>{v?(console.error("二维码生成失败",v),setTimeout(()=>R(),300)):o.value=!1})}return(x,v)=>(n(),r(Y,{"model-value":t.visible,onHide:v[7]||(v[7]=A=>x.$emit("close"))},{default:l(()=>[a(H,{style:{"min-width":"450px"}},{default:l(()=>[a(B,{class:"row items-center justify-end q-pb-none q-pl-none q-pt-sm q-pr-sm"},{default:l(()=>[a(w,{icon:"close",flat:"",round:"",dense:"",onClick:v[0]||(v[0]=L(A=>x.$emit("close"),["stop"]))})]),_:1}),a(de,{onSubmit:v[6]||(v[6]=()=>x.$emit("submit",e)),class:"q-ma-lg"},{default:l(()=>[k("div",je,[k("div",Le,[k("h4",Ue,"Table "+q(e.id),1)])]),a(Z,{outlined:"",label:"People","stack-label":"",class:"q-mx-sm row-grow"},{control:l(()=>[k("div",Pe,q(e.people),1)]),_:1}),a(B,{class:"row items-center"},{default:l(()=>[t.editable?(n(),r(w,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:T})):C("",!0),a(Z,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:l(()=>[k("div",ze,q(e.peopleType.adults),1)]),_:1}),t.editable?(n(),r(w,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:M})):C("",!0)]),_:1}),a(B,{class:"row items-center no-wrap"},{default:l(()=>[t.editable?(n(),r(w,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:h})):C("",!0),a(Z,{outlined:"",label:"Children","stack-label":"",class:"q-mx-sm col-grow"},{control:l(()=>[k("div",Je,q(e.peopleType.childres),1)]),_:1}),t.editable?(n(),r(w,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:V})):C("",!0)]),_:1}),a($e,{square:"",outlined:"",modelValue:e.status,"onUpdate:modelValue":v[1]||(v[1]=A=>e.status=A),options:m,disable:!t.editable},null,8,["modelValue","disable"]),a(B,{class:"flex flex-center",style:{"min-height":"160px"}},{default:l(()=>[o.value?(n(),r(Ce,{key:0,color:"primary",size:"2em"})):C("",!0),k("canvas",{ref_key:"qrCanvas",ref:d,style:he({display:o.value?"none":"block",marginTop:"8px",border:"1px solid #c0c0c0",borderRadius:"12px"}),onClick:j},null,4)]),_:1}),k("div",Ge,[e.status!="空闲"&&!t.editable?(n(),r(w,{key:0,color:"deep-orange",glossy:"",label:"Clear Table",onClick:v[2]||(v[2]=()=>x.$emit("cleanTable",e.id))})):C("",!0),t.editable?C("",!0):(n(),r(w,{key:1,color:"primary",label:"View Orders",onClick:v[3]||(v[3]=()=>x.$emit("showTableOrders"))})),t.editable?C("",!0):(n(),r(w,{key:2,color:"secondary",label:"Edit",onClick:v[4]||(v[4]=()=>x.$emit("tableEditableMode"))})),t.editable?(n(),r(w,{key:3,color:"white","text-color":"black",label:"Cancel",onClick:v[5]||(v[5]=()=>x.$emit("editableModeBack"))})):C("",!0),t.editable?(n(),r(w,{key:4,color:"primary",type:"submit",label:"Save"})):C("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ze=_(He,[["__scopeId","data-v-abec81fd"]]),We={class:"text-h6"},Ke={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},Xe={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})},price:Object},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose","deleteOrder"],setup(t,{emit:u}){const b=se(),o=t,m=u,p=O({rowsPerPage:0}),d=O(""),e=O(!1),T=O([]),M=[{name:"id",required:!0,label:"Id",align:"left",field:i=>i.dishid,format:i=>`${i}`,sortable:!0},{name:"name",required:!0,label:"Name",align:"left",field:i=>S.getDishName(i),format:i=>`${i}`,sortable:!0},{name:"quantity",required:!0,label:"Quantity",align:"left",field:i=>i.quantity,format:i=>`${i}`,sortable:!0},{name:"price/uni",required:!0,label:"Price/uni",align:"left",field:i=>i.price,format:i=>`${i}`,sortable:!0},{name:"price",required:!0,label:"Price",align:"left",field:i=>i.price*i.quantity,format:i=>`${i.toFixed(2)}`,sortable:!0}],h=O([]);X(()=>o.table?.order,i=>{T.value=Array.isArray(i)?JSON.parse(JSON.stringify(i)):[]},{immediate:!0,deep:!0});function V(i){return e.value?i.filter(f=>f.price>0):i}function j(){e.value&&(d.value=e.value?"price>0":"")}function R(){F(),e.value=!1,m("autoClose")}function x(i){const f=T.value.findIndex(y=>y.dishid===i.dishid);if(f===-1)return;const c=T.value[f];if(!(c.quantity<=0))if(c.quantity-=1,c.quantity===0){const y=T.value.splice(f,1)[0],E=h.value.findIndex(I=>I.dishid===y.dishid);E!==-1?h.value[E].quantity+=1:h.value.push({dishid:y.dishid,quantity:1})}else{const y=h.value.findIndex(E=>E.dishid===i.dishid);y!==-1?h.value[y].quantity+=1:h.value.push({dishid:i.dishid,quantity:1})}}function v(i,f){b.dialog({title:"Delete Confirmation",message:`Are you sure you want to delete ${i.name}?`,cancel:!0,persistent:!0}).onOk(()=>{const c=T.value.findIndex(I=>I.name===i.name);if(c===-1)return;const y=T.value.splice(c,1)[0],E=h.value.findIndex(I=>I.dishid===y.dishid);E!==-1?h.value[E].quantity+=y.quantity:h.value.push({dishid:y.dishid,quantity:y.quantity}),m("deleteOrder",{order:i.name,tableId:f})})}const A=G(()=>{const i=parseFloat(T.value.reduce((c,y)=>c+y.price*y.quantity,0).toFixed(2));let f=o.table.peopleType.adults*o.price.adult+o.table.peopleType.childres*o.price.children;return re(i,f).toFixed(2)});function F(){T.value=Array.isArray(o.table.order)?JSON.parse(JSON.stringify(o.table.order)):[],h.value=[],m("cancelOrderEdit")}return(i,f)=>(n(),r(Y,{"model-value":t.visible,onHide:R},{default:l(()=>[a(H,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:l(()=>[a(B,null,{default:l(()=>[k("div",We,"Table "+q(t.table.id),1)]),_:1}),a(ne,{bordered:""},{default:l(()=>[a(z,null,{default:l(()=>[a(N,null,{default:l(()=>f[5]||(f[5]=[Q("Adult")])),_:1,__:[5]}),a(N,null,{default:l(()=>[Q("Quantity: "+q(t.table.peopleType.adults),1)]),_:1}),a(N,null,{default:l(()=>[Q("Price/unit: €"+q(t.price.adult),1)]),_:1})]),_:1}),t.table.peopleType.childres>0?(n(),r(z,{key:0},{default:l(()=>[a(N,null,{default:l(()=>f[6]||(f[6]=[Q("Child")])),_:1,__:[6]}),a(N,null,{default:l(()=>[Q("Quantity: "+q(t.table.peopleType.childres),1)]),_:1}),a(N,null,{default:l(()=>[Q("Price/unit: €"+q(t.price.children),1)]),_:1})]),_:1})):C("",!0)]),_:1}),Array.isArray(T.value)&&T.value.length>0?(n(),r(B,{key:0,class:"q-pa-md"},{default:l(()=>[a(Se,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:T.value,"virtual-scroll":"",filter:d.value,"filter-method":V,columns:M,pagination:p.value,"onUpdate:pagination":f[0]||(f[0]=c=>p.value=c),"rows-per-page-options":[0],"row-key":"id"},xe({_:2},[t.editMode?{name:"header",fn:l(c=>[a(ae,{props:c},{default:l(()=>[a(te,{"auto-width":""}),(n(!0),D(U,null,J(c.cols,y=>(n(),r(te,{key:y.name,props:c},{default:l(()=>[Q(q(y.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,t.editMode?{name:"body",fn:l(c=>[a(ae,{props:c},{default:l(()=>[a(ie,{"auto-width":""},{default:l(()=>[c.row.name==="Sushi Aleatória?®"?(n(),r(w,{key:0,size:"sm",color:"accent",round:"",dense:"",icon:"close",disable:c.row.quantity<=0,onClick:y=>v(c.row,t.table.id)},null,8,["disable","onClick"])):(n(),r(w,{key:1,size:"sm",color:"accent",round:"",dense:"",icon:"remove",disable:c.row.quantity<=0,onClick:y=>x(c.row)},null,8,["disable","onClick"]))]),_:2},1024),(n(!0),D(U,null,J(c.cols,y=>(n(),r(ie,{key:y.name,props:c},{default:l(()=>[Q(q(y.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(n(),r(B,{key:1},{default:l(()=>f[7]||(f[7]=[Q(" Nothing ")])),_:1,__:[7]})),a(K,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:l(()=>[a(K,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:l(()=>[k("div",Ke," Total: €"+q(A.value),1)]),_:1}),t.editMode?C("",!0):(n(),r(Oe,{key:0,modelValue:e.value,"onUpdate:modelValue":f[1]||(f[1]=c=>e.value=c),color:"green",onClick:f[2]||(f[2]=c=>j()),label:"No Zero"},null,8,["modelValue"])),t.editMode?(n(),r(w,{key:1,color:"white","text-color":"black",label:"Cancel",onClick:F})):C("",!0),t.editMode?(n(),r(w,{key:2,color:"primary",label:"Save",onClick:f[3]||(f[3]=c=>i.$emit("saveOrder",[...h.value]))})):C("",!0),t.editMode?C("",!0):(n(),r(w,{key:3,color:"primary",label:"Edit",onClick:f[4]||(f[4]=()=>i.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ye={class:P(["tables-page","row","no-wrap","justify-between"])},ct={__name:"TablesPage",setup(t){const u=se(),b=O("Livre"),o=O(!1),m=O(!1),p=O(null),d=O(!1),e=O(!1),T=O(!1),M=O(!1),h=O({}),V=G(()=>b.value==="Todos"?S.tables.value:S.tables.value.filter(g=>g.status===b.value));function j(){o.value=!0}function R(){o.value==!0&&(o.value=!1)}function x(g){u.dialog({title:"Delete Confirmation",message:`Are you sure you want to delete table ${g}? This operation cannot be undone.`,cancel:!0,persistent:!0}).onOk(()=>{const s=S.deleteTable(g);s!=null&&u.dialog({title:"Erro",message:s.message})})}function v(){m.value=!0}async function A(g){const s=await S.addNewTable(g);s!==void 0&&u.notify({title:s.title,type:"negative",message:s.message,position:"top-right",timeout:3e3,icon:"error"})}function F(){m.value=!1}function i(g){const s=S.tables.value.find($=>$.id===g);p.value={...s,order:s?.order||[]},d.value=!0}function f(){e.value=!0}function c(g){const s={id:g.id,status:g.status,peopleType:{adults:g.peopleType.adults,childres:g.peopleType.childres}},$=S.updateTable(s);$&&u.dialog($),e.value=!1}function y(){e.value=!1,d.value=!1}function E(){e.value=!1}function I(g){u.dialog({title:"Clear Confirmation",message:`Are you sure you want to clear table ${g}? This will remove all customers and set the status to 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const s=S.tableClean(g);s&&u.dialog(s)})}function ue(){const g=S.tables.value.find(s=>s.id===p.value.id);p.value={...g,order:g?.order||[]},T.value=!0}function ce(){T.value=!1}function be(){M.value=!0}function me(g){S.deleteOrders(p.value.id,g),h.value.order&&(S.deleteOrder(h.value),h.value={}),M.value=!1}function fe(){S.refreshTables(),M.value=!1}function pe(){T.value=!1}function ve({order:g,tableId:s}){h.value={order:g,tableId:s}}return(g,s)=>(n(),D(U,null,[k("div",Ye,[a(Qe,{filterStatus:b.value,"onUpdate:filterStatus":s[0]||(s[0]=$=>b.value=$)},null,8,["filterStatus"]),a(w,{color:"primary",icon:o.value?"close":"edit",class:P(["q-pa-md"]),onClick:R},{default:l(()=>[o.value?C("",!0):(n(),r(ye,{key:0},{default:l(()=>[a(ne,{style:{"min-width":"100px"}},{default:l(()=>[a(z,{clickable:"",onClick:v},{default:l(()=>[a(N,null,{default:l(()=>s[6]||(s[6]=[Q("Adicionar")])),_:1,__:[6]})]),_:1}),a(z,{clickable:"",onClick:j},{default:l(()=>[a(N,null,{default:l(()=>s[7]||(s[7]=[Q("Editar")])),_:1,__:[7]})]),_:1})]),_:1})]),_:1}))]),_:1},8,["icon"])]),s[8]||(s[8]=k("div",null,null,-1)),k("div",null,[a(Fe,{tables:V.value,editMode:o.value,onSelectTable:i,onRemoveTable:x,price:ee(S).formatPrice()},null,8,["tables","editMode","price"])]),k("div",null,[a(Ve,{onSubmit:A,onClose:F,visible:m.value,"onUpdate:visible":s[1]||(s[1]=$=>m.value=$)},null,8,["visible"])]),k("div",null,[p.value?(n(),r(Ze,{key:0,visible:d.value,"onUpdate:visible":s[2]||(s[2]=$=>d.value=$),table:p.value,"onUpdate:table":s[3]||(s[3]=$=>p.value=$),editable:e.value,onTableEditableMode:f,onSubmit:c,onClose:y,onEditableModeBack:E,onCleanTable:I,onShowTableOrders:ue},null,8,["visible","table","editable"])):C("",!0)]),k("div",null,[p.value?(n(),r(Xe,{key:0,visible:T.value,"onUpdate:visible":s[4]||(s[4]=$=>T.value=$),table:p.value,"onUpdate:table":s[5]||(s[5]=$=>p.value=$),onClose:ce,onSetEditMode:be,editMode:M.value,onSaveOrder:me,onCancelOrderEdit:fe,onAutoClose:pe,price:ee(S).formatPrice(),onDeleteOrder:ve},null,8,["visible","table","editMode","price"])):C("",!0)])],64))}};export{ct as default};
