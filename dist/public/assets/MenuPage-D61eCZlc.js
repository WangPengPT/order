import{Q as de,a as ee}from"./QTable-7XDRs8Tp.js";import{Q as K,a as C}from"./QTd-Cgg0y9sd.js";import{q as D,p as re,b as g,N as le,a1 as me,B as se,s as q,a2 as fe,t as ve,a3 as ge,L as ce,a4 as X,z as be,n as U,d as L,o as p,f as d,a as t,w as s,e as ae,V as H,i as c,h as r,C as te,m as z,a0 as Y,c as N,k as B,_ as O,Z as ne,a5 as ye,Q as ie,j as R,a6 as ue}from"./index-DopTafnW.js";import{Q as pe}from"./QItemLabel-CLdhTPOz.js";import{Q as he}from"./QItem-CJCzGW6M.js";import{a as Ve}from"./QField-DoVjuRYT.js";import{Q as W}from"./QSpace-Cg-L8Vez.js";import{Q as oe}from"./QToolbar-R91cwz2U.js";import{C as Z}from"./ClosePopup-B9pXPU_N.js";import{u as we}from"./use-quasar-BXHiPdu-.js";import"./format-CJebrXOQ.js";const Se={ratio:[String,Number]};function ke(o,b){return D(()=>{const _=Number(o.ratio||(b!==void 0?b.value:void 0));return isNaN(_)!==!0&&_>0?{paddingBottom:`${100/_}%`}:null})}const _e=1.7778,Ce=re({name:"QImg",props:{...Se,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:_e},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(o,{slots:b,emit:_}){const T=g(o.initialRatio),Q=ke(o,T),m=be(),{registerTimeout:a,removeTimeout:f}=le(),{registerTimeout:I,removeTimeout:h}=le(),S=D(()=>o.placeholderSrc!==void 0?{src:o.placeholderSrc}:null),F=D(()=>o.errorSrc!==void 0?{src:o.errorSrc,__qerror:!0}:null),v=[g(null),g(S.value)],V=g(0),k=g(!1),x=g(!1),j=D(()=>`q-img q-img--${o.noNativeMenu===!0?"no-":""}menu`),y=D(()=>({width:o.width,height:o.height})),M=D(()=>`q-img__image ${o.imgClass!==void 0?o.imgClass+" ":""}q-img__image--with${o.noTransition===!0?"out":""}-transition q-img__image--`),G=D(()=>({...o.imgStyle,objectFit:o.fit,objectPosition:o.position}));function E(){if(h(),o.loadingShowDelay===0){k.value=!0;return}I(()=>{k.value=!0},o.loadingShowDelay)}function $(){h(),k.value=!1}function J({target:u}){X(m)===!1&&(f(),T.value=u.naturalHeight===0?.5:u.naturalWidth/u.naturalHeight,P(u,1))}function P(u,w){w===1e3||X(m)===!0||(u.complete===!0?n(u):a(()=>{P(u,w+1)},50))}function n(u){X(m)!==!0&&(V.value=V.value^1,v[V.value].value=null,$(),u.getAttribute("__qerror")!=="true"&&(x.value=!1),_("load",u.currentSrc||u.src))}function l(u){f(),$(),x.value=!0,v[V.value].value=F.value,v[V.value^1].value=S.value,_("error",u)}function e(u){const w=v[u].value,A={key:"img_"+u,class:M.value,style:G.value,alt:o.alt,crossorigin:o.crossorigin,decoding:o.decoding,referrerpolicy:o.referrerpolicy,height:o.height,width:o.width,loading:o.loading,fetchpriority:o.fetchpriority,"aria-hidden":"true",draggable:o.draggable,...w};return V.value===u?Object.assign(A,{class:A.class+"current",onLoad:J,onError:l}):A.class+="loaded",q("div",{class:"q-img__container absolute-full",key:"img"+u},q("img",A))}function i(){return k.value===!1?q("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ve(b[x.value===!0?"error":"default"])):q("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},b.loading!==void 0?b.loading():o.noSpinner===!0?void 0:[q(ge,{color:o.spinnerColor,size:o.spinnerSize})])}{let u=function(){ce(()=>o.src||o.srcset||o.sizes?{src:o.src,srcset:o.srcset,sizes:o.sizes}:null,w=>{f(),x.value=!1,w===null?($(),v[V.value^1].value=S.value):E(),v[V.value].value=w},{immediate:!0})};me.value===!0?se(u):u()}return()=>{const u=[];return Q.value!==null&&u.push(q("div",{key:"filler",style:Q.value})),v[0].value!==null&&u.push(e(0)),v[1].value!==null&&u.push(e(1)),u.push(q(fe,{name:"q-transition--fade"},i)),q("div",{key:"main",class:j.value,style:y.value,role:"img","aria-label":o.alt},u)}}}),qe={class:"q-pa-md"},Qe={style:{display:"flex",gap:"16px"}},xe={key:1,class:"upload-placeholder"},Ue={style:{display:"flex",gap:"16px"}},De={style:{display:"flex",gap:"16px"}},Te={style:{display:"flex",gap:"16px"}},Pe={__name:"MenuPage",setup(o){const b=we(),_=[{name:"id",required:!0,label:"id",align:"left",field:n=>n.id,format:n=>`${n}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0,style:"max-width: 50px;"}],T=g(""),Q=g([]),m=g(null),a=g({});let f=["name","note","subname"];const I=["","_en","_cn"];let h=["id","price","category","tags","image"];const S=g(!1);function F(n,l){y=void 0,S.value=!0,k(l)}const v=g(!1);function V(n){y=void 0,v.value=!0,k(n)}function k(n,l){x=l,m.value=n;for(let e=0;e<f.length;e++)a.value[f[e]]=n[f[e]],a.value[f[e]+"_en"]=n[f[e]+"_en"],a.value[f[e]+"_cn"]=n[f[e]+"_cn"];a.value.disable=n.disable||!1;for(let e=0;e<h.length;e++)a.value[h[e]]=n[h[e]]}let x=!1;function j(){console.log("apply dish");let n={},l=!1;for(let e=0;e<f.length;e++)for(let i=0;i<I.length;i++){const u=f[e]+I[i];m.value[u]!=a.value[u]&&(n[u]=a.value[u],l=!0)}for(let e=0;e<h.length;e++){let i=h[e];m.value[i]!=a.value[i]&&(l=!0,n[i]=a.value[i])}if(m.value.disable?a.value.disable||(l=!0,n.disable=!1):a.value.disable&&(l=!0,n.disable=!0),console.log("need_update：",m.value,a.value),console.log("need_update：",l),!l){b.notify({type:"negative",message:"There is no data changed!"});return}if(l){let e=!1;if(a.value.id=a.value.id.trim(),a.value.id!="")if(a.value.id==m.value.id)e=!0;else{e=!0;for(let i=0;i<U.menuData.length;i++)if(a.value.id==U.menuData[i].id){console.log("has old id : ",a.value,U.menuData[i]),e=!1;break}}if(!e){b.notify({type:"negative",message:`invalid id: ${a.value.id}`}),console.log("check_ok is: ",e);return}if(x)n={...a.value},U.menuData.push(n),y?(y.subitems||(y.subitems=[y]),y.subitems.push(n),n.handle=m.value.handle):(n.handle="handle_"+n.id,Q.value.push(n));else{n.org_id=m.value.id;for(let i=0;i<f.length;i++)for(let u=0;u<I.length;u++){const w=f[i]+I[u];m.value[w]=a.value[w]}m.value.disable=a.value.disable;for(let i=0;i<h.length;i++){let u=h[i];m.value[u]=a.value[u]}}v.value=!1,S.value=!1,U.updateMenuItem(n),console.log("update apply dish",n)}}let y;function M(n){y=n;let l={id:"",handle:n.handle,category:n.category,subname:"",price:"0"};v.value=!0,k(l,!0)}function G(){y=void 0;let n={id:"",handle:"",category:"",subname:"",price:"0"};S.value=!0,k(n,!0)}se(()=>{console.log("..... onMounted ...");const n=[],l={};for(let e=0;e<U.menuData.length;e++){let i=U.menuData[e];if(l[i.handle]){let u=l[i.handle];u.subitems||(u.subitems=[u]),u.subitems.push(i)}else l[i.handle]=i,n.push(i)}Q.value=n,console.log(Q.value)});const E=g(null);function $(){E.value.click()}function J(n){const l=n.target.files[0];l&&P(l)}async function P(n){let l;l="/upload_image";const e=new FormData;e.append("image",n);try{const i=await fetch(l,{method:"POST",body:e});if(!i.ok)throw new Error("上传失败");const u=await i.json();console.log("上传成功",u),a.value.image=u.imageUrl,console.log(a.value.image),b.notify({type:"positive",message:"图片上传成功"})}catch(i){console.error("上传错误",i),b.notify({type:"negative",message:"图片上传失败"})}}return(n,l)=>(p(),L(H,null,[d("div",qe,[t(de,{title:"Dishes",rows:Q.value,columns:_,"row-key":"id",filter:T.value,onRowClick:F},{header:s(e=>[t(K,{props:e},{default:s(()=>[t(ee,{"auto-width":""}),(p(!0),L(H,null,Y(e.cols,i=>(p(),N(ee,{key:i.name,props:e},{default:s(()=>[B(O(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:s(e=>[t(K,{props:e},{default:s(()=>[t(C,{"auto-width":""},{default:s(()=>[t(c,{size:"sm",color:e.row.subitems?"accent":"primary",round:"",dense:"",onClick:i=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(p(!0),L(H,null,Y(e.cols,i=>(p(),N(C,{key:i.name,props:e},{default:s(()=>[B(O(i.value),1)]),_:2},1032,["props"]))),128)),t(C,{"auto-width":""},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:i=>F(null,e.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),z(t(K,{props:e},{default:s(()=>[e.row.subitems?ne("",!0):(p(),N(C,{key:0,colspan:"100%"},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:i=>M(e.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),e.row.subitems?(p(),N(C,{key:1,colspan:"100%"},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:i=>M(e.row),label:"add new"},null,8,["onClick"]),t(Ve,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:s(()=>[t(pe,{header:""},{default:s(()=>l[21]||(l[21]=[B("sub item")])),_:1,__:[21]}),(p(!0),L(H,null,Y(e.row.subitems,i=>(p(),N(he,{key:i.id},{default:s(()=>[t(C,{style:{width:"50px"}},{default:s(()=>[B(O(i.id),1)]),_:2},1024),t(C,{style:{width:"150px"}},{default:s(()=>[B(O(i.subname),1)]),_:2},1024),t(C,{"auto-width":""},{default:s(()=>[t(c,{color:"primary",dense:"",onClick:u=>V(i),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):ne("",!0)]),_:2},1032,["props"]),[[ye,e.expand]])]),"top-right":s(()=>[t(c,{class:"q-mr-lg",color:"primary",dense:"",onClick:l[0]||(l[0]=e=>G()),label:"add new"}),t(r,{borderless:"",dense:"",debounce:"300",modelValue:T.value,"onUpdate:modelValue":l[1]||(l[1]=e=>T.value=e),placeholder:"Search"},{append:s(()=>[t(te,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),t(ae,{modelValue:S.value,"onUpdate:modelValue":l[13]||(l[13]=e=>S.value=e),"full-height":"","full-width":""},{default:s(()=>[t(ie,null,{default:s(()=>[t(R,{class:"row items-center q-pb-none"},{default:s(()=>[l[22]||(l[22]=d("div",{class:"text-h6"},"Edit Dish",-1)),t(W),z(t(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[Z]])]),_:1,__:[22]}),d("div",Qe,[t(ue,{modelValue:a.value.disable,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),t(R,{class:"row items-center q-pa-none q-ml-lg"},{default:s(()=>[d("div",{class:"image-uploader cursor-pointer",onClick:$},[a.value.image?(p(),N(Ce,{key:0,src:a.value.image,style:{height:"100px",width:"100px"}},null,8,["src"])):(p(),L("div",xe,[t(te,{name:"image",size:"xl"}),l[23]||(l[23]=d("div",{class:"q-mt-sm"},"点击选择图片",-1))]))]),d("input",{type:"file",ref_key:"fileInput",ref:E,accept:"image/*",style:{display:"none"},onChange:J},null,544)]),_:1})]),t(R,{class:"q-pa-sm q-gutter-sm"},{default:s(()=>[t(r,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.name=e),label:"name(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.name_en,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.name_en=e),label:"name(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.name_cn,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.name_cn=e),label:"name(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[24]||(l[24]=d("div",{class:"q-ma-lg"},null,-1)),t(r,{outlined:"",modelValue:a.value.note,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.note=e),label:"descript(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.note_en,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.note_en=e),label:"descript(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.note_cn,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.note_cn=e),label:"descript(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[25]||(l[25]=d("div",{class:"q-ma-lg"},null,-1)),d("div",Ue,[t(r,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),d("div",De,[t(r,{outlined:"",modelValue:a.value.category,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.category=e),label:"category",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.tags,"onUpdate:modelValue":l[12]||(l[12]=e=>a.value.tags=e),label:"tags",style:{flex:"1"}},null,8,["modelValue"])]),l[26]||(l[26]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[24,25,26]}),t(oe,{class:"q-gutter-lg q-mb-lg"},{default:s(()=>[t(W),z(t(c,{align:"right",label:"Cancel"},null,512),[[Z]]),t(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:v.value,"onUpdate:modelValue":l[20]||(l[20]=e=>v.value=e),"full-height":"","full-width":""},{default:s(()=>[t(ie,null,{default:s(()=>[t(R,{class:"row items-center q-pb-none"},{default:s(()=>[l[27]||(l[27]=d("div",{class:"text-h6"},"Edit Item",-1)),t(W),z(t(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[Z]])]),_:1,__:[27]}),t(R,{class:"q-pa-sm q-gutter-sm"},{default:s(()=>[t(ue,{modelValue:a.value.disable,"onUpdate:modelValue":l[14]||(l[14]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),l[28]||(l[28]=d("div",{class:"q-ma-lg"},null,-1)),t(r,{outlined:"",modelValue:a.value.subname,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.subname=e),label:"subname(pt)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.subname_en,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.subname_en=e),label:"subname(english)",dense:n.dense},null,8,["modelValue","dense"]),t(r,{outlined:"",modelValue:a.value.subname_cn,"onUpdate:modelValue":l[17]||(l[17]=e=>a.value.subname_cn=e),label:"subname(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[29]||(l[29]=d("div",{class:"q-ma-lg"},null,-1)),d("div",Te,[t(r,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[18]||(l[18]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),t(r,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),l[30]||(l[30]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[28,29,30]}),t(oe,{class:"q-gutter-lg q-mb-lg"},{default:s(()=>[t(W),z(t(c,{align:"right",label:"Cancel"},null,512),[[Z]]),t(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Pe as default};
