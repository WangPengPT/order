import{ao as ke,p as pe,z as ee,ap as ze,q as F,s as c,ar as we,b as z,aD as ge,G as _e,aP as Ue,ag as Ce,ah as Be,L as he,A as Pe,b3 as Le,aK as Ne,aJ as Re,a4 as se,a8 as Ee,C as be,i as K,S as Ie,b4 as Qe,aI as Te,n as V,d as je,o as Me,a as k,w as L,V as $e,f as H,W as ie,Q as De,k as de,_ as Oe}from"./index-CLihMo4E.js";import{b as Ae,h as ce}from"./format-CJebrXOQ.js";import{Q as ve}from"./QPage-Cd7Zw_j0.js";import{Q as Ve,a as We}from"./QLayout-CgBUj9Z4.js";import{Q as Ge,a as fe}from"./QItem-CfODblS6.js";import{Q as He}from"./QItemLabel-DSMY7Gjy.js";import{d as Xe}from"./vuedraggable.umd-Dox13Bms.js";import{u as Je}from"./use-quasar-QRfbl4pP.js";import"./_commonjsHelpers-gnU0ypJ3.js";const Ke={...ke,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:a=>a>=0&&a<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},Z=50,Fe=2*Z,ye=Fe*Math.PI,Ye=Math.round(ye*1e3)/1e3,Ze=pe({name:"QCircularProgress",props:{...Ke,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(a,{slots:v}){const{proxy:{$q:u}}=ee(),r=ze(a),o=F(()=>{const h=(u.lang.rtl===!0?-1:1)*a.angle;return{transform:a.reverse!==(u.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-h}deg)`:`rotate3d(0, 0, 1, ${h-90}deg)`}}),g=F(()=>a.instantFeedback!==!0&&a.indeterminate!==!0?{transition:`stroke-dashoffset ${a.animationSpeed}ms ease 0s, stroke ${a.animationSpeed}ms ease`}:""),d=F(()=>Fe/(1-a.thickness/2)),n=F(()=>`${d.value/2} ${d.value/2} ${d.value} ${d.value}`),S=F(()=>Ae(a.value,a.min,a.max)),N=F(()=>a.max-a.min),w=F(()=>a.thickness/2*d.value),E=F(()=>{const h=(a.max-S.value)/N.value,e=a.rounded===!0&&S.value<a.max&&h<.25?w.value/2*(1-h/.25):0;return ye*h+e});function B({thickness:h,offset:e,color:_,cls:U,rounded:f}){return c("circle",{class:"q-circular-progress__"+U+(_!==void 0?` text-${_}`:""),style:g.value,fill:"transparent",stroke:"currentColor","stroke-width":h,"stroke-dasharray":Ye,"stroke-dashoffset":e,"stroke-linecap":f,cx:d.value,cy:d.value,r:Z})}return()=>{const h=[];a.centerColor!==void 0&&a.centerColor!=="transparent"&&h.push(c("circle",{class:`q-circular-progress__center text-${a.centerColor}`,fill:"currentColor",r:Z-w.value/2,cx:d.value,cy:d.value})),a.trackColor!==void 0&&a.trackColor!=="transparent"&&h.push(B({cls:"track",thickness:w.value,offset:0,color:a.trackColor})),h.push(B({cls:"circle",thickness:w.value,offset:E.value,color:a.color,rounded:a.rounded===!0?"round":void 0}));const e=[c("svg",{class:"q-circular-progress__svg",style:o.value,viewBox:n.value,"aria-hidden":"true"},h)];return a.showValue===!0&&e.push(c("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:a.fontSize}},v.default!==void 0?v.default():[c("div",S.value)])),c("div",{class:`q-circular-progress q-circular-progress--${a.indeterminate===!0?"in":""}determinate`,style:r.value,role:"progressbar","aria-valuemin":a.min,"aria-valuemax":a.max,"aria-valuenow":a.indeterminate===!0?void 0:S.value},we(v.internal,e))}}});function W(a,v,u,r){const o=[];return a.forEach(g=>{r(g)===!0?o.push(g):v.push({failedPropValidation:u,file:g})}),o}function J(a){a?.dataTransfer&&(a.dataTransfer.dropEffect="copy"),_e(a)}const ea={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},aa=["rejected"];function ta({editable:a,dnd:v,getFileInput:u,addFilesToQueue:r}){const{props:o,emit:g,proxy:d}=ee(),n=z(null),S=F(()=>o.accept!==void 0?o.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),N=F(()=>parseInt(o.maxFiles,10)),w=F(()=>parseInt(o.maxTotalSize,10));function E(l){if(a.value)if(l!==Object(l)&&(l={target:null}),l.target?.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&ge(l);else{const C=u();C!==l.target&&C?.click(l)}}function B(l){a.value&&l&&r(null,l)}function h(l,C,j,M){let i=Array.from(C||l.target.files);const b=[],P=()=>{b.length!==0&&g("rejected",b)};if(o.accept!==void 0&&S.value.indexOf("*/")===-1&&(i=W(i,b,"accept",m=>S.value.some(y=>m.type.toUpperCase().startsWith(y)||m.name.toUpperCase().endsWith(y))),i.length===0))return P();if(o.maxFileSize!==void 0){const m=parseInt(o.maxFileSize,10);if(i=W(i,b,"max-file-size",y=>y.size<=m),i.length===0)return P()}if(o.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(m=>{m.__key=m.webkitRelativePath+m.lastModified+m.name+m.size}),M===!0){const m=j.map(y=>y.__key);i=W(i,b,"duplicate",y=>m.includes(y.__key)===!1)}if(i.length===0)return P();if(o.maxTotalSize!==void 0){let m=M===!0?j.reduce((y,I)=>y+I.size,0):0;if(i=W(i,b,"max-total-size",y=>(m+=y.size,m<=w.value)),i.length===0)return P()}if(typeof o.filter=="function"){const m=o.filter(i);i=W(i,b,"filter",y=>m.includes(y))}if(o.maxFiles!==void 0){let m=M===!0?j.length:0;if(i=W(i,b,"max-files",()=>(m++,m<=N.value)),i.length===0)return P()}if(P(),i.length!==0)return i}function e(l){J(l),v.value!==!0&&(v.value=!0)}function _(l){_e(l),(l.relatedTarget!==null||Ue.is.safari!==!0?l.relatedTarget!==n.value:document.elementsFromPoint(l.clientX,l.clientY).includes(n.value)===!1)===!0&&(v.value=!1)}function U(l){J(l);const C=l.dataTransfer.files;C.length!==0&&r(null,C),v.value=!1}function f(l){if(v.value===!0)return c("div",{ref:n,class:`q-${l}__dnd absolute-full`,onDragenter:J,onDragover:J,onDragleave:_,onDrop:U})}return Object.assign(d,{pickFiles:E,addFiles:B}),{pickFiles:E,addFiles:B,onDragover:e,onDragleave:_,processFiles:h,getDndNode:f,maxFilesNumber:N,maxTotalSizeNumber:w}}function me(a){return(a*100).toFixed(2)+"%"}const la={...Ce,...ea,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},Se=[...aa,"start","finish","added","removed"];function ra(a,v){const u=ee(),{props:r,slots:o,emit:g,proxy:d}=u,{$q:n}=d,S=Be(r,n);function N(t,p,q){if(t.__status=p,p==="idle"){t.__uploaded=0,t.__progress=0,t.__sizeLabel=ce(t.size),t.__progressLabel="0.00%";return}if(p==="failed"){d.$forceUpdate();return}t.__uploaded=p==="uploaded"?t.size:q,t.__progress=p==="uploaded"?1:Math.min(.9999,t.__uploaded/t.size),t.__progressLabel=me(t.__progress),d.$forceUpdate()}const w=F(()=>r.disable!==!0&&r.readonly!==!0),E=z(!1),B=z(null),h=z(null),e={files:z([]),queuedFiles:z([]),uploadedFiles:z([]),uploadedSize:z(0),updateFileStatus:N,isAlive:()=>Ee(u)===!1},{pickFiles:_,addFiles:U,onDragover:f,onDragleave:l,processFiles:C,getDndNode:j,maxFilesNumber:M,maxTotalSizeNumber:i}=ta({editable:w,dnd:E,getFileInput:le,addFilesToQueue:re});Object.assign(e,a({props:r,slots:o,emit:g,helpers:e,exposeApi:t=>{Object.assign(e,t)}})),e.isBusy===void 0&&(e.isBusy=z(!1));const b=z(0),P=F(()=>b.value===0?0:e.uploadedSize.value/b.value),m=F(()=>me(P.value)),y=F(()=>ce(b.value)),I=F(()=>w.value===!0&&e.isUploading.value!==!0&&(r.multiple===!0||e.queuedFiles.value.length===0)&&(r.maxFiles===void 0||e.files.value.length<M.value)&&(r.maxTotalSize===void 0||b.value<i.value)),s=F(()=>w.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);Ie(Qe,ue);const $=F(()=>"q-uploader column no-wrap"+(S.value===!0?" q-uploader--dark q-dark":"")+(r.bordered===!0?" q-uploader--bordered":"")+(r.square===!0?" q-uploader--square no-border-radius":"")+(r.flat===!0?" q-uploader--flat no-shadow":"")+(r.disable===!0?" disabled q-uploader--disable":"")+(E.value===!0?" q-uploader--dnd":"")),D=F(()=>"q-uploader__header"+(r.color!==void 0?` bg-${r.color}`:"")+(r.textColor!==void 0?` text-${r.textColor}`:""));he(e.isUploading,(t,p)=>{p===!1&&t===!0?g("start"):p===!0&&t===!1&&g("finish")});function O(){r.disable===!1&&(e.abort(),e.uploadedSize.value=0,b.value=0,te(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function R(){r.disable===!1&&ae(["uploaded"],()=>{e.uploadedFiles.value=[]})}function X(){ae(["idle","failed"],({size:t})=>{b.value-=t,e.queuedFiles.value=[]})}function ae(t,p){if(r.disable===!0)return;const q={files:[],size:0},Q=e.files.value.filter(x=>t.indexOf(x.__status)===-1?!0:(q.size+=x.size,q.files.push(x),x.__img!==void 0&&window.URL.revokeObjectURL(x.__img.src),!1));q.files.length!==0&&(e.files.value=Q,p(q),g("removed",q.files))}function Y(t){r.disable||(t.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(p=>p.__key!==t.__key):t.__status==="uploading"?t.__abort():b.value-=t.size,e.files.value=e.files.value.filter(p=>p.__key!==t.__key?!0:(p.__img!==void 0&&window.URL.revokeObjectURL(p.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(p=>p.__key!==t.__key),g("removed",[t]))}function te(){e.files.value.forEach(t=>{t.__img!==void 0&&window.URL.revokeObjectURL(t.__img.src)})}function le(){return h.value||B.value.getElementsByClassName("q-uploader__input")[0]}function re(t,p){const q=C(t,p,e.files.value,!0),Q=le();Q!=null&&(Q.value=""),q!==void 0&&(q.forEach(x=>{if(e.updateFileStatus(x,"idle"),b.value+=x.size,r.noThumbnails!==!0&&x.type.toUpperCase().startsWith("IMAGE")){const ne=new Image;ne.src=window.URL.createObjectURL(x),x.__img=ne}}),e.files.value=e.files.value.concat(q),e.queuedFiles.value=e.queuedFiles.value.concat(q),g("added",q),r.autoUpload===!0&&e.upload())}function oe(){s.value===!0&&e.upload()}function G(t,p,q){if(t===!0){const Q={type:"a",key:p,icon:n.iconSet.uploader[p],flat:!0,dense:!0};let x;return p==="add"?(Q.onClick=_,x=ue):Q.onClick=q,c(K,Q,x)}}function ue(){return c("input",{ref:h,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:r.accept,multiple:r.multiple===!0?"multiple":void 0,capture:r.capture,onMousedown:ge,onClick:_,onChange:re})}function qe(){return o.header!==void 0?o.header(A):[c("div",{class:"q-uploader__header-content column"},[c("div",{class:"flex flex-center no-wrap q-gutter-xs"},[G(e.queuedFiles.value.length!==0,"removeQueue",X),G(e.uploadedFiles.value.length!==0,"removeUploaded",R),e.isUploading.value===!0?c(se,{class:"q-uploader__spinner"}):null,c("div",{class:"col column justify-center"},[r.label!==void 0?c("div",{class:"q-uploader__title"},[r.label]):null,c("div",{class:"q-uploader__subtitle"},[y.value+" / "+m.value])]),G(I.value,"add"),G(r.hideUploadBtn===!1&&s.value===!0,"upload",e.upload),G(e.isUploading.value,"clear",e.abort)])])]}function xe(){return o.list!==void 0?o.list(A):e.files.value.map(t=>c("div",{key:t.__key,class:"q-uploader__file relative-position"+(r.noThumbnails!==!0&&t.__img!==void 0?" q-uploader__file--img":"")+(t.__status==="failed"?" q-uploader__file--failed":t.__status==="uploaded"?" q-uploader__file--uploaded":""),style:r.noThumbnails!==!0&&t.__img!==void 0?{backgroundImage:'url("'+t.__img.src+'")',backgroundSize:r.thumbnailFit}:null},[c("div",{class:"q-uploader__file-header row flex-center no-wrap"},[t.__status==="failed"?c(be,{class:"q-uploader__file-status",name:n.iconSet.type.negative,color:"negative"}):null,c("div",{class:"q-uploader__file-header-content col"},[c("div",{class:"q-uploader__title"},[t.name]),c("div",{class:"q-uploader__subtitle row items-center no-wrap"},[t.__sizeLabel+" / "+t.__progressLabel])]),t.__status==="uploading"?c(Ze,{value:t.__progress,min:0,max:1,indeterminate:t.__progress===0}):c(K,{round:!0,dense:!0,flat:!0,icon:n.iconSet.uploader[t.__status==="uploaded"?"done":"clear"],onClick:()=>{Y(t)}})])]))}Pe(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&te()});const A={};for(const t in e)Le(e[t])===!0?Ne(A,t,()=>e[t].value):A[t]=e[t];return Object.assign(A,{upload:oe,reset:O,removeUploadedFiles:R,removeQueuedFiles:X,removeFile:Y,pickFiles:_,addFiles:U}),Re(A,{canAddFiles:()=>I.value,canUpload:()=>s.value,uploadSizeLabel:()=>y.value,uploadProgressLabel:()=>m.value}),v({...e,upload:oe,reset:O,removeUploadedFiles:R,removeQueuedFiles:X,removeFile:Y,pickFiles:_,addFiles:U,canAddFiles:I,canUpload:s,uploadSizeLabel:y,uploadProgressLabel:m}),()=>{const t=[c("div",{class:D.value},qe()),c("div",{class:"q-uploader__list scroll"},xe()),j("uploader")];e.isBusy.value===!0&&t.push(c("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[c(se)]));const p={ref:B,class:$.value};return I.value===!0&&Object.assign(p,{onDragover:f,onDragleave:l}),c("div",p,t)}}const oa=()=>!0;function ua(a){const v={};return a.forEach(u=>{v[u]=oa}),v}const na=ua(Se),sa=({name:a,props:v,emits:u,injectPlugin:r})=>pe({name:a,props:{...la,...v},emits:Te(u)===!0?{...na,...u}:[...Se,...u],setup(o,{expose:g}){return ra(r,g)}});function T(a){return typeof a=="function"?a:()=>a}const ia="QUploader",da={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>a=>a.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},ca=["factoryFailed","uploaded","failed","uploading"];function va({props:a,emit:v,helpers:u}){const r=z([]),o=z([]),g=z(0),d=F(()=>({url:T(a.url),method:T(a.method),headers:T(a.headers),formFields:T(a.formFields),fieldName:T(a.fieldName),withCredentials:T(a.withCredentials),sendRaw:T(a.sendRaw),batch:T(a.batch)})),n=F(()=>g.value>0),S=F(()=>o.value.length!==0);let N;function w(){r.value.forEach(e=>{e.abort()}),o.value.length!==0&&(N=!0)}function E(){const e=u.queuedFiles.value.slice(0);u.queuedFiles.value=[],d.value.batch(e)?B(e):e.forEach(_=>{B([_])})}function B(e){if(g.value++,typeof a.factory!="function"){h(e,{});return}const _=a.factory(e);if(!_)v("factoryFailed",new Error("QUploader: factory() does not return properly"),e),g.value--;else if(typeof _.catch=="function"&&typeof _.then=="function"){o.value.push(_);const U=f=>{u.isAlive()===!0&&(o.value=o.value.filter(l=>l!==_),o.value.length===0&&(N=!1),u.queuedFiles.value=u.queuedFiles.value.concat(e),e.forEach(l=>{u.updateFileStatus(l,"failed")}),v("factoryFailed",f,e),g.value--)};_.then(f=>{N===!0?U(new Error("Aborted")):u.isAlive()===!0&&(o.value=o.value.filter(l=>l!==_),h(e,f))}).catch(U)}else h(e,_||{})}function h(e,_){const U=new FormData,f=new XMLHttpRequest,l=(s,$)=>_[s]!==void 0?T(_[s])($):d.value[s]($),C=l("url",e);if(!C){console.error("q-uploader: invalid or no URL specified"),g.value--;return}const j=l("formFields",e);j!==void 0&&j.forEach(s=>{U.append(s.name,s.value)});let M=0,i=0,b=0,P=0,m;f.upload.addEventListener("progress",s=>{if(m===!0)return;const $=Math.min(P,s.loaded);u.uploadedSize.value+=$-b,b=$;let D=b-i;for(let O=M;D>0&&O<e.length;O++){const R=e[O];if(D>R.size)D-=R.size,M++,i+=R.size,u.updateFileStatus(R,"uploading",R.size);else{u.updateFileStatus(R,"uploading",D);return}}},!1),f.onreadystatechange=()=>{f.readyState<4||(f.status&&f.status<400?(u.uploadedFiles.value=u.uploadedFiles.value.concat(e),e.forEach(s=>{u.updateFileStatus(s,"uploaded")}),v("uploaded",{files:e,xhr:f})):(m=!0,u.uploadedSize.value-=b,u.queuedFiles.value=u.queuedFiles.value.concat(e),e.forEach(s=>{u.updateFileStatus(s,"failed")}),v("failed",{files:e,xhr:f})),g.value--,r.value=r.value.filter(s=>s!==f))},f.open(l("method",e),C),l("withCredentials",e)===!0&&(f.withCredentials=!0);const y=l("headers",e);y!==void 0&&y.forEach(s=>{f.setRequestHeader(s.name,s.value)});const I=l("sendRaw",e);e.forEach(s=>{u.updateFileStatus(s,"uploading",0),I!==!0&&U.append(l("fieldName",s),s,s.name),s.xhr=f,s.__abort=()=>{f.abort()},P+=s.size}),v("uploading",{files:e,xhr:f}),r.value.push(f),I===!0?f.send(new Blob(e)):f.send(U)}return{isUploading:n,isBusy:S,abort:w,upload:E}}const fa={name:ia,props:da,emits:ca,injectPlugin:va},ma=sa(fa),pa={class:"q-pa-md"},ga={class:"q-gutter-sm row items-start"},za={__name:"UpdateMenu",setup(a){const v=Je();let u;u="/upload";function r({xhr:d}){const n=JSON.parse(d.response);n.success?(V.refreshMenuSignal(),v.notify({type:"positive",message:"上传成功"})):v.notify({type:"negative",message:n.msg})}const o=z([]);function g(){const d=[];for(let n=0;n<o.value.length;n++)d.push(o.value[n].name);V.orderMenuTab.value=d,V.updateMenuIndex(d)}return he(V.orderMenuTab,d=>{if(d){const n=[];for(let S=0;S<V.orderMenuTab.value.length;S++)n.push({id:S,name:V.orderMenuTab.value[S]});o.value=n}},{immediate:!0}),(d,n)=>(Me(),je($e,null,[k(Ve,null,{default:L(()=>[k(We,null,{default:L(()=>[k(ve,{class:"q-pa-lg"},{default:L(()=>[k(K,{label:"back to main page",to:"/",color:"secondary",class:"q-mt-md"}),H("div",pa,[n[1]||(n[1]=H("p",null,"上传菜单",-1)),H("div",ga,[k(ma,{url:ie(u),onUploaded:r,onFailed:d.onFail,style:{"max-width":"300px"}},null,8,["url","onFailed"])])])]),_:1})]),_:1})]),_:1}),k(ve,{class:"q-pa-md"},{default:L(()=>[n[3]||(n[3]=H("div",{class:"q-mb-md"},[H("div",{class:"text-h5"},"menu")],-1)),k(ie(Xe),{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=S=>o.value=S),handle:".handle","item-key":"id"},{item:L(({element:S})=>[k(De,{class:"q-mb-sm"},{default:L(()=>[k(Ge,null,{default:L(()=>[k(fe,{avatar:""},{default:L(()=>[k(be,{name:"drag_indicator",class:"handle cursor-grab"})]),_:1}),k(fe,null,{default:L(()=>[k(He,null,{default:L(()=>[de(Oe(S.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),k(K,{color:"primary",onClick:g},{default:L(()=>n[2]||(n[2]=[de("Update Menu Index")])),_:1,__:[2]})]),_:1,__:[3]})],64))}};export{za as default};
