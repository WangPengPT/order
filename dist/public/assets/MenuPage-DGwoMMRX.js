import{Q as W,a as F}from"./QTable-qAMEHVZD.js";import{Q as N,a as b}from"./QTd-UxPF7wJm.js";import{b as y,B as X,n as V,d as _,o as p,f as i,a as n,w as t,e as P,V as h,i as m,h as s,C as Y,m as C,a0 as S,c as Q,k as q,_ as D,Z as z,a1 as ee,Q as Z,j as $,a2 as G}from"./index-B4W4IOVg.js";import{Q as le}from"./QItemLabel-BL8XTJCU.js";import{Q as ae}from"./QItem-BAV-wZgr.js";import{a as ne}from"./QField-C0XQyJT-.js";import{Q as I}from"./QSpace-Dt_4Y91y.js";import{Q as H}from"./QToolbar-CMOk5gYT.js";import{C as T}from"./ClosePopup-BJz7rXtJ.js";import{u as ue}from"./use-quasar-D-q4ic6k.js";import"./format-CJebrXOQ.js";const de={class:"q-pa-md"},te={style:{display:"flex",gap:"16px"}},oe={style:{display:"flex",gap:"16px"}},se={style:{display:"flex",gap:"16px"}},Ce={__name:"MenuPage",setup(ie){const M=ue(),J=[{name:"id",required:!0,label:"id",align:"left",field:u=>u.id,format:u=>`${u}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:u=>u.name,format:u=>`${u}`,sortable:!0,style:"max-width: 50px;"}],B=y(""),x=y([]),r=y(null),a=y({});let f=["name","note","subname"];const U=["","_en","_cn"];let g=["id","price","category","tags"];const k=y(!1);function R(u,l){v=void 0,k.value=!0,c(l)}const w=y(!1);function K(u){v=void 0,w.value=!0,c(u)}function c(u,l){L=l,r.value=u;for(let e=0;e<f.length;e++)a.value[f[e]]=u[f[e]],a.value[f[e]+"_en"]=u[f[e]+"_en"],a.value[f[e]+"_cn"]=u[f[e]+"_cn"];a.value.disable=u.disable||!1;for(let e=0;e<g.length;e++)a.value[g[e]]=u[g[e]]}let L=!1;function j(){console.log("apply dish");let u={},l=!1;for(let e=0;e<f.length;e++)for(let d=0;d<U.length;d++){const o=f[e]+U[d];r.value[o]!=a.value[o]&&(u[o]=a.value[o],l=!0)}for(let e=0;e<g.length;e++){let d=g[e];r.value[d]!=a.value[d]&&(l=!0,u[d]=a.value[d])}if(r.value.disable?a.value.disable||(l=!0,u.disable=!1):a.value.disable&&(l=!0,u.disable=!0),console.log("need_update：",r.value,a.value),console.log("need_update：",l),!l){M.notify({type:"negative",message:"There is no data changed!"});return}if(l){let e=!1;if(a.value.id=a.value.id.trim(),a.value.id!="")if(a.value.id==r.value.id)e=!0;else{e=!0;for(let d=0;d<V.menuData.length;d++)if(a.value.id==V.menuData[d].id){console.log("has old id : ",a.value,V.menuData[d]),e=!1;break}}if(!e){M.notify({type:"negative",message:`invalid id: ${a.value.id}`}),console.log("check_ok is: ",e);return}if(L)u={...a.value},V.menuData.push(u),v?(v.subitems||(v.subitems=[v]),v.subitems.push(u),u.handle=r.value.handle):(u.handle="handle_"+u.id,x.value.push(u));else{u.org_id=r.value.id;for(let d=0;d<f.length;d++)for(let o=0;o<U.length;o++){const E=f[d]+U[o];r.value[E]=a.value[E]}r.value.disable=a.value.disable;for(let d=0;d<g.length;d++){let o=g[d];r.value[o]=a.value[o]}}w.value=!1,k.value=!1,V.updateMenuItem(u),console.log("update apply dish",u)}}let v;function A(u){v=u;let l={id:"",handle:u.handle,category:u.category,subname:"",price:"0"};w.value=!0,c(l,!0)}function O(){v=void 0;let u={id:"",handle:"",category:"",subname:"",price:"0"};k.value=!0,c(u,!0)}return X(()=>{console.log("..... onMounted ...");const u=[],l={};for(let e=0;e<V.menuData.length;e++){let d=V.menuData[e];if(l[d.handle]){let o=l[d.handle];o.subitems||(o.subitems=[o]),o.subitems.push(d)}else l[d.handle]=d,u.push(d)}x.value=u,console.log(x.value)}),(u,l)=>(p(),_(h,null,[i("div",de,[n(W,{title:"Dishes",rows:x.value,columns:J,"row-key":"id",filter:B.value,onRowClick:R},{header:t(e=>[n(N,{props:e},{default:t(()=>[n(F,{"auto-width":""}),(p(!0),_(h,null,S(e.cols,d=>(p(),Q(F,{key:d.name,props:e},{default:t(()=>[q(D(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(e=>[n(N,{props:e},{default:t(()=>[n(b,{"auto-width":""},{default:t(()=>[n(m,{size:"sm",color:e.row.subitems?"accent":"primary",round:"",dense:"",onClick:d=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(p(!0),_(h,null,S(e.cols,d=>(p(),Q(b,{key:d.name,props:e},{default:t(()=>[q(D(d.value),1)]),_:2},1032,["props"]))),128)),n(b,{"auto-width":""},{default:t(()=>[n(m,{color:"primary",dense:"",onClick:d=>R(null,e.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),C(n(N,{props:e},{default:t(()=>[e.row.subitems?z("",!0):(p(),Q(b,{key:0,colspan:"100%"},{default:t(()=>[n(m,{color:"primary",dense:"",onClick:d=>A(e.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),e.row.subitems?(p(),Q(b,{key:1,colspan:"100%"},{default:t(()=>[n(m,{color:"primary",dense:"",onClick:d=>A(e.row),label:"add new"},null,8,["onClick"]),n(ne,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:t(()=>[n(le,{header:""},{default:t(()=>l[21]||(l[21]=[q("sub item")])),_:1,__:[21]}),(p(!0),_(h,null,S(e.row.subitems,d=>(p(),Q(ae,{key:d.id},{default:t(()=>[n(b,{style:{width:"50px"}},{default:t(()=>[q(D(d.id),1)]),_:2},1024),n(b,{style:{width:"150px"}},{default:t(()=>[q(D(d.subname),1)]),_:2},1024),n(b,{"auto-width":""},{default:t(()=>[n(m,{color:"primary",dense:"",onClick:o=>K(d),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):z("",!0)]),_:2},1032,["props"]),[[ee,e.expand]])]),"top-right":t(()=>[n(m,{class:"q-mr-lg",color:"primary",dense:"",onClick:l[0]||(l[0]=e=>O()),label:"add new"}),n(s,{borderless:"",dense:"",debounce:"300",modelValue:B.value,"onUpdate:modelValue":l[1]||(l[1]=e=>B.value=e),placeholder:"Search"},{append:t(()=>[n(Y,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),n(P,{modelValue:k.value,"onUpdate:modelValue":l[13]||(l[13]=e=>k.value=e),"full-height":"","full-width":""},{default:t(()=>[n(Z,null,{default:t(()=>[n($,{class:"row items-center q-pb-none"},{default:t(()=>[l[22]||(l[22]=i("div",{class:"text-h6"},"Edit Dish",-1)),n(I),C(n(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[T]])]),_:1,__:[22]}),n($,{class:"q-pa-sm q-gutter-sm"},{default:t(()=>[n(G,{modelValue:a.value.disable,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),l[23]||(l[23]=i("div",{class:"q-ma-lg"},null,-1)),n(s,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.name=e),label:"name(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.name_en,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.name_en=e),label:"name(english)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.name_cn,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.name_cn=e),label:"name(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[24]||(l[24]=i("div",{class:"q-ma-lg"},null,-1)),n(s,{outlined:"",modelValue:a.value.note,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.note=e),label:"descript(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.note_en,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.note_en=e),label:"descript(english)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.note_cn,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.note_cn=e),label:"descript(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[25]||(l[25]=i("div",{class:"q-ma-lg"},null,-1)),i("div",te,[n(s,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),n(s,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),i("div",oe,[n(s,{outlined:"",modelValue:a.value.category,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.category=e),label:"category",style:{flex:"1"}},null,8,["modelValue"]),n(s,{outlined:"",modelValue:a.value.tags,"onUpdate:modelValue":l[12]||(l[12]=e=>a.value.tags=e),label:"tags",style:{flex:"1"}},null,8,["modelValue"])]),l[26]||(l[26]=i("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[23,24,25,26]}),n(H,{class:"q-gutter-lg q-mb-lg"},{default:t(()=>[n(I),C(n(m,{align:"right",label:"Cancel"},null,512),[[T]]),n(m,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(P,{modelValue:w.value,"onUpdate:modelValue":l[20]||(l[20]=e=>w.value=e),"full-height":"","full-width":""},{default:t(()=>[n(Z,null,{default:t(()=>[n($,{class:"row items-center q-pb-none"},{default:t(()=>[l[27]||(l[27]=i("div",{class:"text-h6"},"Edit Item",-1)),n(I),C(n(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[T]])]),_:1,__:[27]}),n($,{class:"q-pa-sm q-gutter-sm"},{default:t(()=>[n(G,{modelValue:a.value.disable,"onUpdate:modelValue":l[14]||(l[14]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),l[28]||(l[28]=i("div",{class:"q-ma-lg"},null,-1)),n(s,{outlined:"",modelValue:a.value.subname,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.subname=e),label:"subname(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.subname_en,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.subname_en=e),label:"subname(english)",dense:u.dense},null,8,["modelValue","dense"]),n(s,{outlined:"",modelValue:a.value.subname_cn,"onUpdate:modelValue":l[17]||(l[17]=e=>a.value.subname_cn=e),label:"subname(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[29]||(l[29]=i("div",{class:"q-ma-lg"},null,-1)),i("div",se,[n(s,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[18]||(l[18]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),n(s,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),l[30]||(l[30]=i("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[28,29,30]}),n(H,{class:"q-gutter-lg q-mb-lg"},{default:t(()=>[n(I),C(n(m,{align:"right",label:"Cancel"},null,512),[[T]]),n(m,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ce as default};
