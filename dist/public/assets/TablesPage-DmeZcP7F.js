import{Q as H,a as N}from"./QItem-BDUJgJy7.js";import{a as ue,Q as Ce}from"./rtl-DfejLkLV.js";import{i as ke,aK as he,T as I,U as m,a3 as R,aa as G,V as l,aL as U,$ as q,b as W,w as X,R as we,a6 as T,W as i,a8 as $,Y as w,aM as de,a9 as O,X as Z,c as ee,r as h,E as xe,F as Se,j as Me,g as ce,h as J,e as K,aj as qe,m as le,A as L,aN as Oe,G as $e,aO as Ee,_ as z,a2 as Y,a0 as te,P as Qe,x as _,Z as D,ai as Pe,aP as Ve,a1 as P,aQ as Ae,aR as Be,aJ as ae,a4 as V}from"./index-DzrAy36N.js";import{C as oe}from"./ClosePopup-fnot_Sp9.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Fe,Q as Ne,b as ie}from"./QTable-BX-d3C9t.js";import{C as je,Q as Ie}from"./CodeMaker-3r3752K-.js";import"./format-BRdZI-Ss.js";import"./_commonjsHelpers-Bx2EM-6T.js";function Re(){return ke(he)}const Ue={class:"tabs row q-gutter-sm"},Le={__name:"FilterTabs",props:{filterStatus:String},setup(e){const u=e,a=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function d(t){if(t===u.filterStatus)switch(t){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(t,s)=>(m(),I("div",Ue,[(m(),I(R,null,G(a,p=>l(q,{key:p.value,label:p.label,flat:e.filterStatus!==p.value,unelevated:!0,class:U(d(p.value)),onClick:r=>t.$emit("update:filterStatus",p.value)},null,8,["label","flat","class","onClick"])),64))]))}};function be(e,u){var a,d,t;try{a=e.toString().split(".")[1].length}catch{a=0}try{d=u.toString().split(".")[1].length}catch{d=0}return t=Math.pow(10,Math.max(a,d)),(ne(e,t)+ne(u,t))/t}function ne(e,u){var a=0,d=e.toString(),t=u.toString();try{a+=d.split(".")[1].length}catch{}try{a+=t.split(".")[1].length}catch{}return Number(d.replace(".",""))*Number(t.replace(".",""))/Math.pow(10,a)}const ze={class:"text-h6 text-weight-bolder"},De={class:"status-text"},He={class:"text-subtitle2 text-weight-bolder"},Ge={__name:"TableCard",props:{table:Object,editMode:Boolean,price:Object},setup(e){const u=e;function a(){if(!u.table.order||u.table.order.length===0)return"0.00";const t=parseFloat(u.table.order.reduce((p,r)=>p+r.price*r.quantity,0).toFixed(2));let s=u.table.peopleType.adults*u.price.adult+u.table.peopleType.childres*u.price.children;return be(t,s)}const d=W(()=>{switch(u.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});return(t,s)=>X((m(),T(Z,{class:U(["table-card",d.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:s[1]||(s[1]=()=>t.$emit("selectTable",e.table.id))},{default:i(()=>[e.editMode?(m(),T(q,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:s[0]||(s[0]=de(()=>t.$emit("removeTable",e.table.id),["stop"]))})):$("",!0),w("div",null,[w("div",ze," Mesa "+O(e.table.id),1),w("div",De,O(e.table.status),1),w("div",null,O(e.table.people)+" Pessoas ",1),w("div",He," €"+O(a()),1)])]),_:1},8,["class"])),[[we]])}},Je=fe(Ge,[["__scopeId","data-v-37ff7923"]]),Ke={class:"table-grid q-pa-lg"},We={__name:"TableGrid",props:{tables:Array,editMode:Boolean,price:Object},setup(e){return console.log("recive tables: ",e.tables),(a,d)=>(m(),I("div",Ke,[(m(!0),I(R,null,G(e.tables,t=>(m(),T(Je,{key:t.id,table:t,editMode:e.editMode,onSelectTable:()=>a.$emit("selectTable",t.id),onRemoveTable:()=>a.$emit("removeTable",t.id),price:e.price},null,8,["table","editMode","onSelectTable","onRemoveTable","price"]))),128))]))}},Ze=fe(We,[["__scopeId","data-v-d9f5808a"]]),me=ee({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:u,emit:a}){const d=ce(),t=h(null);let s=0;const p=[];function r(o){const x=typeof o=="boolean"?o:e.noErrorFocus!==!0,A=++s,n=(c,M)=>{a(`validation${c===!0?"Success":"Error"}`,M)},b=c=>{const M=c.validate();return typeof M.then=="function"?M.then(E=>({valid:E,comp:c}),E=>({valid:!1,comp:c,err:E})):Promise.resolve({valid:M,comp:c})};return(e.greedy===!0?Promise.all(p.map(b)).then(c=>c.filter(M=>M.valid!==!0)):p.reduce((c,M)=>c.then(()=>b(M).then(E=>{if(E.valid===!1)return Promise.reject(E)})),Promise.resolve()).catch(c=>[c])).then(c=>{if(c===void 0||c.length===0)return A===s&&n(!0),!0;if(A===s){const{comp:M,err:E}=c[0];if(E!==void 0&&console.error(E),n(!1,M),x===!0){const F=c.find(({comp:j})=>typeof j.focus=="function"&&qe(j.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function k(){s++,p.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function C(o){o!==void 0&&le(o);const x=s+1;r().then(A=>{x===s&&A===!0&&(e.onSubmit!==void 0?a("submit",o):o?.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function f(o){o!==void 0&&le(o),a("reset"),L(()=>{k(),e.autofocus===!0&&e.noResetFocus!==!0&&g()})}function g(){Oe(()=>{if(t.value===null)return;(t.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(t.value.querySelectorAll("[tabindex]"),x=>x.tabIndex!==-1))?.focus({preventScroll:!0})})}$e(Ee,{bindComponent(o){p.push(o)},unbindComponent(o){const x=p.indexOf(o);x!==-1&&p.splice(x,1)}});let B=!1;return xe(()=>{B=!0}),Se(()=>{B===!0&&e.autofocus===!0&&g()}),Me(()=>{e.autofocus===!0&&g()}),Object.assign(d.proxy,{validate:r,resetValidation:k,submit:C,reset:f,focus:g,getValidationComponents:()=>p}),()=>J("form",{class:"q-form",ref:t,onSubmit:C,onReset:f},K(u.default))}}),Xe={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(e,{emit:u}){const a=u,d=h("");function t(){a("submit",d.value),a("update:visible",!1),d.value=""}function s(){a("close")}return(p,r)=>(m(),T(te,{persistent:"","model-value":e.visible},{default:i(()=>[l(Z,{style:{"min-width":"400px"}},{default:i(()=>[l(me,{onSubmit:t,onClick:de(s,["stop"])},{default:i(()=>[l(z,{filled:"",modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=k=>d.value=k),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[k=>k&&k.length>0||"Por favor, escreve algo",k=>!isNaN(k)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),l(Y,{align:"right"},{default:i(()=>[w("div",null,[l(q,{label:"Submeter",type:"submit",color:"primary"}),l(q,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm"})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ye={class:U(["col-4","justify-between","row"])},_e={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","autoClose","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(e,{emit:u}){const a=e,d=h(!0),t=["Livre","Ocupado","Pago","Reservado"],s=u,p=h(null),r=Qe({id:null,people:0,peopleType:{adults:0,children:0},status:""});_(()=>a.visible,async C=>{C&&a.table?.id&&(Object.assign(r,JSON.parse(JSON.stringify(a.table))),await L(),k(),r.status==="Livre"&&(await L(),s("tableEditableMode")))},{immediate:!0}),_(()=>[r.peopleType.adults,r.peopleType.childres],([C,f])=>{const g=parseInt(C)||0,B=parseInt(f)||0;r.people=g+B});async function k(){if(d.value=!0,await L(),!p.value||!a.table.id){console.warn("Canvas not ready or table ID missing");return}const C=window.global_qr_addr+je.SimpleEncode(a.table.id);console.log("qrcoed data: ",C),Ie.toCanvas(p.value,C,{width:150},f=>{f?(console.error("二维码生成失败",f),setTimeout(()=>k(),300)):d.value=!1})}return(C,f)=>(m(),T(te,{"model-value":e.visible,onHide:f[9]||(f[9]=()=>C.$emit("autoClose"))},{default:i(()=>[l(Z,{style:{"min-width":"400px"}},{default:i(()=>[l(me,{onSubmit:f[8]||(f[8]=()=>C.$emit("submit",r)),class:"q-ma-lg"},{default:i(()=>[w("h3",null,"桌号 "+O(r.id),1),l(z,{modelValue:r.people,"onUpdate:modelValue":f[0]||(f[0]=g=>r.people=g),label:"Quantidade de Cliente",type:"number",disable:"",readonly:""},null,8,["modelValue"]),l(z,{modelValue:r.peopleType.adults,"onUpdate:modelValue":f[1]||(f[1]=g=>r.peopleType.adults=g),label:"Adultos",type:"number",disable:!e.editable},null,8,["modelValue","disable"]),l(z,{modelValue:r.peopleType.childres,"onUpdate:modelValue":f[2]||(f[2]=g=>r.peopleType.childres=g),label:"Crianças",type:"number",disable:!e.editable},null,8,["modelValue","disable"]),l(Fe,{modelValue:r.status,"onUpdate:modelValue":f[3]||(f[3]=g=>r.status=g),options:t,disable:!e.editable},null,8,["modelValue","disable"]),l(D,{class:"flex flex-center",style:{"min-height":"160px"}},{default:i(()=>[d.value?(m(),T(Pe,{key:0,color:"primary",size:"2em"})):$("",!0),w("canvas",{ref_key:"qrCanvas",ref:p,style:Ve({display:d.value?"none":"block",marginTop:"8px"})},null,4)]),_:1}),w("div",Ye,[r.status!="空闲"?(m(),T(q,{key:0,color:"deep-orange",glossy:"",label:"Limpar mesa",onClick:f[4]||(f[4]=()=>C.$emit("cleanTable",r.id))})):$("",!0),l(q,{color:"primary",label:"Visualizar pedidos",onClick:f[5]||(f[5]=()=>C.$emit("showTableOrders"))}),e.editable?$("",!0):(m(),T(q,{key:1,color:"secondary",label:"Editar",onClick:f[6]||(f[6]=()=>C.$emit("tableEditableMode"))})),e.editable?(m(),T(q,{key:2,color:"white","text-color":"black",label:"Cancelar",onClick:f[7]||(f[7]=()=>C.$emit("editableModeBack"))})):$("",!0),e.editable?(m(),T(q,{key:3,color:"primary",type:"submit",label:"Salvar"})):$("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},se=ee({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:u}){const a=W(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>J("tr",{style:e.props?.__trStyle,class:a.value},K(u.default))}}),re=ee({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:u}){const a=ce(),d=W(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return J("td",{class:d.value},K(u.default));const t=a.vnode.key,s=(e.props.colsMap!==void 0?e.props.colsMap[t]:null)||e.props.col;if(s===void 0)return;const{row:p}=e.props;return J("td",{class:d.value+s.__tdClass(p),style:s.__tdStyle(p)},K(u.default))}}}),et={class:"text-h6"},tt={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},lt={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:Object,price:Object},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose"],setup(e,{emit:u}){const a=h({rowsPerPage:0}),d=h(""),t=h(!1);function s(n){return t.value?n.filter(b=>b.price>0):n}function p(){t.value&&(d.value=t.value?"price>0":"")}const r=e,k=u;function C(){A(),t.value=!1,k("autoClose")}const f=[{name:"name",required:!0,label:"nome",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0},{name:"quantity",required:!0,label:"quandidade",align:"left",field:n=>n.quantity,format:n=>`${n}`,sortable:!0},{name:"price/uni",required:!0,label:"Preço/uni",align:"left",field:n=>n.price,format:n=>`${n}`,sortable:!0},{name:"price",required:!0,label:"Preço",align:"left",field:n=>n.price*n.quantity,format:n=>`${n.toFixed(2)}`,sortable:!0}],g=h([]);function B(n){const b=o.value.findIndex(y=>y.dishid===n.dishid);if(b!==-1)if(o.value[b].quantity-=1,o.value[b].quantity<=0){const y=o.value.splice(b,1)[0],c=g.value.findIndex(M=>M.dishid===y.dishid);c!==-1?g.value[c].quantity+=1:g.value.push({dishid:y.dishid,quantity:1})}else{const y=g.value.findIndex(c=>c.dishid===n.dishid);y!==-1?g.value[y].quantity+=1:g.value.push({dishid:n.dishid,quantity:1})}}const o=h([]);_(()=>r.table.order,n=>{Array.isArray(n)?o.value=n.map(b=>({...b})):o.value=[]},{immediate:!0});function x(){if(!o.value||o.value.length===0)return"0.00";const n=parseFloat(o.value.reduce((y,c)=>y+c.price*c.quantity,0).toFixed(2));let b=r.table.peopleType.adults*r.price.adult+r.table.peopleType.childres*r.price.children;return be(n,b)}function A(){o.value=r.table.order.map(n=>({...n})),k("cancelOrderEdit")}return(n,b)=>(m(),T(te,{"model-value":e.visible,onHide:C},{default:i(()=>[l(Z,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:i(()=>[l(D,null,{default:i(()=>[w("div",et,"Mesa "+O(e.table.id),1)]),_:1}),l(ue,{bordered:""},{default:i(()=>[l(H,null,{default:i(()=>[l(N,null,{default:i(()=>b[5]||(b[5]=[P(" Adulto ")])),_:1,__:[5]}),l(N,null,{default:i(()=>[P("Quantidade: "+O(e.table.peopleType.adults),1)]),_:1}),l(N,null,{default:i(()=>[P("Preço/uni: €"+O(e.price.adult),1)]),_:1})]),_:1}),l(H,null,{default:i(()=>[l(N,null,{default:i(()=>b[6]||(b[6]=[P(" Criança ")])),_:1,__:[6]}),l(N,null,{default:i(()=>[P("Quantidade: "+O(e.table.peopleType.childres),1)]),_:1}),l(N,null,{default:i(()=>[P("Preço/uni: €"+O(e.price.children),1)]),_:1})]),_:1})]),_:1}),Array.isArray(o.value)&&o.value.length>0?(m(),T(D,{key:0,class:"q-pa-md"},{default:i(()=>[l(Ne,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:o.value,"virtual-scroll":"",filter:d.value,"filter-method":s,columns:f,pagination:a.value,"onUpdate:pagination":b[0]||(b[0]=y=>a.value=y),"rows-per-page-options":[0],"row-key":"id"},Ae({_:2},[e.editMode?{name:"header",fn:i(y=>[l(se,{props:y},{default:i(()=>[l(ie,{"auto-width":""}),(m(!0),I(R,null,G(y.cols,c=>(m(),T(ie,{key:c.name,props:y},{default:i(()=>[P(O(c.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,e.editMode?{name:"body",fn:i(y=>[l(se,{props:y},{default:i(()=>[l(re,{"auto-width":""},{default:i(()=>[l(q,{size:"sm",color:"accent",round:"",dense:"",onClick:c=>B(y.row),icon:"remove"},null,8,["onClick"])]),_:2},1024),(m(!0),I(R,null,G(y.cols,c=>(m(),T(re,{key:c.name,props:y},{default:i(()=>[P(O(c.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(m(),T(D,{key:1},{default:i(()=>b[7]||(b[7]=[P(" Nothing ")])),_:1,__:[7]})),l(Y,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:i(()=>[l(Y,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:i(()=>[w("div",tt," Total: €"+O(x()),1)]),_:1}),e.editMode?$("",!0):(m(),T(Be,{key:0,modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=y=>t.value=y),color:"green",onClick:b[2]||(b[2]=y=>p()),label:"No Zero"},null,8,["modelValue"])),e.editMode?(m(),T(q,{key:1,color:"white","text-color":"black",label:"Cancelar",onClick:A})):$("",!0),e.editMode?(m(),T(q,{key:2,color:"primary",label:"Salvar",onClick:b[3]||(b[3]=y=>n.$emit("saveOrder",[...g.value]))})):$("",!0),e.editMode?$("",!0):(m(),T(q,{key:3,color:"primary",label:"Editar",onClick:b[4]||(b[4]=()=>n.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},at={class:U(["tables-page","row","no-wrap","justify-between"])},bt={__name:"TablesPage",setup(e){const u=Re(),a=h("Livre"),d=h(!1),t=h(!1),s=h(null),p=W(()=>a.value==="Todos"?V.tables.value:V.tables.value.filter(S=>S.status===a.value));function r(){d.value=!0}function k(){d.value=!1}function C(S){u.dialog({title:"Confimação de eliminação",message:`Tem certeza quer eliminar a mesa ${S} ? Esta operação não é recuperável.`,cancel:!0,persistent:!0}).onOk(()=>{const v=V.deleteTable(S);v!=null&&u.dialog({title:"Erro",message:v.message})})}function f(){t.value=!0}function g(S){V.addNewTable(S)}function B(){t.value=!1}const o=h(!1),x=h(!1);function A(S){s.value=V.tables.value.find(v=>v.id===S),o.value=!0}function n(){x.value=!0}function b(S){const v=V.updateTable(S);v&&u.dialog(v),x.value=!1}function y(){x.value=!1,o.value=!1}function c(){x.value=!1}function M(S){u.dialog({title:"Confirmação de limpeza",message:`Tem a certeza que deseja limpar a mesa ${S}? Isto irá remover todos os clientes e definir o estado como 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const v=V.tableClean(S);v&&u.dialog(v)})}function E(){F.value=!0}const F=h(!1),j=h(!1);function ve(){F.value=!1}function pe(){j.value=!0}function ye(S){V.deleteOrders(s.value.id,S),j.value=!1}function ge(){j.value=!1}function Te(){F.value=!1}return(S,v)=>(m(),I(R,null,[w("div",at,[l(Le,{filterStatus:a.value,"onUpdate:filterStatus":v[0]||(v[0]=Q=>a.value=Q)},null,8,["filterStatus"]),l(q,{color:"primary",icon:d.value?"close":"edit",class:U(["q-pa-md"]),onClick:k},{default:i(()=>[d.value?$("",!0):(m(),T(Ce,{key:0},{default:i(()=>[l(ue,{style:{"min-width":"100px"}},{default:i(()=>[X((m(),T(H,{clickable:"",onClick:f},{default:i(()=>[l(N,null,{default:i(()=>v[6]||(v[6]=[P("Adicionar")])),_:1,__:[6]})]),_:1})),[[oe]]),X((m(),T(H,{clickable:"",onClick:r},{default:i(()=>[l(N,null,{default:i(()=>v[7]||(v[7]=[P("Editar")])),_:1,__:[7]})]),_:1})),[[oe]])]),_:1})]),_:1}))]),_:1},8,["icon"])]),v[8]||(v[8]=w("div",null,null,-1)),w("div",null,[l(Ze,{tables:p.value,editMode:d.value,onSelectTable:A,onRemoveTable:C,price:ae(V).getCurentPeoplePrice()},null,8,["tables","editMode","price"])]),w("div",null,[l(Xe,{onSubmit:g,onClose:B,visible:t.value,"onUpdate:visible":v[1]||(v[1]=Q=>t.value=Q)},null,8,["visible"])]),w("div",null,[s.value?(m(),T(_e,{key:0,visible:o.value,"onUpdate:visible":v[2]||(v[2]=Q=>o.value=Q),table:s.value,"onUpdate:table":v[3]||(v[3]=Q=>s.value=Q),editable:x.value,onTableEditableMode:n,onSubmit:b,onAutoClose:y,onEditableModeBack:c,onCleanTable:M,onShowTableOrders:E},null,8,["visible","table","editable"])):$("",!0)]),w("div",null,[s.value?(m(),T(lt,{key:0,visible:F.value,"onUpdate:visible":v[4]||(v[4]=Q=>F.value=Q),table:s.value,"onUpdate:table":v[5]||(v[5]=Q=>s.value=Q),onClose:ve,onSetEditMode:pe,editMode:j.value,onSaveOrder:ye,onCancelOrderEdit:ge,onAutoClose:Te,price:ae(V).getCurentPeoplePrice()},null,8,["visible","table","editMode","price"])):$("",!0)])],64))}};export{bt as default};
