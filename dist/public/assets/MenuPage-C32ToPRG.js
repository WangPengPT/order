import{Q as re,a as ae,b as me}from"./QTable-RwwXDGVn.js";import{Q as X,a as q}from"./QTd-CWkv2IlU.js";import{q as T,p as ge,b as v,N as te,a1 as ve,B as de,s as _,a2 as fe,t as ce,a3 as be,L as ye,a4 as Y,z as pe,n as k,d as L,o as h,f as d,a as o,w as i,e as ne,V as P,i as c,h as m,C as oe,m as z,a0 as ee,c as N,k as B,_ as H,Z as ue,a5 as Ve,Q as ie,j as R,a6 as O}from"./index-CebFqYmd.js";import{Q as he}from"./QItemLabel-BNsy_Qx9.js";import{Q as Se}from"./QItem-D-np_Dm9.js";import{a as we}from"./QField-7WesE5k3.js";import{Q as W}from"./QSpace-DCLJxJng.js";import{Q as se}from"./QToolbar-B86Vaz_h.js";import{C as Z}from"./ClosePopup-BkaP_XVA.js";import{u as ke}from"./use-quasar-DxDPmvif.js";import"./format-CJebrXOQ.js";const Ce={ratio:[String,Number]};function qe(u,b){return T(()=>{const C=Number(u.ratio||(b!==void 0?b.value:void 0));return isNaN(C)!==!0&&C>0?{paddingBottom:`${100/C}%`}:null})}const _e=1.7778,xe=ge({name:"QImg",props:{...Ce,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:_e},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(u,{slots:b,emit:C}){const D=v(u.initialRatio),x=qe(u,D),r=pe(),{registerTimeout:t,removeTimeout:S}=te(),{registerTimeout:f,removeTimeout:Q}=te(),y=T(()=>u.placeholderSrc!==void 0?{src:u.placeholderSrc}:null),U=T(()=>u.errorSrc!==void 0?{src:u.errorSrc,__qerror:!0}:null),p=[v(null),v(y.value)],g=v(0),I=v(!1),w=v(!1),F=T(()=>`q-img q-img--${u.noNativeMenu===!0?"no-":""}menu`),j=T(()=>({width:u.width,height:u.height})),V=T(()=>`q-img__image ${u.imgClass!==void 0?u.imgClass+" ":""}q-img__image--with${u.noTransition===!0?"out":""}-transition q-img__image--`),A=T(()=>({...u.imgStyle,objectFit:u.fit,objectPosition:u.position}));function G(){if(Q(),u.loadingShowDelay===0){I.value=!0;return}f(()=>{I.value=!0},u.loadingShowDelay)}function $(){Q(),I.value=!1}function M({target:e}){Y(r)===!1&&(S(),D.value=e.naturalHeight===0?.5:e.naturalWidth/e.naturalHeight,E(e,1))}function E(e,a){a===1e3||Y(r)===!0||(e.complete===!0?J(e):t(()=>{E(e,a+1)},50))}function J(e){Y(r)!==!0&&(g.value=g.value^1,p[g.value].value=null,$(),e.getAttribute("__qerror")!=="true"&&(w.value=!1),C("load",e.currentSrc||e.src))}function K(e){S(),$(),w.value=!0,p[g.value].value=U.value,p[g.value^1].value=y.value,C("error",e)}function n(e){const a=p[e].value,s={key:"img_"+e,class:V.value,style:A.value,alt:u.alt,crossorigin:u.crossorigin,decoding:u.decoding,referrerpolicy:u.referrerpolicy,height:u.height,width:u.width,loading:u.loading,fetchpriority:u.fetchpriority,"aria-hidden":"true",draggable:u.draggable,...a};return g.value===e?Object.assign(s,{class:s.class+"current",onLoad:M,onError:K}):s.class+="loaded",_("div",{class:"q-img__container absolute-full",key:"img"+e},_("img",s))}function l(){return I.value===!1?_("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ce(b[w.value===!0?"error":"default"])):_("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},b.loading!==void 0?b.loading():u.noSpinner===!0?void 0:[_(be,{color:u.spinnerColor,size:u.spinnerSize})])}{let e=function(){ye(()=>u.src||u.srcset||u.sizes?{src:u.src,srcset:u.srcset,sizes:u.sizes}:null,a=>{S(),w.value=!1,a===null?($(),p[g.value^1].value=y.value):G(),p[g.value].value=a},{immediate:!0})};ve.value===!0?de(e):e()}return()=>{const e=[];return x.value!==null&&e.push(_("div",{key:"filler",style:x.value})),p[0].value!==null&&e.push(n(0)),p[1].value!==null&&e.push(n(1)),e.push(_(fe,{name:"q-transition--fade"},l)),_("div",{key:"main",class:F.value,style:j.value,role:"img","aria-label":u.alt},e)}}}),Qe={class:"q-pa-md"},Ue={style:{display:"flex",gap:"16px"}},Te={key:1,class:"upload-placeholder"},De={style:{display:"flex",gap:"16px"}},Ie={style:{display:"flex",gap:"16px"}},Ne={style:{display:"flex",gap:"16px"}},He={__name:"MenuPage",setup(u){const b=ke(),C=[{name:"id",required:!0,label:"id",align:"left",field:n=>n.id,format:n=>`${n}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0,style:"max-width: 50px;"}],D=v(""),x=v([]),r=v(null),t=v({}),S=v([]);let f=["name","note","subname"];const Q=["","_en","_cn"];let y=["id","price","category","tags","image","soldout"];const U=v(!1);function p(n,l){V=void 0,U.value=!0,w(l)}const g=v(!1);function I(n){V=void 0,g.value=!0,w(n)}function w(n,l){F=l,r.value=n;for(let e=0;e<f.length;e++)t.value[f[e]]=n[f[e]],t.value[f[e]+"_en"]=n[f[e]+"_en"],t.value[f[e]+"_cn"]=n[f[e]+"_cn"];t.value.disable=n.disable||!1;for(let e=0;e<y.length;e++)t.value[y[e]]=n[y[e]]}let F=!1;function j(){console.log("apply dish");let n={},l=!1;for(let e=0;e<f.length;e++)for(let a=0;a<Q.length;a++){const s=f[e]+Q[a];r.value[s]!=t.value[s]&&(n[s]=t.value[s],l=!0)}for(let e=0;e<y.length;e++){let a=y[e];r.value[a]!=t.value[a]&&(l=!0,n[a]=t.value[a])}if(r.value.disable?t.value.disable||(l=!0,n.disable=!1):t.value.disable&&(l=!0,n.disable=!0),console.log("need_update：",r.value,t.value),console.log("need_update：",l),!l){b.notify({type:"negative",message:"There is no data changed!"});return}if(l){let e=!1;if(t.value.id=t.value.id.trim(),t.value.id!="")if(t.value.id==r.value.id)e=!0;else{e=!0;for(let a=0;a<k.menuData.length;a++)if(t.value.id==k.menuData[a].id){console.log("has old id : ",t.value,k.menuData[a]),e=!1;break}}if(!e){b.notify({type:"negative",message:`invalid id: ${t.value.id}`}),console.log("check_ok is: ",e);return}if(F)n={...t.value},k.menuData.push(n),V?(V.subitems||(V.subitems=[V]),V.subitems.push(n),n.handle=r.value.handle):(n.handle="handle_"+n.id,x.value.push(n));else{n.org_id=r.value.id;for(let a=0;a<f.length;a++)for(let s=0;s<Q.length;s++){const le=f[a]+Q[s];r.value[le]=t.value[le]}r.value.disable=t.value.disable;for(let a=0;a<y.length;a++){let s=y[a];r.value[s]=t.value[s]}}g.value=!1,U.value=!1,k.updateMenuItem(n),console.log("update apply dish",n)}}let V;function A(n){V=n;let l={id:"",handle:n.handle,category:n.category,subname:"",price:"0"};g.value=!0,w(l,!0)}function G(){V=void 0;let n={id:"",handle:"",category:"",subname:"",price:"0"};U.value=!0,w(n,!0)}de(()=>{console.log("..... onMounted ...");const n=[],l={};for(let e=0;e<k.menuData.length;e++){let a=k.menuData[e];if(l[a.handle]){let s=l[a.handle];s.subitems||(s.subitems=[s]),s.subitems.push(a)}else l[a.handle]=a,n.push(a)}x.value=n,console.log(x.value),$()});function $(){if(console.log("getAllTags",S.value.length),S.value.length==0){const n={},l=[{label:"------",value:""},{label:"Caixa Aleatória",value:"Caixa Aleatória"}];for(let e=0;e<k.menuData.length;e++){const a=k.menuData[e];a.category&&a.category!=""&&(n[a.category]||(n[a.category]=!0,l.push({label:a.category,value:a.category}))),a.tags&&a.tags!=""&&(n[a.tags]||(n[a.tags]=!0,l.push({label:a.tags,value:a.tags})))}S.value=l,console.log(S.value)}}const M=v(null);function E(){M.value.click()}function J(n){const l=n.target.files[0];l&&K(l)}async function K(n){let l;l="/upload_image";const e=new FormData;e.append("image",n);try{const a=await fetch(l,{method:"POST",body:e});if(!a.ok)throw new Error("上传失败");const s=await a.json();console.log("上传成功",s),t.value.image=s.imageUrl,console.log(t.value.image),b.notify({type:"positive",message:"图片上传成功"})}catch(a){console.error("上传错误",a),b.notify({type:"negative",message:"图片上传失败"})}}return(n,l)=>(h(),L(P,null,[d("div",Qe,[o(re,{title:"Dishes",rows:x.value,columns:C,"row-key":"id",filter:D.value,onRowClick:p},{header:i(e=>[o(X,{props:e},{default:i(()=>[o(ae,{"auto-width":""}),(h(!0),L(P,null,ee(e.cols,a=>(h(),N(ae,{key:a.name,props:e},{default:i(()=>[B(H(a.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(e=>[o(X,{props:e},{default:i(()=>[o(q,{"auto-width":""},{default:i(()=>[o(c,{size:"sm",color:e.row.subitems?"accent":"primary",round:"",dense:"",onClick:a=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(h(!0),L(P,null,ee(e.cols,a=>(h(),N(q,{key:a.name,props:e},{default:i(()=>[B(H(a.value),1)]),_:2},1032,["props"]))),128)),o(q,{"auto-width":""},{default:i(()=>[o(c,{color:"primary",dense:"",onClick:a=>p(null,e.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),z(o(X,{props:e},{default:i(()=>[e.row.subitems?ue("",!0):(h(),N(q,{key:0,colspan:"100%"},{default:i(()=>[o(c,{color:"primary",dense:"",onClick:a=>A(e.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),e.row.subitems?(h(),N(q,{key:1,colspan:"100%"},{default:i(()=>[o(c,{color:"primary",dense:"",onClick:a=>A(e.row),label:"add new"},null,8,["onClick"]),o(we,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:i(()=>[o(he,{header:""},{default:i(()=>l[23]||(l[23]=[B("sub item")])),_:1,__:[23]}),(h(!0),L(P,null,ee(e.row.subitems,a=>(h(),N(Se,{key:a.id},{default:i(()=>[o(q,{style:{width:"50px"}},{default:i(()=>[B(H(a.id),1)]),_:2},1024),o(q,{style:{width:"150px"}},{default:i(()=>[B(H(a.subname),1)]),_:2},1024),o(q,{"auto-width":""},{default:i(()=>[o(c,{color:"primary",dense:"",onClick:s=>I(a),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):ue("",!0)]),_:2},1032,["props"]),[[Ve,e.expand]])]),"top-right":i(()=>[o(c,{class:"q-mr-lg",color:"primary",dense:"",onClick:l[0]||(l[0]=e=>G()),label:"add new"}),o(m,{borderless:"",dense:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=e=>D.value=e),placeholder:"Search"},{append:i(()=>[o(oe,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),o(ne,{modelValue:U.value,"onUpdate:modelValue":l[14]||(l[14]=e=>U.value=e),"full-height":"","full-width":""},{default:i(()=>[o(ie,null,{default:i(()=>[o(R,{class:"row items-center q-pb-none"},{default:i(()=>[l[24]||(l[24]=d("div",{class:"text-h6"},"Edit Dish",-1)),o(W),z(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[Z]])]),_:1,__:[24]}),d("div",Ue,[o(O,{modelValue:t.value.disable,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.disable=e),label:"Disable"},null,8,["modelValue"]),o(O,{modelValue:t.value.soldout,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),o(R,{class:"row items-center q-pa-none q-ml-lg"},{default:i(()=>[d("div",{class:"image-uploader cursor-pointer",onClick:E},[t.value.image?(h(),N(xe,{key:0,src:t.value.image,style:{height:"100px",width:"100px"}},null,8,["src"])):(h(),L("div",Te,[o(oe,{name:"image",size:"xl"}),l[25]||(l[25]=d("div",{class:"q-mt-sm"},"点击选择图片",-1))]))]),d("input",{type:"file",ref_key:"fileInput",ref:M,accept:"image/*",style:{display:"none"},onChange:J},null,544)]),_:1})]),o(R,{class:"q-pa-sm q-gutter-sm"},{default:i(()=>[o(m,{outlined:"",modelValue:t.value.name,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.name=e),label:"name(pt)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.name_en,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.name_en=e),label:"name(english)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.name_cn,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.name_cn=e),label:"name(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[26]||(l[26]=d("div",{class:"q-ma-lg"},null,-1)),o(m,{outlined:"",modelValue:t.value.note,"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.note=e),label:"descript(pt)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.note_en,"onUpdate:modelValue":l[8]||(l[8]=e=>t.value.note_en=e),label:"descript(english)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.note_cn,"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.note_cn=e),label:"descript(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[27]||(l[27]=d("div",{class:"q-ma-lg"},null,-1)),d("div",De,[o(m,{outlined:"",modelValue:t.value.id,"onUpdate:modelValue":l[10]||(l[10]=e=>t.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),o(m,{outlined:"",modelValue:t.value.price,"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),d("div",Ie,[o(m,{outlined:"",modelValue:t.value.category,"onUpdate:modelValue":l[12]||(l[12]=e=>t.value.category=e),label:"category",style:{flex:"1"}},null,8,["modelValue"]),o(me,{outlined:"",modelValue:t.value.tags,"onUpdate:modelValue":l[13]||(l[13]=e=>t.value.tags=e),options:S.value,label:"tags",style:{flex:"1"}},null,8,["modelValue","options"])]),l[28]||(l[28]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[26,27,28]}),o(se,{class:"q-gutter-lg q-mb-lg"},{default:i(()=>[o(W),z(o(c,{align:"right",label:"Cancel"},null,512),[[Z]]),o(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ne,{modelValue:g.value,"onUpdate:modelValue":l[22]||(l[22]=e=>g.value=e),"full-height":"","full-width":""},{default:i(()=>[o(ie,null,{default:i(()=>[o(R,{class:"row items-center q-pb-none"},{default:i(()=>[l[29]||(l[29]=d("div",{class:"text-h6"},"Edit Item",-1)),o(W),z(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[Z]])]),_:1,__:[29]}),o(R,{class:"q-pa-sm q-gutter-sm"},{default:i(()=>[o(O,{modelValue:t.value.disable,"onUpdate:modelValue":l[15]||(l[15]=e=>t.value.disable=e),label:"Disable"},null,8,["modelValue"]),o(O,{modelValue:t.value.soldout,"onUpdate:modelValue":l[16]||(l[16]=e=>t.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),l[30]||(l[30]=d("div",{class:"q-ma-lg"},null,-1)),o(m,{outlined:"",modelValue:t.value.subname,"onUpdate:modelValue":l[17]||(l[17]=e=>t.value.subname=e),label:"subname(pt)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.subname_en,"onUpdate:modelValue":l[18]||(l[18]=e=>t.value.subname_en=e),label:"subname(english)",dense:n.dense},null,8,["modelValue","dense"]),o(m,{outlined:"",modelValue:t.value.subname_cn,"onUpdate:modelValue":l[19]||(l[19]=e=>t.value.subname_cn=e),label:"subname(中文)",dense:n.dense},null,8,["modelValue","dense"]),l[31]||(l[31]=d("div",{class:"q-ma-lg"},null,-1)),d("div",Ne,[o(m,{outlined:"",modelValue:t.value.id,"onUpdate:modelValue":l[20]||(l[20]=e=>t.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),o(m,{outlined:"",modelValue:t.value.price,"onUpdate:modelValue":l[21]||(l[21]=e=>t.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),l[32]||(l[32]=d("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[30,31,32]}),o(se,{class:"q-gutter-lg q-mb-lg"},{default:i(()=>[o(W),z(o(c,{align:"right",label:"Cancel"},null,512),[[Z]]),o(c,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{He as default};
