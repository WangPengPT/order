import{u as _e,c as se,g as X,a as he,b as h,h as i,d as be,r as z,ab as ie,m as de,ac as Fe,ad as ye,ae as Se,x as qe,o as xe,af as ke,ag as ze,ah as we,ai as le,aj as Ue,Q as Ce,$ as re,G as Be,ak as Re,al as Ee,T as Pe,U as Ne,Y as oe,V as je}from"./index-GPq7ISSp.js";import{b as $e,h as ue}from"./format-CJebrXOQ.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Oe={..._e,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:t=>t>=0&&t<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},V=50,ce=2*V,ve=ce*Math.PI,Te=Math.round(ve*1e3)/1e3,De=se({name:"QCircularProgress",props:{...Oe,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(t,{slots:d}){const{proxy:{$q:o}}=X(),r=he(t),u=h(()=>{const g=(o.lang.rtl===!0?-1:1)*t.angle;return{transform:t.reverse!==(o.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-g}deg)`:`rotate3d(0, 0, 1, ${g-90}deg)`}}),p=h(()=>t.instantFeedback!==!0&&t.indeterminate!==!0?{transition:`stroke-dashoffset ${t.animationSpeed}ms ease 0s, stroke ${t.animationSpeed}ms ease`}:""),F=h(()=>ce/(1-t.thickness/2)),w=h(()=>`${F.value/2} ${F.value/2} ${F.value} ${F.value}`),U=h(()=>$e(t.value,t.min,t.max)),R=h(()=>t.max-t.min),q=h(()=>t.thickness/2*F.value),P=h(()=>{const g=(t.max-U.value)/R.value,e=t.rounded===!0&&U.value<t.max&&g<.25?q.value/2*(1-g/.25):0;return ve*g+e});function C({thickness:g,offset:e,color:m,cls:x,rounded:c}){return i("circle",{class:"q-circular-progress__"+x+(m!==void 0?` text-${m}`:""),style:p.value,fill:"transparent",stroke:"currentColor","stroke-width":g,"stroke-dasharray":Te,"stroke-dashoffset":e,"stroke-linecap":c,cx:F.value,cy:F.value,r:V})}return()=>{const g=[];t.centerColor!==void 0&&t.centerColor!=="transparent"&&g.push(i("circle",{class:`q-circular-progress__center text-${t.centerColor}`,fill:"currentColor",r:V-q.value/2,cx:F.value,cy:F.value})),t.trackColor!==void 0&&t.trackColor!=="transparent"&&g.push(C({cls:"track",thickness:q.value,offset:0,color:t.trackColor})),g.push(C({cls:"circle",thickness:q.value,offset:P.value,color:t.color,rounded:t.rounded===!0?"round":void 0}));const e=[i("svg",{class:"q-circular-progress__svg",style:u.value,viewBox:w.value,"aria-hidden":"true"},g)];return t.showValue===!0&&e.push(i("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:t.fontSize}},d.default!==void 0?d.default():[i("div",U.value)])),i("div",{class:`q-circular-progress q-circular-progress--${t.indeterminate===!0?"in":""}determinate`,style:r.value,role:"progressbar","aria-valuemin":t.min,"aria-valuemax":t.max,"aria-valuenow":t.indeterminate===!0?void 0:U.value},be(d.internal,e))}}});function M(t,d,o,r){const u=[];return t.forEach(p=>{r(p)===!0?u.push(p):d.push({failedPropValidation:o,file:p})}),u}function G(t){t?.dataTransfer&&(t.dataTransfer.dropEffect="copy"),de(t)}const Ae={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ie=["rejected"];function Me({editable:t,dnd:d,getFileInput:o,addFilesToQueue:r}){const{props:u,emit:p,proxy:F}=X(),w=z(null),U=h(()=>u.accept!==void 0?u.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),R=h(()=>parseInt(u.maxFiles,10)),q=h(()=>parseInt(u.maxTotalSize,10));function P(l){if(t.value)if(l!==Object(l)&&(l={target:null}),l.target?.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&ie(l);else{const k=o();k!==l.target&&k?.click(l)}}function C(l){t.value&&l&&r(null,l)}function g(l,k,L,O){let s=Array.from(k||l.target.files);const _=[],B=()=>{_.length!==0&&p("rejected",_)};if(u.accept!==void 0&&U.value.indexOf("*/")===-1&&(s=M(s,_,"accept",v=>U.value.some(b=>v.type.toUpperCase().startsWith(b)||v.name.toUpperCase().endsWith(b))),s.length===0))return B();if(u.maxFileSize!==void 0){const v=parseInt(u.maxFileSize,10);if(s=M(s,_,"max-file-size",b=>b.size<=v),s.length===0)return B()}if(u.multiple!==!0&&s.length!==0&&(s=[s[0]]),s.forEach(v=>{v.__key=v.webkitRelativePath+v.lastModified+v.name+v.size}),O===!0){const v=L.map(b=>b.__key);s=M(s,_,"duplicate",b=>v.includes(b.__key)===!1)}if(s.length===0)return B();if(u.maxTotalSize!==void 0){let v=O===!0?L.reduce((b,N)=>b+N.size,0):0;if(s=M(s,_,"max-total-size",b=>(v+=b.size,v<=q.value)),s.length===0)return B()}if(typeof u.filter=="function"){const v=u.filter(s);s=M(s,_,"filter",b=>v.includes(b))}if(u.maxFiles!==void 0){let v=O===!0?L.length:0;if(s=M(s,_,"max-files",()=>(v++,v<=R.value)),s.length===0)return B()}if(B(),s.length!==0)return s}function e(l){G(l),d.value!==!0&&(d.value=!0)}function m(l){de(l),(l.relatedTarget!==null||Fe.is.safari!==!0?l.relatedTarget!==w.value:document.elementsFromPoint(l.clientX,l.clientY).includes(w.value)===!1)===!0&&(d.value=!1)}function x(l){G(l);const k=l.dataTransfer.files;k.length!==0&&r(null,k),d.value=!1}function c(l){if(d.value===!0)return i("div",{ref:w,class:`q-${l}__dnd absolute-full`,onDragenter:G,onDragover:G,onDragleave:m,onDrop:x})}return Object.assign(F,{pickFiles:P,addFiles:C}),{pickFiles:P,addFiles:C,onDragover:e,onDragleave:m,processFiles:g,getDndNode:c,maxFilesNumber:R,maxTotalSizeNumber:q}}function ne(t){return(t*100).toFixed(2)+"%"}const Qe={...ye,...Ae,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},fe=[...Ie,"start","finish","added","removed"];function We(t,d){const o=X(),{props:r,slots:u,emit:p,proxy:F}=o,{$q:w}=F,U=Se(r,w);function R(a,f,y){if(a.__status=f,f==="idle"){a.__uploaded=0,a.__progress=0,a.__sizeLabel=ue(a.size),a.__progressLabel="0.00%";return}if(f==="failed"){F.$forceUpdate();return}a.__uploaded=f==="uploaded"?a.size:y,a.__progress=f==="uploaded"?1:Math.min(.9999,a.__uploaded/a.size),a.__progressLabel=ne(a.__progress),F.$forceUpdate()}const q=h(()=>r.disable!==!0&&r.readonly!==!0),P=z(!1),C=z(null),g=z(null),e={files:z([]),queuedFiles:z([]),uploadedFiles:z([]),uploadedSize:z(0),updateFileStatus:R,isAlive:()=>Ue(o)===!1},{pickFiles:m,addFiles:x,onDragover:c,onDragleave:l,processFiles:k,getDndNode:L,maxFilesNumber:O,maxTotalSizeNumber:s}=Me({editable:q,dnd:P,getFileInput:J,addFilesToQueue:Z});Object.assign(e,t({props:r,slots:u,emit:p,helpers:e,exposeApi:a=>{Object.assign(e,a)}})),e.isBusy===void 0&&(e.isBusy=z(!1));const _=z(0),B=h(()=>_.value===0?0:e.uploadedSize.value/_.value),v=h(()=>ne(B.value)),b=h(()=>ue(_.value)),N=h(()=>q.value===!0&&e.isUploading.value!==!0&&(r.multiple===!0||e.queuedFiles.value.length===0)&&(r.maxFiles===void 0||e.files.value.length<O.value)&&(r.maxTotalSize===void 0||_.value<s.value)),n=h(()=>q.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);Be(Re,te);const T=h(()=>"q-uploader column no-wrap"+(U.value===!0?" q-uploader--dark q-dark":"")+(r.bordered===!0?" q-uploader--bordered":"")+(r.square===!0?" q-uploader--square no-border-radius":"")+(r.flat===!0?" q-uploader--flat no-shadow":"")+(r.disable===!0?" disabled q-uploader--disable":"")+(P.value===!0?" q-uploader--dnd":"")),D=h(()=>"q-uploader__header"+(r.color!==void 0?` bg-${r.color}`:"")+(r.textColor!==void 0?` text-${r.textColor}`:""));qe(e.isUploading,(a,f)=>{f===!1&&a===!0?p("start"):f===!0&&a===!1&&p("finish")});function A(){r.disable===!1&&(e.abort(),e.uploadedSize.value=0,_.value=0,K(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function E(){r.disable===!1&&Y(["uploaded"],()=>{e.uploadedFiles.value=[]})}function W(){Y(["idle","failed"],({size:a})=>{_.value-=a,e.queuedFiles.value=[]})}function Y(a,f){if(r.disable===!0)return;const y={files:[],size:0},j=e.files.value.filter(S=>a.indexOf(S.__status)===-1?!0:(y.size+=S.size,y.files.push(S),S.__img!==void 0&&window.URL.revokeObjectURL(S.__img.src),!1));y.files.length!==0&&(e.files.value=j,f(y),p("removed",y.files))}function H(a){r.disable||(a.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(f=>f.__key!==a.__key):a.__status==="uploading"?a.__abort():_.value-=a.size,e.files.value=e.files.value.filter(f=>f.__key!==a.__key?!0:(f.__img!==void 0&&window.URL.revokeObjectURL(f.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(f=>f.__key!==a.__key),p("removed",[a]))}function K(){e.files.value.forEach(a=>{a.__img!==void 0&&window.URL.revokeObjectURL(a.__img.src)})}function J(){return g.value||C.value.getElementsByClassName("q-uploader__input")[0]}function Z(a,f){const y=k(a,f,e.files.value,!0),j=J();j!=null&&(j.value=""),y!==void 0&&(y.forEach(S=>{if(e.updateFileStatus(S,"idle"),_.value+=S.size,r.noThumbnails!==!0&&S.type.toUpperCase().startsWith("IMAGE")){const ae=new Image;ae.src=window.URL.createObjectURL(S),S.__img=ae}}),e.files.value=e.files.value.concat(y),e.queuedFiles.value=e.queuedFiles.value.concat(y),p("added",y),r.autoUpload===!0&&e.upload())}function ee(){n.value===!0&&e.upload()}function Q(a,f,y){if(a===!0){const j={type:"a",key:f,icon:w.iconSet.uploader[f],flat:!0,dense:!0};let S;return f==="add"?(j.onClick=m,S=te):j.onClick=y,i(re,j,S)}}function te(){return i("input",{ref:g,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:r.accept,multiple:r.multiple===!0?"multiple":void 0,capture:r.capture,onMousedown:ie,onClick:m,onChange:Z})}function me(){return u.header!==void 0?u.header(I):[i("div",{class:"q-uploader__header-content column"},[i("div",{class:"flex flex-center no-wrap q-gutter-xs"},[Q(e.queuedFiles.value.length!==0,"removeQueue",W),Q(e.uploadedFiles.value.length!==0,"removeUploaded",E),e.isUploading.value===!0?i(le,{class:"q-uploader__spinner"}):null,i("div",{class:"col column justify-center"},[r.label!==void 0?i("div",{class:"q-uploader__title"},[r.label]):null,i("div",{class:"q-uploader__subtitle"},[b.value+" / "+v.value])]),Q(N.value,"add"),Q(r.hideUploadBtn===!1&&n.value===!0,"upload",e.upload),Q(e.isUploading.value,"clear",e.abort)])])]}function ge(){return u.list!==void 0?u.list(I):e.files.value.map(a=>i("div",{key:a.__key,class:"q-uploader__file relative-position"+(r.noThumbnails!==!0&&a.__img!==void 0?" q-uploader__file--img":"")+(a.__status==="failed"?" q-uploader__file--failed":a.__status==="uploaded"?" q-uploader__file--uploaded":""),style:r.noThumbnails!==!0&&a.__img!==void 0?{backgroundImage:'url("'+a.__img.src+'")',backgroundSize:r.thumbnailFit}:null},[i("div",{class:"q-uploader__file-header row flex-center no-wrap"},[a.__status==="failed"?i(Ce,{class:"q-uploader__file-status",name:w.iconSet.type.negative,color:"negative"}):null,i("div",{class:"q-uploader__file-header-content col"},[i("div",{class:"q-uploader__title"},[a.name]),i("div",{class:"q-uploader__subtitle row items-center no-wrap"},[a.__sizeLabel+" / "+a.__progressLabel])]),a.__status==="uploading"?i(De,{value:a.__progress,min:0,max:1,indeterminate:a.__progress===0}):i(re,{round:!0,dense:!0,flat:!0,icon:w.iconSet.uploader[a.__status==="uploaded"?"done":"clear"],onClick:()=>{H(a)}})])]))}xe(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&K()});const I={};for(const a in e)ke(e[a])===!0?ze(I,a,()=>e[a].value):I[a]=e[a];return Object.assign(I,{upload:ee,reset:A,removeUploadedFiles:E,removeQueuedFiles:W,removeFile:H,pickFiles:m,addFiles:x}),we(I,{canAddFiles:()=>N.value,canUpload:()=>n.value,uploadSizeLabel:()=>b.value,uploadProgressLabel:()=>v.value}),d({...e,upload:ee,reset:A,removeUploadedFiles:E,removeQueuedFiles:W,removeFile:H,pickFiles:m,addFiles:x,canAddFiles:N,canUpload:n,uploadSizeLabel:b,uploadProgressLabel:v}),()=>{const a=[i("div",{class:D.value},me()),i("div",{class:"q-uploader__list scroll"},ge()),L("uploader")];e.isBusy.value===!0&&a.push(i("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[i(le)]));const f={ref:C,class:T.value};return N.value===!0&&Object.assign(f,{onDragover:c,onDragleave:l}),i("div",f,a)}}const Ge=()=>!0;function He(t){const d={};return t.forEach(o=>{d[o]=Ge}),d}const Ve=He(fe),Xe=({name:t,props:d,emits:o,injectPlugin:r})=>se({name:t,props:{...Qe,...d},emits:Ee(o)===!0?{...Ve,...o}:[...fe,...o],setup(u,{expose:p}){return We(r,p)}});function $(t){return typeof t=="function"?t:()=>t}const Ye="QUploader",Ke={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>t=>t.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Je=["factoryFailed","uploaded","failed","uploading"];function Ze({props:t,emit:d,helpers:o}){const r=z([]),u=z([]),p=z(0),F=h(()=>({url:$(t.url),method:$(t.method),headers:$(t.headers),formFields:$(t.formFields),fieldName:$(t.fieldName),withCredentials:$(t.withCredentials),sendRaw:$(t.sendRaw),batch:$(t.batch)})),w=h(()=>p.value>0),U=h(()=>u.value.length!==0);let R;function q(){r.value.forEach(e=>{e.abort()}),u.value.length!==0&&(R=!0)}function P(){const e=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],F.value.batch(e)?C(e):e.forEach(m=>{C([m])})}function C(e){if(p.value++,typeof t.factory!="function"){g(e,{});return}const m=t.factory(e);if(!m)d("factoryFailed",new Error("QUploader: factory() does not return properly"),e),p.value--;else if(typeof m.catch=="function"&&typeof m.then=="function"){u.value.push(m);const x=c=>{o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==m),u.value.length===0&&(R=!1),o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(l=>{o.updateFileStatus(l,"failed")}),d("factoryFailed",c,e),p.value--)};m.then(c=>{R===!0?x(new Error("Aborted")):o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==m),g(e,c))}).catch(x)}else g(e,m||{})}function g(e,m){const x=new FormData,c=new XMLHttpRequest,l=(n,T)=>m[n]!==void 0?$(m[n])(T):F.value[n](T),k=l("url",e);if(!k){console.error("q-uploader: invalid or no URL specified"),p.value--;return}const L=l("formFields",e);L!==void 0&&L.forEach(n=>{x.append(n.name,n.value)});let O=0,s=0,_=0,B=0,v;c.upload.addEventListener("progress",n=>{if(v===!0)return;const T=Math.min(B,n.loaded);o.uploadedSize.value+=T-_,_=T;let D=_-s;for(let A=O;D>0&&A<e.length;A++){const E=e[A];if(D>E.size)D-=E.size,O++,s+=E.size,o.updateFileStatus(E,"uploading",E.size);else{o.updateFileStatus(E,"uploading",D);return}}},!1),c.onreadystatechange=()=>{c.readyState<4||(c.status&&c.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"uploaded")}),d("uploaded",{files:e,xhr:c})):(v=!0,o.uploadedSize.value-=_,o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"failed")}),d("failed",{files:e,xhr:c})),p.value--,r.value=r.value.filter(n=>n!==c))},c.open(l("method",e),k),l("withCredentials",e)===!0&&(c.withCredentials=!0);const b=l("headers",e);b!==void 0&&b.forEach(n=>{c.setRequestHeader(n.name,n.value)});const N=l("sendRaw",e);e.forEach(n=>{o.updateFileStatus(n,"uploading",0),N!==!0&&x.append(l("fieldName",n),n,n.name),n.xhr=c,n.__abort=()=>{c.abort()},B+=n.size}),d("uploading",{files:e,xhr:c}),r.value.push(c),N===!0?c.send(new Blob(e)):c.send(x)}return{isUploading:w,isBusy:U,abort:q,upload:P}}const et={name:Ye,props:Ke,emits:Je,injectPlugin:Ze},tt=Xe(et);let pe;pe="/upload";const at={setup(){return{uploadUrl:pe}}},lt={class:"q-pa-md"},rt={class:"q-gutter-sm row items-start"};function ot(t,d,o,r,u,p){return Ne(),Pe("div",lt,[d[0]||(d[0]=oe("p",null,"上传菜单",-1)),oe("div",rt,[je(tt,{url:r.uploadUrl,style:{"max-width":"300px"}},null,8,["url"])])])}const it=Le(at,[["render",ot]]);export{it as default};
