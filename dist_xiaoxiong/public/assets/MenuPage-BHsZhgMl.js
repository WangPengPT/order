import{Q as me,a as ne,b as ve}from"./QTable-GbcWnb6M.js";import{Q as Y,a as _}from"./QTd-CciEeAEH.js";import{q as I,p as ge,b as v,N as ue,a1 as fe,B as re,s as q,a2 as ce,t as be,a3 as pe,L as ye,a4 as ee,z as Ve,n as w,d as z,o as c,f as r,a as u,w as i,e as oe,V as P,i as b,h as d,C as ie,m as B,a0 as le,c as U,k as M,_ as X,Z as ae,a5 as he,Q as se,j as A,a6 as H}from"./index-Bhi6eCZ1.js";import{Q as Se}from"./QItemLabel-CX2_MlAD.js";import{Q as we}from"./QItem-2soD_mMU.js";import{a as ke}from"./rtl-c_OAXTa8.js";import{Q as G}from"./QSpace-6NO2uvtG.js";import{Q as de}from"./QToolbar-BK1683HL.js";import{C as W}from"./ClosePopup-Cwk95WMD.js";import{u as Ce}from"./use-quasar-DsOmnenZ.js";import"./format-CJebrXOQ.js";const _e={ratio:[String,Number]};function qe(o,p){return I(()=>{const k=Number(o.ratio||(p!==void 0?p.value:void 0));return isNaN(k)!==!0&&k>0?{paddingBottom:`${100/k}%`}:null})}const Qe=1.7778,xe=ge({name:"QImg",props:{..._e,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:Qe},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(o,{slots:p,emit:k}){const D=v(o.initialRatio),Q=qe(o,D),m=Ve(),{registerTimeout:a,removeTimeout:x}=ue(),{registerTimeout:$,removeTimeout:g}=ue(),C=I(()=>o.placeholderSrc!==void 0?{src:o.placeholderSrc}:null),S=I(()=>o.errorSrc!==void 0?{src:o.errorSrc,__qerror:!0}:null),f=[v(null),v(C.value)],y=v(0),h=v(!1),T=v(!1),N=I(()=>`q-img q-img--${o.noNativeMenu===!0?"no-":""}menu`),F=I(()=>({width:o.width,height:o.height})),j=I(()=>`q-img__image ${o.imgClass!==void 0?o.imgClass+" ":""}q-img__image--with${o.noTransition===!0?"out":""}-transition q-img__image--`),V=I(()=>({...o.imgStyle,objectFit:o.fit,objectPosition:o.position}));function E(){if(g(),o.loadingShowDelay===0){h.value=!0;return}$(()=>{h.value=!0},o.loadingShowDelay)}function L(){g(),h.value=!1}function Z({target:e}){ee(m)===!1&&(x(),D.value=e.naturalHeight===0?.5:e.naturalWidth/e.naturalHeight,R(e,1))}function R(e,l){l===1e3||ee(m)===!0||(e.complete===!0?J(e):a(()=>{R(e,l+1)},50))}function J(e){ee(m)!==!0&&(y.value=y.value^1,f[y.value].value=null,L(),e.getAttribute("__qerror")!=="true"&&(T.value=!1),k("load",e.currentSrc||e.src))}function K(e){x(),L(),T.value=!0,f[y.value].value=S.value,f[y.value^1].value=C.value,k("error",e)}function O(e){const l=f[e].value,t={key:"img_"+e,class:j.value,style:V.value,alt:o.alt,crossorigin:o.crossorigin,decoding:o.decoding,referrerpolicy:o.referrerpolicy,height:o.height,width:o.width,loading:o.loading,fetchpriority:o.fetchpriority,"aria-hidden":"true",draggable:o.draggable,...l};return y.value===e?Object.assign(t,{class:t.class+"current",onLoad:Z,onError:K}):t.class+="loaded",q("div",{class:"q-img__container absolute-full",key:"img"+e},q("img",t))}function n(){return h.value===!1?q("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},be(p[T.value===!0?"error":"default"])):q("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},p.loading!==void 0?p.loading():o.noSpinner===!0?void 0:[q(pe,{color:o.spinnerColor,size:o.spinnerSize})])}{let e=function(){ye(()=>o.src||o.srcset||o.sizes?{src:o.src,srcset:o.srcset,sizes:o.sizes}:null,l=>{x(),T.value=!1,l===null?(L(),f[y.value^1].value=C.value):E(),f[y.value].value=l},{immediate:!0})};fe.value===!0?re(e):e()}return()=>{const e=[];return Q.value!==null&&e.push(q("div",{key:"filler",style:Q.value})),f[0].value!==null&&e.push(O(0)),f[1].value!==null&&e.push(O(1)),e.push(q(ce,{name:"q-transition--fade"},n)),q("div",{key:"main",class:N.value,style:F.value,role:"img","aria-label":o.alt},e)}}}),Ue={class:"q-pa-md"},Ie={style:{display:"flex",gap:"16px"}},De={key:1,class:"upload-placeholder"},Te={style:{display:"flex",gap:"16px"}},Ne={style:{display:"flex",gap:"16px"}},$e={style:{display:"flex",gap:"16px"}},Xe={__name:"MenuPage",setup(o){const p=Ce(),k=[{name:"id",required:!0,label:"id",align:"left",field:n=>n.id,format:n=>`${n}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0,style:"max-width: 50px;"}],D=v(""),Q=v([]),m=v(null),a=v({}),x=v([]),$=v(!0);let g=["name","note","subname"];const C=["","_en","_cn"];let S=["id","price","category","tags","image","soldout","discount","dis_price"];const f=v(!1);function y(n,e){V=void 0,f.value=!0,N(e)}const h=v(!1);function T(n){V=void 0,h.value=!0,N(n)}function N(n,e){F=e,m.value=n;for(let l=0;l<g.length;l++)a.value[g[l]]=n[g[l]],a.value[g[l]+"_en"]=n[g[l]+"_en"],a.value[g[l]+"_cn"]=n[g[l]+"_cn"];a.value.disable=n.disable||!1;for(let l=0;l<S.length;l++)a.value[S[l]]=n[S[l]];n.subitems?$.value=n.subitems.length<=0:$.value=!0}let F=!1;function j(){console.log("apply dish"),a.value.tags&&a.value.tags.value&&(a.value.tags=a.value.tags.value);let n={},e=!1;a.value.discount?(a.value.discount=Math.round(a.value.discount),a.value.discount>99&&(a.value.discount=99),a.value.discount<=0?(a.value.dis_price=void 0,a.value.discount=void 0):(a.value.dis_price=a.value.price*(100-a.value.discount),a.value.dis_price=Math.round(a.value.dis_price)/100,console.log(a.value.price*(100-a.value.discount)))):a.value.dis_price=void 0;for(let l=0;l<g.length;l++)for(let t=0;t<C.length;t++){const s=g[l]+C[t];m.value[s]!=a.value[s]&&(n[s]=a.value[s],e=!0)}for(let l=0;l<S.length;l++){let t=S[l];m.value[t]!=a.value[t]&&(e=!0,n[t]=a.value[t])}if(m.value.disable?a.value.disable||(e=!0,n.disable=!1):a.value.disable&&(e=!0,n.disable=!0),console.log("need_update：",m.value,a.value),console.log("need_update：",e),!e){p.notify({type:"negative",message:"There is no data changed!"});return}if(e){let l=!1;if(a.value.id=a.value.id.trim(),a.value.id!="")if(a.value.id==m.value.id)l=!0;else{l=!0;for(let t=0;t<w.menuData.length;t++)if(a.value.id==w.menuData[t].id){console.log("has old id : ",a.value,w.menuData[t]),l=!1;break}}if(!l){p.notify({type:"negative",message:`invalid id: ${a.value.id}`}),console.log("check_ok is: ",l);return}if(F)n={...a.value},w.menuData.push(n),V?(V.subitems||(V.subitems=[V]),V.subitems.push(n),n.handle=m.value.handle):(n.handle="handle_"+n.id,Q.value.push(n));else{n.org_id=m.value.id;for(let t=0;t<g.length;t++)for(let s=0;s<C.length;s++){const te=g[t]+C[s];m.value[te]=a.value[te]}m.value.disable=a.value.disable;for(let t=0;t<S.length;t++){let s=S[t];m.value[s]=a.value[s]}}h.value=!1,f.value=!1,w.updateMenuItem(n),console.log("update apply dish",n)}}let V;function E(n){V=n;let e={id:"",handle:n.handle,category:"",subname:"",price:"0"};h.value=!0,N(e,!0)}function L(){V=void 0;let n={id:"",handle:"",category:"",subname:"",price:"0"};f.value=!0,N(n,!0)}re(()=>{console.log("..... onMounted ...");const n=[],e={};for(let l=0;l<w.menuData.length;l++){let t=w.menuData[l];if(e[t.handle]){let s=e[t.handle];s.subitems||(s.subitems=[s]),s.subitems.push(t)}else e[t.handle]=t,n.push(t)}Q.value=n,console.log(Q.value),Z()});function Z(){const n={},e=[{label:"------",value:""},{label:"XIAOXIONG® RAMEN",value:"XIAOXIONG® RAMEN"},{label:"Pato assado",value:"Pato assado"}];for(let l=0;l<w.menuData.length;l++){const t=w.menuData[l];t.category&&t.category!=""&&(n[t.category]||(n[t.category]=!0,e.push({label:t.category,value:t.category}))),t.tags&&t.tags!=""&&(n[t.tags]||(n[t.tags]=!0,e.push({label:t.tags,value:t.tags})))}x.value=e,console.log(x.value)}const R=v(null);function J(){R.value.click()}function K(n){const e=n.target.files[0];e&&O(e)}async function O(n){let e;e="/upload_image";const l=new FormData;l.append("image",n);try{const t=await fetch(e,{method:"POST",body:l});if(!t.ok)throw new Error("上传失败");const s=await t.json();console.log("上传成功",s),a.value.image=s.imageUrl,console.log(a.value.image),p.notify({type:"positive",message:"图片上传成功"})}catch(t){console.error("上传错误",t),p.notify({type:"negative",message:"图片上传失败"})}}return(n,e)=>(c(),z(P,null,[r("div",Ue,[u(me,{title:"Dishes",rows:Q.value,columns:k,"row-key":"id",filter:D.value,onRowClick:y},{header:i(l=>[u(Y,{props:l},{default:i(()=>[u(ne,{"auto-width":""}),(c(!0),z(P,null,le(l.cols,t=>(c(),U(ne,{key:t.name,props:l},{default:i(()=>[M(X(t.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(l=>[u(Y,{props:l},{default:i(()=>[u(_,{"auto-width":""},{default:i(()=>[u(b,{size:"sm",color:l.row.subitems?"accent":"primary",round:"",dense:"",onClick:t=>l.expand=!l.expand,icon:l.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(c(!0),z(P,null,le(l.cols,t=>(c(),U(_,{key:t.name,props:l},{default:i(()=>[M(X(t.value),1)]),_:2},1032,["props"]))),128)),u(_,{"auto-width":""},{default:i(()=>[u(b,{color:"primary",dense:"",onClick:t=>y(null,l.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),B(u(Y,{props:l},{default:i(()=>[l.row.subitems?ae("",!0):(c(),U(_,{key:0,colspan:"100%"},{default:i(()=>[u(b,{color:"primary",dense:"",onClick:t=>E(l.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),l.row.subitems?(c(),U(_,{key:1,colspan:"100%"},{default:i(()=>[u(b,{color:"primary",dense:"",onClick:t=>E(l.row),label:"add new"},null,8,["onClick"]),u(ke,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:i(()=>[u(Se,{header:""},{default:i(()=>e[25]||(e[25]=[M("sub item")])),_:1,__:[25]}),(c(!0),z(P,null,le(l.row.subitems,t=>(c(),U(we,{key:t.id},{default:i(()=>[u(_,{style:{width:"50px"}},{default:i(()=>[M(X(t.id),1)]),_:2},1024),u(_,{style:{width:"150px"}},{default:i(()=>[M(X(t.subname),1)]),_:2},1024),u(_,{"auto-width":""},{default:i(()=>[u(b,{color:"primary",dense:"",onClick:s=>T(t),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):ae("",!0)]),_:2},1032,["props"]),[[he,l.expand]])]),"top-right":i(()=>[u(b,{class:"q-mr-lg",color:"primary",dense:"",onClick:e[0]||(e[0]=l=>L()),label:"add new"}),u(d,{borderless:"",dense:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=l=>D.value=l),placeholder:"Search"},{append:i(()=>[u(ie,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),u(oe,{modelValue:f.value,"onUpdate:modelValue":e[15]||(e[15]=l=>f.value=l),"full-height":"","full-width":""},{default:i(()=>[u(se,null,{default:i(()=>[u(A,{class:"row items-center q-pb-none"},{default:i(()=>[e[26]||(e[26]=r("div",{class:"text-h6"},"Edit Dish",-1)),u(G),B(u(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1,__:[26]}),r("div",Ie,[$.value?(c(),U(H,{key:0,modelValue:a.value.disable,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.disable=l),label:"Disable"},null,8,["modelValue"])):ae("",!0),u(H,{modelValue:a.value.soldout,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.soldout=l),label:"Soldout"},null,8,["modelValue"]),u(A,{class:"row items-center q-pa-none q-ml-lg"},{default:i(()=>[r("div",{class:"image-uploader cursor-pointer",onClick:J},[a.value.image?(c(),U(xe,{key:0,src:a.value.image,style:{height:"100px",width:"100px"}},null,8,["src"])):(c(),z("div",De,[u(ie,{name:"image",size:"xl"}),e[27]||(e[27]=r("div",{class:"q-mt-sm"},"点击选择图片",-1))]))]),r("input",{type:"file",ref_key:"fileInput",ref:R,accept:"image/*",style:{display:"none"},onChange:K},null,544)]),_:1})]),u(A,{class:"q-pa-sm q-gutter-sm"},{default:i(()=>[u(d,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.name=l),label:"name(pt)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.name_en,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.name_en=l),label:"name(english)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.name_cn,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.name_cn=l),label:"name(中文)",dense:n.dense},null,8,["modelValue","dense"]),e[28]||(e[28]=r("div",{class:"q-ma-lg"},null,-1)),u(d,{outlined:"",modelValue:a.value.note,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.note=l),label:"descript(pt)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.note_en,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.note_en=l),label:"descript(english)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.note_cn,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.note_cn=l),label:"descript(中文)",dense:n.dense},null,8,["modelValue","dense"]),e[29]||(e[29]=r("div",{class:"q-ma-lg"},null,-1)),r("div",Te,[u(d,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.id=l),label:"id",style:{flex:"1"}},null,8,["modelValue"]),u(d,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.price=l),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),r("div",Ne,[u(d,{outlined:"",modelValue:a.value.category,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.category=l),label:"category",style:{flex:"1"}},null,8,["modelValue"]),u(ve,{outlined:"",modelValue:a.value.tags,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.tags=l),options:x.value,label:"tags",style:{flex:"1"}},null,8,["modelValue","options"])]),u(d,{outlined:"",modelValue:a.value.discount,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.discount=l),label:"discount",type:"number"},null,8,["modelValue"]),e[30]||(e[30]=r("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[28,29,30]}),u(de,{class:"q-gutter-lg q-mb-lg"},{default:i(()=>[u(G),B(u(b,{align:"right",label:"Cancel"},null,512),[[W]]),u(b,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"]),u(oe,{modelValue:h.value,"onUpdate:modelValue":e[24]||(e[24]=l=>h.value=l),"full-height":"","full-width":""},{default:i(()=>[u(se,null,{default:i(()=>[u(A,{class:"row items-center q-pb-none"},{default:i(()=>[e[31]||(e[31]=r("div",{class:"text-h6"},"Edit Item",-1)),u(G),B(u(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1,__:[31]}),u(A,{class:"q-pa-sm q-gutter-sm"},{default:i(()=>[u(H,{modelValue:a.value.disable,"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.disable=l),label:"Disable"},null,8,["modelValue"]),u(H,{modelValue:a.value.soldout,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.soldout=l),label:"Soldout"},null,8,["modelValue"]),e[32]||(e[32]=r("div",{class:"q-ma-lg"},null,-1)),u(d,{outlined:"",modelValue:a.value.subname,"onUpdate:modelValue":e[18]||(e[18]=l=>a.value.subname=l),label:"subname(pt)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.subname_en,"onUpdate:modelValue":e[19]||(e[19]=l=>a.value.subname_en=l),label:"subname(english)",dense:n.dense},null,8,["modelValue","dense"]),u(d,{outlined:"",modelValue:a.value.subname_cn,"onUpdate:modelValue":e[20]||(e[20]=l=>a.value.subname_cn=l),label:"subname(中文)",dense:n.dense},null,8,["modelValue","dense"]),e[33]||(e[33]=r("div",{class:"q-ma-lg"},null,-1)),r("div",$e,[u(d,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":e[21]||(e[21]=l=>a.value.id=l),label:"id",style:{flex:"1"}},null,8,["modelValue"]),u(d,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":e[22]||(e[22]=l=>a.value.price=l),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),u(d,{outlined:"",modelValue:a.value.discount,"onUpdate:modelValue":e[23]||(e[23]=l=>a.value.discount=l),label:"discount",type:"number"},null,8,["modelValue"]),e[34]||(e[34]=r("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[32,33,34]}),u(de,{class:"q-gutter-lg q-mb-lg"},{default:i(()=>[u(G),B(u(b,{align:"right",label:"Cancel"},null,512),[[W]]),u(b,{align:"left",color:"primary",label:"Apply",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Xe as default};
