import{s as le}from"./index-CXtDhJOV.js";import{a as te,b as ne}from"./index-MfeMOwLv.js";import{B as oe,c as h,o as k,d as ae,m as ue,h as f,n as se,z as ie,A as de,a,b as n,w as d,l as pe,F as re,k as b,t as N}from"./index-EM-CZ76s.js";import{s as me,a as fe,b as ve,c as ce}from"./index-DtmduXlt.js";import{s as be}from"./index-Bn-5yviF.js";import{s as ge,a as _e}from"./index-JD_Ne0bk.js";import{s as ye}from"./index-Dt_kEjEg.js";import{s as we}from"./index-DCPuJMKM.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BtG8bjm2.js";import"./index-n_nkxNS_.js";import"./index-VDlT9R5v.js";import"./index-HVwDa22t.js";import"./index-BCAUToxQ.js";var Ve=`
    .p-inputgroup,
    .p-inputgroup .p-iconfield,
    .p-inputgroup .p-floatlabel,
    .p-inputgroup .p-iftalabel {
        display: flex;
        align-items: stretch;
        width: 100%;
    }

    .p-inputgroup .p-inputtext,
    .p-inputgroup .p-inputwrapper {
        flex: 1 1 auto;
        width: 1%;
    }

    .p-inputgroupaddon {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: dt('inputgroup.addon.padding');
        background: dt('inputgroup.addon.background');
        color: dt('inputgroup.addon.color');
        border-block-start: 1px solid dt('inputgroup.addon.border.color');
        border-block-end: 1px solid dt('inputgroup.addon.border.color');
        min-width: dt('inputgroup.addon.min.width');
    }

    .p-inputgroupaddon:first-child,
    .p-inputgroupaddon + .p-inputgroupaddon {
        border-inline-start: 1px solid dt('inputgroup.addon.border.color');
    }

    .p-inputgroupaddon:last-child {
        border-inline-end: 1px solid dt('inputgroup.addon.border.color');
    }

    .p-inputgroupaddon:has(.p-button) {
        padding: 0;
        overflow: hidden;
    }

    .p-inputgroupaddon .p-button {
        border-radius: 0;
    }

    .p-inputgroup > .p-component,
    .p-inputgroup > .p-inputwrapper > .p-component,
    .p-inputgroup > .p-iconfield > .p-component,
    .p-inputgroup > .p-floatlabel > .p-component,
    .p-inputgroup > .p-floatlabel > .p-inputwrapper > .p-component,
    .p-inputgroup > .p-iftalabel > .p-component,
    .p-inputgroup > .p-iftalabel > .p-inputwrapper > .p-component {
        border-radius: 0;
        margin: 0;
    }

    .p-inputgroupaddon:first-child,
    .p-inputgroup > .p-component:first-child,
    .p-inputgroup > .p-inputwrapper:first-child > .p-component,
    .p-inputgroup > .p-iconfield:first-child > .p-component,
    .p-inputgroup > .p-floatlabel:first-child > .p-component,
    .p-inputgroup > .p-floatlabel:first-child > .p-inputwrapper > .p-component,
    .p-inputgroup > .p-iftalabel:first-child > .p-component,
    .p-inputgroup > .p-iftalabel:first-child > .p-inputwrapper > .p-component {
        border-start-start-radius: dt('inputgroup.addon.border.radius');
        border-end-start-radius: dt('inputgroup.addon.border.radius');
    }

    .p-inputgroupaddon:last-child,
    .p-inputgroup > .p-component:last-child,
    .p-inputgroup > .p-inputwrapper:last-child > .p-component,
    .p-inputgroup > .p-iconfield:last-child > .p-component,
    .p-inputgroup > .p-floatlabel:last-child > .p-component,
    .p-inputgroup > .p-floatlabel:last-child > .p-inputwrapper > .p-component,
    .p-inputgroup > .p-iftalabel:last-child > .p-component,
    .p-inputgroup > .p-iftalabel:last-child > .p-inputwrapper > .p-component {
        border-start-end-radius: dt('inputgroup.addon.border.radius');
        border-end-end-radius: dt('inputgroup.addon.border.radius');
    }

    .p-inputgroup .p-component:focus,
    .p-inputgroup .p-component.p-focus,
    .p-inputgroup .p-inputwrapper-focus,
    .p-inputgroup .p-component:focus ~ label,
    .p-inputgroup .p-component.p-focus ~ label,
    .p-inputgroup .p-inputwrapper-focus ~ label {
        z-index: 1;
    }

    .p-inputgroup > .p-button:not(.p-button-icon-only) {
        width: auto;
    }

    .p-inputgroup .p-iconfield + .p-iconfield .p-inputtext {
        border-inline-start: 0;
    }
`,he={root:"p-inputgroup"},ke=oe.extend({name:"inputgroup",style:Ve,classes:he}),Ce={name:"BaseInputGroup",extends:te,style:ke,provide:function(){return{$pcInputGroup:this,$parentInstance:this}}},E={name:"InputGroup",extends:Ce,inheritAttrs:!1};function Ue(C,I,g,U,S,P){return k(),h("div",ue({class:C.cx("root")},C.ptmi("root")),[ae(C.$slots,"default")],16)}E.render=Ue;const $e={class:"card flex flex-column",style:{height:"calc(100vh - 150px)"}},De={class:"flex justify-content-end"},Ie={key:0},Se={key:1},Pe={class:"flex flex-row"},Me={class:"flex items-center"},je={class:"flex items-center"},Fe=["src"],Le={key:1,class:"upload-placeholder"},Re={class:"flex flex-column"},Be={class:"flex flex-column w-full"},Oe={class:"flex flex-row justify-content-between w-full"},Te={class:"w-6 m-2"},Ne={class:"w-6 m-2"},Ee={class:"flex flex-row justify-content-between w-full"},Ae={class:"w-6 m-2"},Ge={class:"w-6 m-2"},qe={for:"on_label"},ze={class:"flex flex-row justify-content-end"},Ke={class:"flex flex-row"},Xe={class:"flex items-center"},He={class:"flex items-center"},Je={class:"flex flex-column"},Qe={class:"flex flex-column w-full"},We={class:"flex flex-row justify-content-between w-full"},Ye={class:"w-6 m-2"},Ze={class:"w-6 m-2"},el={class:"flex flex-row justify-content-end"},ll={__name:"MenuPage",setup(C){const I=f([]),g=f(null),U=f({global:{value:null,matchMode:se.CONTAINS}}),S=f({});f(!1);const P=(u,e)=>{if(!e)return u;const s=e.toLowerCase();return u.filter(t=>{const i=Object.entries(t).filter(([r])=>r!=="subitems").some(([r,V])=>String(V).toLowerCase().includes(s)),p=t.subitems?.some(r=>Object.values(r).some(V=>String(V).toLowerCase().includes(s)));return i||p}).map(t=>{const i=Object.entries(t).filter(([p])=>p!=="subitems").some(([p,r])=>String(r).toLowerCase().includes(s));return{...t,subitems:i?t.subitems:t.subitems?.filter(p=>Object.values(p).some(r=>String(r).toLowerCase().includes(s)))}})},A=ie(()=>P(I.value,U.value.global.value));f("");const G=f([]),c=f(null),l=f({}),M=f([]);let v=["name","note","subname"];const $=["","_en","_cn"];let _=["id","price","category","tags","image","soldout"];const w=f(!1),x=f(!1);function q(){w.value=!w.value}function z(){x.value=!x.value}function K(u){y=void 0,w.value=!0,j(u)}function X(u){y=void 0,x.value=!0,j(u)}function j(u,e){F=e,c.value=u;for(let s=0;s<v.length;s++)l.value[v[s]]=u[v[s]],l.value[v[s]+"_en"]=u[v[s]+"_en"],l.value[v[s]+"_cn"]=u[v[s]+"_cn"];l.value.disable=u.disable||!1;for(let s=0;s<_.length;s++)l.value[_[s]]=u[_[s]]}let F=!1;function L(){console.log("apply dish");let u={},e=!1;for(let s=0;s<v.length;s++)for(let t=0;t<$.length;t++){const i=v[s]+$[t];c.value[i]!=l.value[i]&&(u[i]=l.value[i],e=!0)}for(let s=0;s<_.length;s++){let t=_[s];c.value[t]!=l.value[t]&&(e=!0,u[t]=l.value[t])}if(c.value.disable?l.value.disable||(e=!0,u.disable=!1):l.value.disable&&(e=!0,u.disable=!0),!e){g.value.add({severity:"error",summary:"错误",detail:"There is no data changed!",life:3e3});return}if(e){let s=!1;if(l.value.id=l.value.id.trim(),l.value.id!="")if(l.value.id==c.value.id)s=!0;else{s=!0;for(let t=0;t<b.menuData.value.length;t++)if(l.value.id==b.menuData.value[t].id){s=!1;break}}if(!s){g.value.add({severity:"error",summary:"错误",detail:`invalid id: ${l.value.id}`,life:3e3});return}if(F)u={...l.value},b.menuData.value.push(u),y?(y.subitems||(y.subitems=[y]),y.subitems.push(u),u.handle=c.value.handle):(u.handle="handle_"+u.id,G.value.push(u));else{u.org_id=c.value.id;for(let t=0;t<v.length;t++)for(let i=0;i<$.length;i++){const p=v[t]+$[i];c.value[p]=l.value[p]}c.value.disable=l.value.disable;for(let t=0;t<_.length;t++){let i=_[t];c.value[i]=l.value[i]}}x.value=!1,w.value=!1,console.log("update_data: ",u),b.updateMenuItem(u)}}let y;function R(){const u=[],e={};for(let s=0;s<b.menuData.value.length;s++){let t=b.menuData.value[s];if(e[t.handle]){let i=e[t.handle];i.subitems||(i.subitems=[i]),i.subitems.push(t)}else e[t.handle]=t,u.push(t)}I.value=u,H()}de(()=>{R()});function H(){const u={},e=["---","My Box","Pato assado"],s=[{name:"",value:""},{name:"My BOX",value:"My BOX"},{name:"Pato assado",value:"Pato assado"}];for(let t=0;t<b.menuData.value.length;t++){const i=b.menuData.value[t];i.category&&i.category!=""&&(u[i.category]||(u[i.category]=!0,s.push({name:i.category,value:i.category}),e.push(i.category))),i.tags&&i.tags!=""&&(u[i.tags]||(u[i.tags]=!0,s.push({name:i.tags,value:i.tags}),e.push(i.tags)))}M.value=e}const B=f(null);function J(){B.value.click()}function Q(u){const e=u.target.files[0];e&&W(e)}async function W(u){let e;e="/upload_image";const s=new FormData;s.append("image",u);try{const t=await fetch(e,{method:"POST",body:s});if(!t.ok)throw new Error("上传失败");const i=await t.json();l.value.image=i.imageUrl,g.value.add({severity:"success",summary:"成功",detail:"图片上传成功",life:3e3})}catch(t){console.error("上传错误",t),g.value.add({severity:"error",summary:"错误",detail:"图片上传失败",life:3e3})}}async function Y(){try{await b.refreshMenu(),R(),g.value.add({severity:"success",summary:"成功",detail:"菜单已刷新",life:3e3})}catch(u){console.error("刷新失败:",u),g.value.add({severity:"error",summary:"错误",detail:"刷新菜单失败",life:3e3})}}return(u,e)=>{const s=_e,t=ye,i=ge,p=ne,r=fe,V=me,D=ve,m=be,Z=ce,ee=E,O=le;return k(),h(re,null,[a("div",$e,[n(V,{value:A.value,paginator:"",dataKey:"id",filterDisplay:"row",rows:10,scrollable:"",scrollHeight:"flex",class:"h-full flex flex-column",rowsPerPageOptions:[5,10,15,20,30,40],globalFilterFields:["id","name"],expandedRows:S.value,"onUpdate:expandedRows":e[1]||(e[1]=o=>S.value=o),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} to {last} of {totalRecords}"},{header:d(()=>[a("div",De,[n(i,null,{default:d(()=>[n(s,null,{default:d(()=>e[23]||(e[23]=[a("i",{class:"pi pi-search"},null,-1)])),_:1,__:[23]}),n(t,{modelValue:U.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>U.value.global.value=o),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})])]),paginatorstart:d(()=>[n(p,{type:"button",icon:"pi pi-refresh",onClick:Y,text:""})]),expansion:d(o=>[o.data.subitems?(k(),h("div",Ie,[n(V,{value:o.data.subitems},{default:d(()=>[n(r,{field:"id",header:"子ID"}),n(r,{field:"subname",header:"子名称"}),n(r,{class:"w-24 !text-end"},{body:d(({data:T})=>[n(p,{icon:"pi pi-pen-to-square",onClick:tl=>X(T),severity:"secondary",rounded:""},null,8,["onClick"])]),_:1})]),_:2},1032,["value"])])):(k(),h("div",Se,N("Nothing")))]),default:d(()=>[n(r,{expander:"",style:{width:"5rem"}}),n(r,{field:"id",sortable:"",header:"Id"}),n(r,{field:"name",sortable:"",header:"Name"}),n(r,{class:"w-24 !text-end"},{body:d(({data:o})=>[n(p,{icon:"pi pi-pen-to-square",onClick:T=>K(o),severity:"secondary",rounded:""},null,8,["onClick"])]),_:1})]),_:1},8,["value","expandedRows"])]),n(O,{visible:w.value,"onUpdate:visible":e[14]||(e[14]=o=>w.value=o),class:"w-full h-full",header:"Edit Dish",modal:""},{default:d(()=>[a("div",Pe,[a("div",Me,[n(D,{modelValue:l.value.disable,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.disable=o),binary:""},null,8,["modelValue"]),e[24]||(e[24]=a("label",null,"Disable",-1))]),a("div",je,[n(D,{modelValue:l.value.soldout,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.soldout=o),binary:""},null,8,["modelValue"]),e[25]||(e[25]=a("label",null,"Soldout",-1))]),a("div",null,[l.value.image?(k(),h("img",{key:0,src:l.value.image,style:{height:"100px",width:"100px"},onClick:J},null,8,Fe)):(k(),h("div",Le,e[26]||(e[26]=[a("div",{class:"q-mt-sm"},"点击选择图片",-1)]))),a("input",{type:"file",ref_key:"fileInput",ref:B,accept:"image/*",style:{display:"none"},onChange:Q},null,544)])]),a("div",Re,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.name,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.name=o),class:"w-full m-2"},null,8,["modelValue"]),e[27]||(e[27]=a("label",{for:"on_label"},"name(pt)",-1))]),_:1,__:[27]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.name_en,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.name_en=o),class:"w-full m-2"},null,8,["modelValue"]),e[28]||(e[28]=a("label",{for:"on_label"},"name(english)",-1))]),_:1,__:[28]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.name_cn,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.name_cn=o),class:"w-full m-2"},null,8,["modelValue"]),e[29]||(e[29]=a("label",{for:"on_label"},"name(中文)",-1))]),_:1,__:[29]}),e[36]||(e[36]=a("div",{class:"p-3"},null,-1)),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.note,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.note=o),class:"w-full m-2"},null,8,["modelValue"]),e[30]||(e[30]=a("label",{for:"on_label"},"descript(pt)",-1))]),_:1,__:[30]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.note_en,"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.note_en=o),class:"w-full m-2"},null,8,["modelValue"]),e[31]||(e[31]=a("label",{for:"on_label"},"descript(english)",-1))]),_:1,__:[31]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.note_cn,"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.note_cn=o),class:"w-full m-2"},null,8,["modelValue"]),e[32]||(e[32]=a("label",{for:"on_label"},"descript(中文)",-1))]),_:1,__:[32]}),e[37]||(e[37]=a("div",{class:"p-3"},null,-1)),a("div",Be,[a("div",Oe,[a("div",Te,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"number",modelValue:l.value.id,"onUpdate:modelValue":e[10]||(e[10]=o=>l.value.id=o),class:"w-full m-2"},null,8,["modelValue"]),e[33]||(e[33]=a("label",{for:"on_label"},"id",-1))]),_:1,__:[33]})]),a("div",Ne,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"number",modelValue:l.value.price,"onUpdate:modelValue":e[11]||(e[11]=o=>l.value.price=o),class:"w-full m-2"},null,8,["modelValue"]),e[34]||(e[34]=a("label",{for:"on_label"},"price",-1))]),_:1,__:[34]})])]),a("div",Ee,[a("div",Ae,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.category,"onUpdate:modelValue":e[12]||(e[12]=o=>l.value.category=o),class:"w-full m-2"},null,8,["modelValue"]),e[35]||(e[35]=a("label",{for:"on_label"},"category",-1))]),_:1,__:[35]})]),a("div",Ge,[n(ee,null,{default:d(()=>[n(m,{variant:"on"},{default:d(()=>[n(Z,{modelValue:l.value.tags.value,"onUpdate:modelValue":e[13]||(e[13]=o=>l.value.tags.value=o),options:M.value,class:"w-full m-2"},null,8,["modelValue","options"]),a("label",qe,N(l.value.tags.value),1)]),_:1})]),_:1})])])]),a("div",ze,[n(p,{label:"Cancel",onClick:q}),n(p,{label:"Save",onClick:L})])])]),_:1},8,["visible"]),n(O,{visible:x.value,"onUpdate:visible":e[22]||(e[22]=o=>x.value=o),class:"w-full h-full",header:"Edit Item",modal:""},{default:d(()=>[a("div",Ke,[a("div",Xe,[n(D,{modelValue:l.value.disable,"onUpdate:modelValue":e[15]||(e[15]=o=>l.value.disable=o),binary:""},null,8,["modelValue"]),e[38]||(e[38]=a("label",null,"Disable",-1))]),a("div",He,[n(D,{modelValue:l.value.soldout,"onUpdate:modelValue":e[16]||(e[16]=o=>l.value.soldout=o),binary:""},null,8,["modelValue"]),e[39]||(e[39]=a("label",null,"Soldout",-1))])]),a("div",Je,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.subname,"onUpdate:modelValue":e[17]||(e[17]=o=>l.value.subname=o),class:"w-full m-2"},null,8,["modelValue"]),e[40]||(e[40]=a("label",{for:"on_label"},"subname(pt)",-1))]),_:1,__:[40]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.subname_en,"onUpdate:modelValue":e[18]||(e[18]=o=>l.value.subname_en=o),class:"w-full m-2"},null,8,["modelValue"]),e[41]||(e[41]=a("label",{for:"on_label"},"subname(english)",-1))]),_:1,__:[41]}),n(m,{variant:"on"},{default:d(()=>[n(t,{type:"text",modelValue:l.value.subname_cn,"onUpdate:modelValue":e[19]||(e[19]=o=>l.value.subname_cn=o),class:"w-full m-2"},null,8,["modelValue"]),e[42]||(e[42]=a("label",{for:"on_label"},"subname(中文)",-1))]),_:1,__:[42]}),e[45]||(e[45]=a("div",{class:"p-3"},null,-1)),a("div",Qe,[a("div",We,[a("div",Ye,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"number",modelValue:l.value.id,"onUpdate:modelValue":e[20]||(e[20]=o=>l.value.id=o),class:"w-full m-2"},null,8,["modelValue"]),e[43]||(e[43]=a("label",{for:"on_label"},"id",-1))]),_:1,__:[43]})]),a("div",Ze,[n(m,{variant:"on"},{default:d(()=>[n(t,{type:"number",modelValue:l.value.price,"onUpdate:modelValue":e[21]||(e[21]=o=>l.value.price=o),class:"w-full m-2"},null,8,["modelValue"]),e[44]||(e[44]=a("label",{for:"on_label"},"price",-1))]),_:1,__:[44]})])])]),a("div",el,[n(p,{label:"Cancel",onClick:z}),n(p,{label:"Save",onClick:L})])])]),_:1},8,["visible"]),n(pe(we),{ref_key:"toast",ref:g},null,512)],64)}}},gl=xe(ll,[["__scopeId","data-v-20055478"]]);export{gl as default};
