import{Q as ee,a as te}from"./QItem-CgQYdZU4.js";import{Q as be,a as me}from"./rtl-SocbUiVf.js";import{c as D,d as s,F as z,E as P,y as o,s as j,K as T,x as J,k as fe,X as pe,l as u,p as i,q as C,e as g,I as W,t as M,Q as G,r as w,J as ve,M as K,G as Y,b as ye,w as Z,L as B,ah as ge,C as Te,n as H,N as S,ai as ke,h as V,af as Ce}from"./index-CxWiWLra.js";import{u as we}from"./use-quasar-Mx4h6xYE.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as se}from"./QForm-CvwqbO2M.js";import{c as X,b as xe,Q as Oe,a as le}from"./QTable-DLo5QcPJ.js";import{C as ae,Q as $e}from"./CodeMaker-IOgtdCDu.js";import{Q as oe,a as ie}from"./QTd-BoqDg8ck.js";import"./QItemLabel-DfQtWlqN.js";import"./format-CJebrXOQ.js";import"./_commonjsHelpers-gnU0ypJ3.js";const Se={class:"tabs row q-gutter-sm"},Me={__name:"FilterTabs",props:{filterStatus:String},setup(l){const v=l,f=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function n(p){if(p===v.filterStatus)switch(p){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(p,d)=>(s(),D("div",Se,[(s(),D(z,null,P(f,r=>o(T,{key:r.value,label:r.label,flat:l.filterStatus!==r.value,unelevated:!0,class:j(n(r.value)),onClick:t=>p.$emit("update:filterStatus",r.value)},null,8,["label","flat","class","onClick"])),64))]))}},qe={class:"text-h6 text-weight-bolder"},he={class:"status-text"},Ee={class:"text-subtitle2 text-weight-bolder"},Qe={__name:"TableCard",props:{table:Object,editMode:Boolean},setup(l){const v=l,f=J(()=>parseFloat(v.table.order.reduce((p,d)=>p+d.price*d.quantity,0).toFixed(2))),n=J(()=>{switch(v.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});return(p,d)=>fe((s(),u(G,{class:j(["table-card",n.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:d[1]||(d[1]=()=>p.$emit("selectTable",l.table.id))},{default:i(()=>[l.editMode?(s(),u(T,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:d[0]||(d[0]=W(()=>p.$emit("removeTable",l.table.id),["stop"]))})):C("",!0),g("div",null,[g("div",qe," Mesa "+M(l.table.id),1),g("div",he,M(l.table.status),1),g("div",null,M(l.table.people)+" Pessoas ",1),g("div",Ee," €"+M(f.value),1)])]),_:1},8,["class"])),[[pe]])}},Ae=_(Qe,[["__scopeId","data-v-30f5901c"]]),Ne={class:"table-grid q-pa-lg"},Be={__name:"TableGrid",props:{tables:Array,editMode:Boolean},setup(l){return(v,f)=>(s(),D("div",Ne,[(s(!0),D(z,null,P(l.tables,n=>(s(),u(Ae,{key:n.id,table:n,editMode:l.editMode,onSelectTable:()=>v.$emit("selectTable",n.id),onRemoveTable:()=>v.$emit("removeTable",n.id)},null,8,["table","editMode","onSelectTable","onRemoveTable"]))),128))]))}},De=_(Be,[["__scopeId","data-v-acb55136"]]),Ie={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(l,{emit:v}){const f=v,n=w("");function p(){f("submit",n.value),n.value=""}return(d,r)=>(s(),u(Y,{"model-value":l.visible,onHide:r[2]||(r[2]=()=>d.$emit("close"))},{default:i(()=>[o(G,{style:{"min-width":"400px"}},{default:i(()=>[o(se,{onSubmit:p},{default:i(()=>[o(ve,{filled:"",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=t=>n.value=t),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[t=>t&&t.length>0||"Por favor, escreve algo",t=>!isNaN(t)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),o(K,{align:"right"},{default:i(()=>[g("div",null,[o(T,{label:"Submeter",type:"submit",color:"primary"}),o(T,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:r[1]||(r[1]=W(()=>d.$emit("close"),["stop"]))})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Re={class:"q-mt-none q-mb-none text-center"},Fe={class:"self-center no-outline"},Le={round:"",class:"self-center no-outline"},Ve={class:"self-center no-outline"},ze={class:j(["col-4","justify-between","row"])},je={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","close","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(l,{emit:v}){const f=l,n=w(!0),p=["Livre","Ocupado","Pago","Reservado"],d=v,r=w(null),t=ye({id:null,people:0,peopleType:{adults:0,childres:0},status:""});function h(){t.peopleType.adults>0&&(t.peopleType.adults=t.peopleType.adults-1)}function O(){t.peopleType.adults=t.peopleType.adults+1}function Q(){t.peopleType.childres>0&&(t.peopleType.childres=t.peopleType.childres-1)}function F(){t.peopleType.childres=t.peopleType.childres+1}function L(){window.open(window.env.QR_ADDR+ae.SimpleEncode(f.table.id),"_blank")}Z(()=>f.visible,async k=>{k&&f.table?.id&&(Object.assign(t,JSON.parse(JSON.stringify(f.table))),await H(),I(),t.status==="Livre"&&(await H(),d("tableEditableMode")))},{immediate:!0}),Z(()=>[t.peopleType.adults,t.peopleType.childres],([k,c])=>{const q=parseInt(k)||0,e=parseInt(c)||0;t.people=q+e});async function I(){if(n.value=!0,await H(),!r.value||!f.table.id){console.warn("Canvas not ready or table ID missing");return}const k=window.env.QR_ADDR+ae.SimpleEncode(f.table.id);console.log("qrcoed data: ",k),$e.toCanvas(r.value,k,{width:150},c=>{c?(console.error("二维码生成失败",c),setTimeout(()=>I(),300)):n.value=!1})}return(k,c)=>(s(),u(Y,{"model-value":l.visible,onHide:c[7]||(c[7]=q=>k.$emit("close"))},{default:i(()=>[o(G,{style:{"min-width":"450px"}},{default:i(()=>[o(B,{class:"row items-center justify-end q-pb-none q-pl-none q-pt-sm q-pr-sm"},{default:i(()=>[o(T,{icon:"close",flat:"",round:"",dense:"",onClick:c[0]||(c[0]=W(q=>k.$emit("close"),["stop"]))})]),_:1}),o(se,{onSubmit:c[6]||(c[6]=()=>k.$emit("submit",t)),class:"q-ma-lg"},{default:i(()=>[g("h4",Re,"Table "+M(t.id),1),o(X,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:i(()=>[g("div",Fe,M(t.people),1)]),_:1}),o(B,{class:"row items-center"},{default:i(()=>[l.editable?(s(),u(T,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:h})):C("",!0),o(X,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:i(()=>[g("div",Le,M(t.peopleType.adults),1)]),_:1}),l.editable?(s(),u(T,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:O})):C("",!0)]),_:1}),o(B,{class:"row items-center no-wrap"},{default:i(()=>[l.editable?(s(),u(T,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:Q})):C("",!0),o(X,{outlined:"",label:"Childrens","stack-label":"",class:"q-mx-sm col-grow"},{control:i(()=>[g("div",Ve,M(t.peopleType.childres),1)]),_:1}),l.editable?(s(),u(T,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:F})):C("",!0)]),_:1}),o(xe,{square:"",outlined:"",modelValue:t.status,"onUpdate:modelValue":c[1]||(c[1]=q=>t.status=q),options:p,disable:!l.editable},null,8,["modelValue","disable"]),o(B,{class:"flex flex-center",style:{"min-height":"160px"}},{default:i(()=>[n.value?(s(),u(ge,{key:0,color:"primary",size:"2em"})):C("",!0),g("canvas",{ref_key:"qrCanvas",ref:r,style:Te({display:n.value?"none":"block",marginTop:"8px",border:"1px solid #c0c0c0",borderRadius:"12px"}),onClick:L},null,4)]),_:1}),g("div",ze,[t.status!="空闲"&&!l.editable?(s(),u(T,{key:0,color:"deep-orange",glossy:"",label:"Limpar mesa",onClick:c[2]||(c[2]=()=>k.$emit("cleanTable",t.id))})):C("",!0),l.editable?C("",!0):(s(),u(T,{key:1,color:"primary",label:"Visualizar pedidos",onClick:c[3]||(c[3]=()=>k.$emit("showTableOrders"))})),l.editable?C("",!0):(s(),u(T,{key:2,color:"secondary",label:"Editar",onClick:c[4]||(c[4]=()=>k.$emit("tableEditableMode"))})),l.editable?(s(),u(T,{key:3,color:"white","text-color":"black",label:"Cancelar",onClick:c[5]||(c[5]=()=>k.$emit("editableModeBack"))})):C("",!0),l.editable?(s(),u(T,{key:4,color:"primary",type:"submit",label:"Salvar"})):C("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ue=_(je,[["__scopeId","data-v-c0848679"]]),Pe={class:"text-h6"},Je={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},Ge={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose","deleteOrder"],setup(l,{emit:v}){const f=l,n=v,p=w({rowsPerPage:0}),d=w(""),r=w(!1),t=w([]),h=[{name:"name",required:!0,label:"nome",align:"left",field:e=>S.getDishName(e),format:e=>`${e}`,sortable:!0},{name:"quantity",required:!0,label:"quandidade",align:"left",field:e=>e.quantity,format:e=>`${e}`,sortable:!0},{name:"price/uni",required:!0,label:"Preço/uni",align:"left",field:e=>e.price.toFixed(2),format:e=>`${e}`,sortable:!0},{name:"price",required:!0,label:"Preço",align:"left",field:e=>e.price*e.quantity,format:e=>`${e.toFixed(2)}`,sortable:!0},{name:"extras",required:!0,label:"Extras",field:e=>Q(e),format:e=>e||""}],O=w([]);function Q(e){return e.name.toLowerCase().includes("bibimbap")?(console.log("rows: ",e.notes),[e.notes[0],e.notes[1],e.notes[2],e.notes[3],e.notes[4]].filter(m=>!!m).join(" / ")):e.name.toLowerCase().includes("ramen")&&e.notes[4]||""}Z(()=>f.table?.order,e=>{t.value=Array.isArray(e)?JSON.parse(JSON.stringify(e)):[]},{immediate:!0,deep:!0});function F(e){return r.value?e.filter(m=>m.price>0):e}function L(){r.value&&(d.value=r.value?"price>0":"")}function I(){q(),r.value=!1,n("autoClose")}function k(e){const m=e.name==="My BOX"||e.name==="Pato assado",y=(A,E)=>A.findIndex(N=>m?N.name===E.name&&N.price===E.price:N.dishid===E.dishid),$=y(t.value,e);if($===-1)return;const R=t.value[$];if(R.quantity<=0)return;if(R.quantity-=1,R.quantity===0){const A=t.value.splice($,1)[0];U(A)}else U(R,e);function U(A,E=A){const N=y(O.value,A);N!==-1?O.value[N].quantity+=1:O.value.push({dishid:E.dishid,quantity:1,name:E.name,price:E.price})}}const c=J(()=>parseFloat(t.value.reduce((e,m)=>e+m.price*m.quantity,0).toFixed(2)));function q(){t.value=Array.isArray(f.table.order)?JSON.parse(JSON.stringify(f.table.order)):[],O.value=[],n("cancelOrderEdit")}return(e,m)=>(s(),u(Y,{"model-value":l.visible,onHide:I},{default:i(()=>[o(G,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:i(()=>[o(B,null,{default:i(()=>[g("div",Pe,"Mesa "+M(l.table.id),1)]),_:1}),Array.isArray(t.value)&&t.value.length>0?(s(),u(B,{key:0,class:"q-pa-md"},{default:i(()=>[o(Oe,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:t.value,"virtual-scroll":"",filter:d.value,"filter-method":F,columns:h,pagination:p.value,"onUpdate:pagination":m[0]||(m[0]=y=>p.value=y),"rows-per-page-options":[0],"row-key":"id"},ke({_:2},[l.editMode?{name:"header",fn:i(y=>[o(oe,{props:y},{default:i(()=>[o(le,{"auto-width":""}),(s(!0),D(z,null,P(y.cols,$=>(s(),u(le,{key:$.name,props:y},{default:i(()=>[V(M($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,l.editMode?{name:"body",fn:i(y=>[o(oe,{props:y},{default:i(()=>[o(ie,{"auto-width":""},{default:i(()=>[o(T,{size:"sm",color:"accent",round:"",dense:"",icon:"remove",disable:y.row.quantity<=0,onClick:$=>k(y.row)},null,8,["disable","onClick"])]),_:2},1024),(s(!0),D(z,null,P(y.cols,$=>(s(),u(ie,{key:$.name,props:y},{default:i(()=>[V(M($.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(s(),u(B,{key:1},{default:i(()=>m[5]||(m[5]=[V(" Nothing ")])),_:1,__:[5]})),o(K,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:i(()=>[o(K,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:i(()=>[g("div",Je," Total: €"+M(c.value),1)]),_:1}),l.editMode?C("",!0):(s(),u(Ce,{key:0,modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=y=>r.value=y),color:"green",onClick:m[2]||(m[2]=y=>L()),label:"No Zero"},null,8,["modelValue"])),l.editMode?(s(),u(T,{key:1,color:"white","text-color":"black",label:"Cancelar",onClick:q})):C("",!0),l.editMode?(s(),u(T,{key:2,color:"primary",label:"Salvar",onClick:m[3]||(m[3]=y=>e.$emit("saveOrder",[...O.value]))})):C("",!0),l.editMode?C("",!0):(s(),u(T,{key:3,color:"primary",label:"Editar",onClick:m[4]||(m[4]=()=>e.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},He={class:j(["tables-page","row","no-wrap","justify-between"])},st={__name:"TablesPage",setup(l){const v=we(),f=w("Livre"),n=w(!1),p=w(!1),d=w(null),r=w(!1),t=w(!1),h=w(!1),O=w(!1),Q=w({}),F=J(()=>f.value==="Todos"?S.tables.value:S.tables.value.filter(b=>b.status===f.value));function L(){n.value=!0}function I(){n.value==!0&&(n.value=!1)}function k(b){v.dialog({title:"Confimação de eliminação",message:`Tem certeza quer eliminar a mesa ${b} ? Esta operação não é recuperável.`,cancel:!0,persistent:!0}).onOk(()=>{const a=S.deleteTable(b);a!=null&&v.dialog({title:"Erro",message:a.message})})}function c(){p.value=!0}async function q(b){const a=await S.addNewTable(b);a!==void 0&&v.notify({title:a.title,type:"negative",message:a.message,position:"top-right",timeout:3e3,icon:"error"})}function e(){p.value=!1}function m(b){const a=S.tables.value.find(x=>x.id===b);d.value={...a,order:a?.order||[]},r.value=!0}function y(){t.value=!0}function $(b){const a={id:b.id,status:b.status,peopleType:{adults:b.peopleType.adults,childres:b.peopleType.childres}},x=S.updateTable(a);x&&v.dialog(x),t.value=!1}function R(){t.value=!1,r.value=!1}function U(){t.value=!1}function A(b){v.dialog({title:"Confirmação de limpeza",message:`Tem a certeza que deseja limpar a mesa ${b}? Isto irá remover todos os clientes e definir o estado como 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const a=S.tableClean(b);a&&v.dialog(a)})}function E(){const b=S.tables.value.find(a=>a.id===d.value.id);d.value={...b,order:b?.order||[]},h.value=!0}function N(){h.value=!1}function ne(){O.value=!0}function re(b){S.deleteOrders(d.value.id,b),Q.value.order&&(S.deleteOrder(Q.value),Q.value={}),O.value=!1}function de(){S.refreshTables(),O.value=!1}function ue(){h.value=!1}function ce({order:b,tableId:a}){Q.value={order:b,tableId:a}}return(b,a)=>(s(),D(z,null,[g("div",He,[o(Me,{filterStatus:f.value,"onUpdate:filterStatus":a[0]||(a[0]=x=>f.value=x)},null,8,["filterStatus"]),o(T,{color:"primary",icon:n.value?"close":"edit",class:j(["q-pa-md"]),onClick:I},{default:i(()=>[n.value?C("",!0):(s(),u(be,{key:0},{default:i(()=>[o(me,{style:{"min-width":"100px"}},{default:i(()=>[o(ee,{clickable:"",onClick:c},{default:i(()=>[o(te,null,{default:i(()=>a[6]||(a[6]=[V("Adicionar")])),_:1,__:[6]})]),_:1}),o(ee,{clickable:"",onClick:L},{default:i(()=>[o(te,null,{default:i(()=>a[7]||(a[7]=[V("Editar")])),_:1,__:[7]})]),_:1})]),_:1})]),_:1}))]),_:1},8,["icon"])]),a[8]||(a[8]=g("div",null,null,-1)),g("div",null,[o(De,{tables:F.value,editMode:n.value,onSelectTable:m,onRemoveTable:k},null,8,["tables","editMode"])]),g("div",null,[o(Ie,{onSubmit:q,onClose:e,visible:p.value,"onUpdate:visible":a[1]||(a[1]=x=>p.value=x)},null,8,["visible"])]),g("div",null,[d.value?(s(),u(Ue,{key:0,visible:r.value,"onUpdate:visible":a[2]||(a[2]=x=>r.value=x),table:d.value,"onUpdate:table":a[3]||(a[3]=x=>d.value=x),editable:t.value,onTableEditableMode:y,onSubmit:$,onClose:R,onEditableModeBack:U,onCleanTable:A,onShowTableOrders:E},null,8,["visible","table","editable"])):C("",!0)]),g("div",null,[d.value?(s(),u(Ge,{key:0,visible:h.value,"onUpdate:visible":a[4]||(a[4]=x=>h.value=x),table:d.value,"onUpdate:table":a[5]||(a[5]=x=>d.value=x),onClose:N,onSetEditMode:ne,editMode:O.value,onSaveOrder:re,onCancelOrderEdit:de,onAutoClose:ue,onDeleteOrder:ce},null,8,["visible","table","editMode"])):C("",!0)])],64))}};export{st as default};
