import{s as Q}from"./index-DCPuJMKM.js";import{s as H}from"./index-BuxHylFA.js";import{s as G}from"./index-CXtDhJOV.js";import{h as c,f as R,o as v,w as f,a as r,b as n,c as x,F as U,y as Z,t as O,s as I,C as z,A as J,E as K,e as k,l as _,x as B,k as h,G as P,z as W,u as X}from"./index-EM-CZ76s.js";import{s as Y}from"./index-D5K97AE0.js";import{b as N}from"./index-MfeMOwLv.js";import{s as ee}from"./index-BNzAb0bj.js";import{s as te}from"./index-D1ntQOTB.js";import{s as le}from"./index-Bn-5yviF.js";import{s as ae}from"./index-Dt_kEjEg.js";import{Q as ie,C as F,s as ne}from"./CodeMaker-DC2MPGtb.js";import{a as se,d as oe,s as re}from"./index-DtmduXlt.js";import"./index-BtG8bjm2.js";import"./index-HVwDa22t.js";import"./index-BCAUToxQ.js";import"./index-n_nkxNS_.js";import"./index-VDlT9R5v.js";import"./index-JD_Ne0bk.js";const de={class:"p-menuitem-content"},ue={__name:"TableMenuBar",props:{filterStatu:String},setup(T){const C=c([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(p,u)=>{const a=N,d=Y;return v(),R(d,{model:C.value,breakpoint:"355px"},{item:f(({item:s})=>[r("div",de,[n(a,{label:s.label,icon:s.icon,severity:s.severity,variant:"outlined",raised:"",onClick:o=>p.$emit("update:filterStatu",s.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},ce={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},pe={class:"grid m-2"},be={class:"text-center text-2xl font-bold"},fe={class:"text-center"},ve={class:"text-center text-lg"},me={class:"text-center text-lg font-bold"},ye={__name:"TableGrid",props:{filteredTables:Array},setup(T){const C=c([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function p(d){return C.value.find(s=>s.value===d)}function u(d){return!d||!Array.isArray(d)?0:parseFloat(d.reduce((s,o)=>s+o.price*o.quantity,0).toFixed(2))}function a(d){const s="m-1 border-3 border-gray-500 ";let o="";switch(d){case"Livre":break;case"Ocupado":o="border-red-300 bg-red-100";break;case"Reservado":o="border-blue-300 bg-blue-100";break;case"Pago":o="border-purple-300 bg-purple-100";break;default:o="border-gray-500 bg-gray-100"}return s+o}return(d,s)=>{const o=ee;return v(),x("div",ce,[r("div",pe,[(v(!0),x(U,null,Z(T.filteredTables,m=>(v(),R(o,{class:I(a(m.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:V=>d.$emit("openTableDetail",m.id)},{content:f(()=>[r("p",be,"桌号: "+O(m.id),1),r("p",fe,O(p(m.status).label),1),r("p",ve,O(m.people)+"人",1),r("p",me,O(u(m.order))+"€",1)]),_:2},1032,["class","onClick"]))),256))])])}}},Te={class:"flex flex-column justify-content-center align-items-center"},ge={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Ce={key:1,class:"flex flex-wrap justify-content-center align-items-center"},we={class:"flex flex-wrap justify-content-center align-items-center m-2"},he={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},_e={class:"m-2"},xe={key:0,class:"flex flex-wrap justify-content-between align-items-center"},$e={key:1},Ee={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditableMode","tableEditCancel","tableEditConfirm","cleanTable","showTableOrders","showToast"],setup(T,{emit:C}){const p=T,u=C,a=p.selectedTable,d=c([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function s(){return d.value.find(b=>b.value===a.status)}function o(b,i){if(b==="Adult"){if(a.peopleType.adults<=0&&i<=0)return;a.peopleType.adults+=i}else if(b==="Children"){if(a.peopleType.children<=0&&i<=0)return;a.peopleType.children+=i}a.people=a.peopleType.adults+a.peopleType.children,m()}function m(){u("update:selectedTable",a)}const V=z(),D=()=>{V.require({message:"是否清空"+a.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{u("showToast","info","操作","桌号"+a.id+"，清台"),u("cleanTable",a.id)},reject:()=>{u("showToast","error","操作","取消"+a.id+"号桌清台")}})},$=c(null);function j(){window.open(window.env.QR_ADDR+F.SimpleEncode(p.selectedTable.id),"_blank")}const S=async()=>{if($.value)try{await ie.toCanvas($.value,window.env.QR_ADDR+F.SimpleEncode(p.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(b){console.error("生成二维码失败:",b)}};return J(()=>{S()}),K(()=>window.env.QR_ADDR+F.SimpleEncode(p.selectedTable.id),S),(b,i)=>{const E=ae,q=le,l=N,e=te;return v(),x(U,null,[r("div",Te,[r("div",null,[n(q,{class:"m-2",variant:"on"},{default:f(()=>[n(E,{id:"Total",modelValue:_(a).people,"onUpdate:modelValue":i[0]||(i[0]=t=>_(a).people=t),autocomplete:"off",disabled:""},null,8,["modelValue"]),i[12]||(i[12]=r("label",{for:"Total"},"总人数",-1))]),_:1,__:[12]})]),T.isEditTable?(v(),x("div",ge,[n(l,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:i[1]||(i[1]=t=>o("Adult",-1))}),n(q,{class:"m-2",variant:"on"},{default:f(()=>[n(E,{id:"Adult",modelValue:_(a).peopleType.adults,"onUpdate:modelValue":i[2]||(i[2]=t=>_(a).peopleType.adults=t),autocomplete:"off"},null,8,["modelValue"]),i[13]||(i[13]=r("label",{for:"Adult"},"大人",-1))]),_:1,__:[13]}),n(l,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:i[3]||(i[3]=t=>o("Adult",1))})])):k("",!0),T.isEditTable?(v(),x("div",Ce,[n(l,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:i[4]||(i[4]=t=>o("Children",-1))}),n(q,{class:"m-2",variant:"on"},{default:f(()=>[n(E,{id:"Children",modelValue:_(a).peopleType.children,"onUpdate:modelValue":i[5]||(i[5]=t=>_(a).peopleType.children=t),autocomplete:"off"},null,8,["modelValue"]),i[14]||(i[14]=r("label",{for:"Children"},"小孩",-1))]),_:1,__:[14]}),n(l,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:i[6]||(i[6]=t=>o("Children",1))})])):k("",!0)]),r("div",we,[T.isEditTable?k("",!0):(v(),R(l,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:s().label,severity:s().severity},null,8,["label","severity"])),T.isEditTable?(v(),R(e,{key:1,modelValue:_(a).status,"onUpdate:modelValue":i[7]||(i[7]=t=>_(a).status=t),options:d.value,optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"])):k("",!0)]),r("div",he,[r("canvas",{ref_key:"qrCanvas",ref:$,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:j},null,512)]),r("div",_e,[T.isEditTable?k("",!0):(v(),x("div",xe,[n(l,{label:"订单详情",severity:"success",onClick:i[8]||(i[8]=t=>b.$emit("showTableOrders"))}),n(l,{label:"清台",onClick:D,severity:"danger",class:"m-1"}),n(l,{label:"编辑",onClick:i[9]||(i[9]=t=>b.$emit("tableEditableMode")),class:"m-1"})])),T.isEditTable?(v(),x("div",$e,[n(l,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:i[10]||(i[10]=t=>b.$emit("tableEditCancel"))}),n(l,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:i[11]||(i[11]=t=>{b.$emit("tableEditCancel"),b.$emit("tableEditConfirm",_(a))})})])):k("",!0)])],64)}}},ke={key:0},Oe=["disabled","onClick"],Ve={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Se={class:"font-bold"},qe={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit"],setup(T,{emit:C}){const p=T,u=C,a=c(p.selectedTable.order?.sort((l,e)=>e.price-l.price).filter(l=>l.quantity!=0)),d=c(a.value.filter(l=>l.price!=0)),s=c([]),o=c(!1),m=c(!1);function V(l){let e=0;return l.forEach(t=>{e+=t.price*t.quantity}),e.toFixed(2)}function D(){o.value=!o.value,!o.value&&s.value.length>0&&q()}function $(l){if(s.value.find(e=>e.dishid===l.dishid))s.value.find(e=>e.dishid===l.dishid).quantity+=1;else{const e={...l,quantity:1};s.value.push(e)}l.quantity-=1}function j(){let l="| ";return s.value.forEach(e=>{const t=a.value.find(g=>g.dishid===e.dishid);t&&(l+=e.dishid+"-"+h.getDishName(e)+" "+(t.quantity+e.quantity)+" -> "+t.quantity+` | 
`)}),l}function S(l){u("cancelOrderEdit"),u("showToast","error","操作",`取消菜品删除
`+l),s.value.forEach(e=>{a.value.find(t=>t.dishid===e.dishid).quantity+=e.quantity}),s.value=[]}function b(l){u("saveOrder",s.value),u("showToast","info","操作","桌号1，清台"),s.value=[],a.value=p.selectedTable.order?.sort((e,t)=>t.price-e.price).filter(e=>e.quantity!=0)}const i=z();function E(l){return Array.isArray(l)?l.map(P):P(l)}const q=()=>{let l=!1;const e=E(j());i.require({message:e,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{l=!0,b()},reject:()=>{l=!0,S(e)},onHide:()=>{l||S(e)}})};return(l,e)=>{const t=se,g=oe,A=re,M=ne,y=N;return v(),x(U,null,[r("div",null,[n(A,{value:m.value?d.value:a.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:f(()=>e[6]||(e[6]=[r("div",{class:"text-center py-5"},[r("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:f(()=>[n(t,{field:"dishid",header:"号码"}),n(t,{header:"菜名"},{body:f(w=>[B(O(_(h).getDishName(w.data)),1)]),default:f(()=>[e[2]||(e[2]=B(" > "))]),_:1,__:[2]}),n(t,{field:"price",header:"单价"}),n(t,{field:"quantity",header:"数量"},{body:f(w=>[o.value?k("",!0):(v(),x("label",ke,O(w.data.quantity),1)),o.value?(v(),R(g,{key:1,modelValue:w.data.quantity,"onUpdate:modelValue":L=>w.data.quantity=L,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:f(()=>e[3]||(e[3]=[r("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:f(()=>[r("span",{class:"p-inputnumber-button-icon",disabled:w.data.quantity<=0,onClick:L=>$(w.data)},e[4]||(e[4]=[r("i",{class:"pi pi-angle-down"},null,-1)]),8,Oe)]),_:2},1032,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:1}),n(t,{header:"总价"},{body:f(w=>[B(O(V([w.data])),1)]),default:f(()=>[e[5]||(e[5]=B(" > "))]),_:1,__:[5]})]),_:1},8,["value"])]),r("div",Ve,[r("label",Se," 合计："+O(d.value.length>0?V(d.value):"0"),1),r("label",null,[n(M,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=w=>m.value=w)},null,8,["modelValue"]),e[7]||(e[7]=B(" 不显示价格为0 "))]),n(y,{label:o.value?"保存":"编辑",onClick:e[1]||(e[1]=w=>D())},null,8,["label"])])],64)}}},Ke={__name:"TablesPage",setup(T){const C=c("Todos");c(!1),c(!1);const p=c(!1),u=c({id:0}),a=c(!1),d=c(!1),s=c({}),o=W(()=>C.value==="Todos"?h.tables.value:h.tables.value.filter(e=>e.status===C.value));function m(e){const t=h.tables.value.find(g=>g.id===e);u.value={...t,order:t?.order||[]},p.value=!0}function V(){a.value=!0}function D(e){const t={id:e.id,status:e.status,peopleType:{adults:e.peopleType.adults,children:e.peopleType.children}},g=h.updateTable(t);g&&console.log("tableEditConfirm Error:",g),a.value=!1}function $(){a.value=!1,p.value=!1}function j(){a.value=!1}function S(e){const t=h.tableClean(e);t&&console.log("cleanTable Error:",t),$()}function b(){const e=h.tables.value.find(t=>t.id===u.value.id);u.value={...e,order:e?.order||[]},d.value=!0}function i(e){h.deleteOrders(u.value.id,e),s.value.order&&(h.deleteOrder(s.value),s.value={})}function E(){h.refreshTables()}const q=X();function l(e,t,g,A){q.add({severity:e||"",summary:t||"",detail:g||"",life:A||3e3})}return(e,t)=>{const g=G,A=H,M=Q;return v(),x(U,null,[n(ue,{filterStatu:C.value,"onUpdate:filterStatu":t[0]||(t[0]=y=>C.value=y)},null,8,["filterStatu"]),n(ye,{filteredTables:o.value,"onUpdate:filteredTables":t[1]||(t[1]=y=>o.value=y),onOpenTableDetail:m},null,8,["filteredTables"]),n(g,{visible:p.value,"onUpdate:visible":t[4]||(t[4]=y=>p.value=y),header:"桌号: "+u.value.id,class:"m-0 p-0",modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"},onHide:$},{default:f(()=>[n(Ee,{selectedTable:u.value,"onUpdate:selectedTable":t[2]||(t[2]=y=>u.value=y),isEditTable:a.value,"onUpdate:isEditTable":t[3]||(t[3]=y=>a.value=y),onTableEditableMode:V,onTableEditCancel:j,onTableEditConfirm:D,onCleanTable:S,onShowTableOrders:b,onShowToast:l},null,8,["selectedTable","isEditTable"])]),_:1},8,["visible","header"]),n(g,{visible:d.value,"onUpdate:visible":t[5]||(t[5]=y=>d.value=y),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:t[6]||(t[6]=y=>E())},{default:f(()=>[n(qe,{selectedTable:u.value,onSaveOrder:i,onCancelOrderEdit:E,onShowToast:l},null,8,["selectedTable"])]),_:1},8,["visible"]),n(A),n(M)],64)}}};export{Ke as default};
